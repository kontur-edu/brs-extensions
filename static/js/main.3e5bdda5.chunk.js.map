{"version":3,"sources":["apis/brsUrlProvider.ts","helpers/cache.ts","apis/brsAuth.ts","Context.tsx","components/GoogleLoginButton.tsx","components/CustomAlert.tsx","components/submitWithLoading/index.tsx","components/BrsLoginForm.tsx","components/loginPage/index.tsx","components/loginPage/LoginPageWrapper.tsx","components/NestedList.tsx","helpers/CustomError.ts","apis/brsApi.ts","helpers/tools.ts","components/DisciplinesFetchControls.tsx","components/DisciplinesFetch.tsx","apis/googleApi.ts","helpers/brsHelpers.ts","functions/readStudentsAsync.ts","functions/buildAutoMarksConfigAsync.ts","components/spreadsheetFetch/index.tsx","components/WorkerDialog.tsx","helpers/fio.ts","marksActions/DisciplineMarksManager.ts","marksActions/MarksManager.ts","components/SessionExpiredAlert.tsx","apis/googleAuth.ts","helpers/logger.ts","components/RunWorkerButtons.tsx","components/workPage/WorkPage.tsx","components/workPage/WorkPageWrapper.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["brsUrl","BrsUrlProvider","withProxy","this","memoryCache","save","name","data","json","JSON","stringify","localStorage","setItem","read","localData","content","getItem","memoryData","parse","BrsAuth","brsUrlProvider","_sid","_login","tryLoadLoginInfoFromCache","login","password","requestSidAsync","response","headers","cookie","result","match","sid","saveLoginInfo","cache","removeItem","request","url","baseUrl","method","body","resolveWithFullResponse","simple","then","x","Error","loginInfo","loadLoginInfoFromCache","Context","createContext","GoogleLoginButton","props","onSignedIn","onFailure","clientId","buttonText","onSuccess","scope","isSignedIn","CustomAlert","open","message","type","onClose","Fragment","Snackbar","autoHideDuration","anchorOrigin","vertical","horizontal","severity","Alert","elevation","variant","SubmitWithLoading","title","loading","className","onClick","disabled","Button","fullWidth","color","CircularProgress","size","onSubmit","React","useState","username","setUsername","setPassword","setSid","e","preventDefault","TextField","margin","id","label","autoFocus","value","onChange","target","autoComplete","LoginPage","handleBrsSubmit","credentials","a","setState","submitLoading","loginBrsAsync","loginSucceed","alertMessage","openAlert","alertType","brsAuthorized","brsAuth","authBySidAsync","loginAsync","handleCloseAlert","handleGoogleSignedIn","googleAuthorized","handleGoogleLoginFailed","error","console","startWork","redirect","state","checkAuth","to","Container","component","maxWidth","Grid","container","justify","item","md","lg","sm","xs","BrsLoginForm","Component","Consumer","context","useStyles","makeStyles","theme","createStyles","root","width","backgroundColor","palette","background","default","nested","paddingLeft","spacing","onEmptyMessage","textAlign","NestedList","items","collapsed","classes","listSubheader","ListSubheader","hidden","List","aria-labelledby","subheader","length","ConstructItems","ListItem","ListItemText","primary","map","index","Item","setOpen","nestedItems","hasSubItems","button","ListItemIcon","ExpandLess","ExpandMore","nestedItemTitle","NestedItem","Collapse","in","timeout","unmountOnExit","disablePadding","StatusCode","CustomError","statusCode","StudentFailure","TermType","BrsApi","year","termType","course","isModule","cacheName","cacheResult","getDisciplineInternalAsync","queryString","requestApiJsonAsync","disciplines","paging","discipline","getStudentMarksAsync","students","uniqueStudents","s","knownStudent","studentUuid","Object","keys","k","cardType","markType","getStudentMarksInternalAsync","disciplineLoad","groupHistoryId","groupId","groupUuid","techgroup","isTotal","showActiveStudents","groupPart","getControlActionsCachedAsync","getControlActionsInternalAsync","modulePart","requestApiAsync","prefix","suffix","linesWithId","split","trim","filter","startsWith","columns","substr","uuidPrefix","c","uuid","uuidWithoutPrefix","controlAction","controlActionId","mark","cardTypeKey","disciplineLoadUuid","isNaN","toString","studentFailure","NoFailure","updateMarksAsync","updateMarksInternalAsync","uri","options","trimLeft","BrsUnauthorized","normalizeString","str","toLowerCase","replace","compareNormalized","s1","s2","parseAnyFloat","parseFloat","minWidth","marginRight","submit","display","top","marginTop","setCourse","Date","getFullYear","setYear","date","month","getMonth","day","getDate","getTermType","setTermType","setIsModule","handleChange","event","checked","required","FormControl","InputLabel","Select","MenuItem","FormControlLabel","control","Checkbox","header","marginBottom","disciplinesList","DisciplinesFetch","brsApi","onError","openDisciplines","setOpenDisciplines","setDisciplines","setLoading","fetchData","Fall","Spring","getDisciplineCachedAsync","rawDisciplines","convertToListItems","entries","key","reduce","reducer","itemKey","push","d","group","DisciplinesFetchControls","memo","getSpreadsheet","spreadsheetId","sheets","gapi","client","range","spreadsheets","values","get","readAsync","writeAsync","asEnteredByUser","valueInputOption","requestBody","update","appendAsync","append","getSpreadsheetProperties","res","sheetProps","properties","failureMapping","NotChosen","NotAllowedByDeansOffice","NotAppeared","Неуважительная","DisrespectfulReason","Уважительная","RespectfulReason","NotAllowedByTeacher","ShouldNotPass","AcademicLeave","Выбыл","DroppedOut","parseStudentFailure","input","undefined","formatStudentFailure","fromSpreadsheetAsync","readRange","fullNameIndex","groupNameIndex","idIndex","failureIndex","sheet","googleApi","rows","row","fullName","groupName","failure","buildAutoMarksConfigAsync","sheetName","isSuitableDiscipline","isSuitableActualStudent","readRowsFromSpreadsheetAsync","getHeader","indices","buildIndicesBy","dataRange","buildDataRange","controlActionConfigs","buildControlActionConfig","disciplineConfig","buildDisciplineConfig","readStudents","fullNameColumn","left","groupColumn","failureColumn","allActualStudents","actualStudents","normalizedHeader","groupColumnIndex","indexOf","fullNameColumnIndex","failureColumnIndex","disciplineParameterKeyColumnIndex","disciplineParameterValueColumnIndex","Math","abs","disciplineKeyColumn","disciplineValueColumn","min","right","leftLetter","String","fromCharCode","charCodeAt","rightLetter","controlActions","propertyIndex","config","sameColumns","matchCount","matchIndex","defaultStudentFailure","i","addDisciplineConfigParameter","parseInt","lowerValue","SpreadsheetFetch","tableUrlError","tableUrl","loadTable","getSpreadsheetInfo","spreadsheetInfo","marksData","moduleGroup","prepareModuleGroup","moduleGroups","onDataLoaded","call","groups","Array","from","Set","regExp","maybeSheetId","sheetId","spreadsheetProperties","maybeSheet","helperText","DialogContent","withStyles","padding","MuiDialogContent","DialogActions","justifyContent","MuiDialogActions","WorkerDialog","marksManager","logMessage","logItems","getLogger","addLogHandler","putMarksToBrsAsync","removeLogHandler","cancelPending","okLoading","cancelWork","cancel","Dialog","runWork","dividers","dense","style","minHeight","paddingTop","paddingBottom","onClosed","toKey","fio","DisciplineMarksManager","logger","log","getAllControlActionsCachedAsync","checkControlActionsConfiguration","getAllStudentMarksAsync","brsStudents","mergeStudents","mergedStudents","skippedActualStudents","skippedBrsStudents","logMergedStudents","putMarksForStudentsAsync","updateFailuresForSkippedStudentsAsync","updateAllMarksAsync","getSuitableControlAction","statusCounters","student","putMarksForStudentAsync","status","updated","failed","marks","brsMark","brs","actualMark","actual","putStudentMarkAsync","brsFailureStatus","actualFailure","failureStatus","putStudentFailureAsync","verbose","studentName","join","suitableControlActions","some","b","updateFailureForStudent","statusKeys","studentFio","description","activeBrsStudents","isStudentActive","actualStudent","suitableStudents","brsStudent","brsFullName","actualFullName","areStudentsLike","ms","studentStatus","MarksManager","disciplineMarksManager","getSuitableDisciplinesAsync","putMarksForDisciplineAsync","allDisciplines","Transition","forwardRef","ref","Slide","direction","SessionExpiredAlert","sessionName","setRedirect","TransitionComponent","keepMounted","aria-describedby","DialogTitle","DialogContentText","logout","DISCOVERY_DOCS","googleAuth","init","Promise","resolve","load","discoveryDocs","catch","checkAuthorized","auth2","getAuthInstance","Logger","logHandlers","errorHandlers","logHandler","h","errorHandler","errorMessage","show","onRunWorkSafe","onRunWorkUnsafe","WorkPage","handleDataLoaded","showControls","addErrorHandler","handleError","handleRunWorkSafe","handleRunWorkUnsafe","handleClosed","handleSessionExpired","openSessionExpiredAlert","closeError","RunWorkerButtons","urlProvider","App","Provider","path","WorkPageWrapper","exact","LoginPageWrapper","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.3e5bdda5.chunk.js","sourcesContent":["const brsUrl = 'https://brs.urfu.ru/mrd';\r\nconst corsProxy = 'https://kamikoto-cors-proxy.herokuapp.com';\r\n\r\nexport default class BrsUrlProvider {\r\n    private readonly withProxy: boolean;\r\n\r\n    constructor(withProxy: boolean) {\r\n        this.withProxy = withProxy;\r\n    }\r\n\r\n    get baseUrl() {\r\n        return this.withProxy ? `${corsProxy}/${brsUrl}` : brsUrl;\r\n    }\r\n}\r\n","const memoryCache: { [name: string]: object | string } = {};\r\n\r\nexport function save(name: string, data: object | string) {\r\n    if (!data) {\r\n        return false;\r\n    }\r\n\r\n    const json = JSON.stringify(data);\r\n\r\n    localStorage.setItem(name, json);\r\n\r\n    memoryCache[name] = data;\r\n\r\n    return true;\r\n}\r\n\r\nexport function read<T extends object | string>(name: string) {\r\n    const localData = memoryCache[name];\r\n    if (localData) {\r\n        return localData as T;\r\n    }\r\n\r\n    const content = localStorage.getItem(name);\r\n    if (!content) {\r\n        return null;\r\n    }\r\n\r\n    const memoryData = JSON.parse(content);\r\n    if (!memoryData) {\r\n        return null;\r\n    }\r\n\r\n    memoryCache[name] = memoryData;\r\n    return memoryData as T;\r\n}\r\n\r\nexport function clear(name: string) {\r\n    localStorage.removeItem(name);\r\n\r\n    delete memoryCache[name];\r\n\r\n    return true;\r\n}\r\n","import request from \"request-promise\";\r\nimport BrsUrlProvider from \"./brsUrlProvider\";\r\nimport * as cache from \"../helpers/cache\";\r\n\r\nexport default class BrsAuth {\r\n    readonly brsUrlProvider: BrsUrlProvider;\r\n\r\n    constructor(brsUrlProvider: BrsUrlProvider) {\r\n        this.brsUrlProvider = brsUrlProvider;\r\n        this.tryLoadLoginInfoFromCache();\r\n    }\r\n\r\n    private _sid: string | null = null;\r\n\r\n    get sid() {\r\n        if (!this._sid)\r\n            this.loadLoginInfoFromCache();\r\n        return this._sid;\r\n    }\r\n\r\n    private _login: string | null = null;\r\n\r\n    get login() {\r\n        if (!this._login)\r\n            this.loadLoginInfoFromCache();\r\n        return this._login;\r\n    }\r\n\r\n    checkAuth() {\r\n        return !!(this._sid && this._login);\r\n    }\r\n\r\n    async loginAsync(login: string, password: string): Promise<boolean> {\r\n        const response = await this.requestSidAsync(login, password);\r\n\r\n        if (!response || !('x-set-cookie' in response.headers)) {\r\n            return false;\r\n        }\r\n\r\n        const cookie = response.headers['x-set-cookie'] as string;\r\n        const result = cookie.match(/(?<=JSESSIONID=)\\w+/);\r\n\r\n        if (!result)\r\n            return false;\r\n\r\n        const sid = result[0];\r\n        this.saveLoginInfo(sid, login);\r\n\r\n        return true;\r\n    }\r\n\r\n    async authBySidAsync(sid: string): Promise<boolean> {\r\n        if (!sid)\r\n            return false;\r\n\r\n        cache.save('loginInfo', {sid: sid, login: 'SESSION'});\r\n\r\n        return true;\r\n    }\r\n\r\n    private saveLoginInfo(sid: string, login: string) {\r\n        cache.save('loginInfo', {sid, login});\r\n        this._sid = sid;\r\n        this._login = login;\r\n    }\r\n\r\n    logout() {\r\n        this._sid = null;\r\n        this._login = null;\r\n        cache.clear('loginInfo');\r\n    }\r\n\r\n    private async requestSidAsync(login: string, password: string) {\r\n        return await request({\r\n            url: this.brsUrlProvider.baseUrl + `/login`,\r\n            method: 'POST',\r\n            body: `username=${login}&password=${password}`,\r\n            resolveWithFullResponse: true,\r\n            simple: false,\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n            },\r\n        }).then(x => x, () => null);\r\n    }\r\n\r\n    private loadLoginInfoFromCache() {\r\n        if (!this.tryLoadLoginInfoFromCache())\r\n            throw new Error('BRS unauthorized');\r\n    }\r\n\r\n    private tryLoadLoginInfoFromCache() {\r\n        const loginInfo = cache.read<{ sid: string, login: string }>('loginInfo');\r\n        if (!loginInfo)\r\n            return false;\r\n\r\n        this._sid = loginInfo.sid;\r\n        this._login = loginInfo.login;\r\n\r\n        return true;\r\n    }\r\n}\r\n","import {createContext} from \"react\";\r\nimport BrsAuth from \"./apis/brsAuth\";\r\nimport BrsApi from \"./apis/brsApi\";\r\n\r\n// @ts-ignore\r\nconst Context = createContext<{ brsAuth: BrsAuth, brsApi: BrsApi }>();\r\n\r\nexport default Context;\r\n","import GoogleLogin from \"react-google-login\";\r\nimport React from \"react\";\r\n\r\nconst CLIENT_ID = '122993083593-pacve8csj86voko30ia65raeg0ncrtuv.apps.googleusercontent.com';\r\nconst SCOPES = \"profile email https://www.googleapis.com/auth/spreadsheets\";\r\n\r\nexport default function GoogleLoginButton(props: Props) {\r\n    const {onSignedIn, onFailure} = props;\r\n\r\n    return (\r\n        <GoogleLogin\r\n            clientId={CLIENT_ID}\r\n            buttonText=\"Войти в аккаунт Google\"\r\n            onSuccess={onSignedIn}\r\n            onFailure={onFailure}\r\n            scope={SCOPES}\r\n            isSignedIn={true}\r\n        />\r\n    );\r\n}\r\n\r\ninterface Props {\r\n    onSignedIn: () => void;\r\n    onFailure: (error: any) => void;\r\n}\r\n","import React from \"react\";\r\nimport MuiAlert, {AlertProps} from '@material-ui/lab/Alert';\r\nimport {Snackbar} from \"@material-ui/core\";\r\n\r\nexport default function CustomAlert(props: Props) {\r\n    const {open, message, type, onClose} = props;\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <Snackbar\r\n                open={open}\r\n                autoHideDuration={10000}\r\n                anchorOrigin={{vertical: 'top', horizontal: 'center'}}\r\n                onClose={onClose}>\r\n                <Alert severity={type} onClose={onClose}>\r\n                    {message}\r\n                </Alert>\r\n            </Snackbar>\r\n        </React.Fragment>\r\n    );\r\n}\r\n\r\nfunction Alert(props: AlertProps) {\r\n    return <MuiAlert elevation={6} variant=\"filled\" {...props} />;\r\n}\r\n\r\ninterface Props {\r\n    open: boolean;\r\n    message: string;\r\n    type: \"error\" | \"success\";\r\n    onClose: () => void;\r\n}\r\n","import {CircularProgress, Button} from \"@material-ui/core\";\r\nimport React from \"react\";\r\nimport \"./styles.css\";\r\n\r\nexport default function SubmitWithLoading(props: Props) {\r\n    const {title, loading, className, onClick, disabled = false} = props;\r\n\r\n    return (\r\n        <div className={\"submit-with-loading \" + className}>\r\n            <Button type=\"submit\"\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    color=\"primary\"\r\n                    onClick={onClick}\r\n                    disabled={loading || disabled}>\r\n                {title}\r\n            </Button>\r\n            {\r\n                loading &&\r\n                <CircularProgress color=\"secondary\" size={24} className=\"button-progress\"/>\r\n            }\r\n        </div>\r\n    )\r\n}\r\n\r\ninterface Props {\r\n    title: string;\r\n    loading: boolean;\r\n    className?: string;\r\n    onClick?: () => void;\r\n    disabled?: boolean;\r\n}\r\n","import {TextField} from \"@material-ui/core\";\r\nimport SubmitWithLoading from \"./submitWithLoading\";\r\nimport React, {FormEvent} from \"react\";\r\n\r\nexport default function ({onSubmit, loading}: Props) {\r\n    const [username, setUsername] = React.useState('');\r\n    const [password, setPassword] = React.useState('');\r\n    const [sid, setSid] = React.useState('');\r\n\r\n    function handleUsernameChanged(e: React.ChangeEvent<HTMLInputElement>) {\r\n        const value = e.target.value;\r\n        setUsername(value);\r\n    }\r\n\r\n    function handlePasswordChanged(e: React.ChangeEvent<HTMLInputElement>) {\r\n        const value = e.target.value;\r\n        setPassword(value);\r\n    }\r\n\r\n    function handleSidChanged(e: React.ChangeEvent<HTMLInputElement>) {\r\n        const value = e.target.value;\r\n        setSid(value);\r\n    }\r\n\r\n    function handleSubmit(e: FormEvent) {\r\n        e.preventDefault();\r\n\r\n        onSubmit({username, password, sid});\r\n    }\r\n\r\n    return (\r\n        <form className=\"form\" onSubmit={handleSubmit}>\r\n            <TextField\r\n                variant=\"outlined\"\r\n                margin=\"normal\"\r\n                fullWidth\r\n                id=\"username\"\r\n                label=\"Имя пользователя\"\r\n                name=\"username\"\r\n                autoFocus\r\n                value={username}\r\n                onChange={handleUsernameChanged}\r\n            />\r\n            <TextField variant=\"outlined\"\r\n                       margin=\"normal\"\r\n                       fullWidth\r\n                       name=\"password\"\r\n                       label=\"Пароль\"\r\n                       type=\"password\"\r\n                       id=\"password\"\r\n                       autoComplete=\"current-password\"\r\n                       value={password}\r\n                       onChange={handlePasswordChanged}/>\r\n            <p className=\"text-center\">или</p>\r\n            <TextField variant=\"outlined\"\r\n                       margin=\"normal\"\r\n                       fullWidth\r\n                       name=\"sid\"\r\n                       label=\"JSESSIONID\"\r\n                       type=\"password\"\r\n                       id=\"sid\"\r\n                       value={sid}\r\n                       onChange={handleSidChanged}/>\r\n            <SubmitWithLoading title=\"войти\" loading={loading}/>\r\n        </form>\r\n    );\r\n}\r\n\r\ninterface Props {\r\n    loading: boolean;\r\n    onSubmit: (credentials: Credentials) => void;\r\n}\r\n\r\nexport interface Credentials {\r\n    username: string\r\n    password: string\r\n    sid: string\r\n}\r\n","import React from 'react';\r\nimport \"./styles.css\";\r\nimport {Redirect} from \"react-router-dom\";\r\nimport {Button, Container, Grid} from \"@material-ui/core\";\r\nimport GoogleLoginButton from \"../GoogleLoginButton\";\r\nimport CustomAlert from \"../CustomAlert\";\r\nimport BrsAuth from \"../../apis/brsAuth\";\r\nimport BrsLoginForm, {Credentials} from \"../BrsLoginForm\";\r\n\r\nexport default class LoginPage extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            brsAuthorized: props.brsAuth.checkAuth(),\r\n            googleAuthorized: false,\r\n            redirect: false,\r\n            submitLoading: false,\r\n            openAlert: false,\r\n            alertMessage: '',\r\n            alertType: 'error'\r\n        }\r\n\r\n    }\r\n\r\n    handleBrsSubmit = async (credentials: Credentials) => {\r\n        this.setState({submitLoading: true});\r\n\r\n        const loginSucceed = await this.loginBrsAsync(credentials);\r\n\r\n        this.setState({submitLoading: false})\r\n\r\n        if (loginSucceed) {\r\n            this.setState({\r\n                alertMessage: \"Авторизация прошла успешно\",\r\n                openAlert: true,\r\n                alertType: 'success',\r\n                brsAuthorized: true\r\n            });\r\n        } else\r\n            this.setState({\r\n                alertMessage: \"Что-то пошло не так :( Попробуйте позже\",\r\n                openAlert: true,\r\n                alertType: 'error'\r\n            });\r\n    }\r\n\r\n    loginBrsAsync = async (credentials: Credentials) => {\r\n        if (credentials.sid) {\r\n            return await this.props.brsAuth.authBySidAsync(credentials.sid);\r\n        }\r\n        if (credentials.username && credentials.password) {\r\n            return await this.props.brsAuth.loginAsync(credentials.username, credentials.password);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    handleCloseAlert = () => {\r\n        this.setState({openAlert: false});\r\n    }\r\n\r\n    handleGoogleSignedIn = () => {\r\n        this.setState({googleAuthorized: true});\r\n    }\r\n\r\n    handleGoogleLoginFailed = (error: any) => {\r\n        console.error(error);\r\n\r\n        this.setState({\r\n            openAlert: true,\r\n            alertType: 'error',\r\n            alertMessage: 'Не удалось подключить Ваш Google аккаунт :('\r\n        });\r\n    }\r\n\r\n    startWork = () => {\r\n        this.setState({redirect: true});\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div className=\"login-page\">\r\n                {this.state.redirect && <Redirect to=\"/brs-extensions/work\"/>}\r\n                <Container component=\"main\" maxWidth=\"md\">\r\n                    <h1>Привет!</h1>\r\n                    <h3>Как все работает</h3>\r\n                    <p>Как-то все работает</p>\r\n                    <h3>Правила хранения данных</h3>\r\n                    <p>Данные хранятся в localstorage</p>\r\n                    <hr/>\r\n                    <p>Для начала работы, необходимо авторизоваться в БРС</p>\r\n                    <Grid container justify=\"space-around\">\r\n                        <Grid item md={5} lg={5} sm={5} xs={10}>\r\n                            <BrsLoginForm onSubmit={this.handleBrsSubmit} loading={this.state.submitLoading}/>\r\n                        </Grid>\r\n                        <Grid item className=\"align-center\">\r\n                            <h3>А также</h3>\r\n                        </Grid>\r\n                        <Grid item className=\"align-center\">\r\n                            <GoogleLoginButton onSignedIn={this.handleGoogleSignedIn}\r\n                                               onFailure={this.handleGoogleLoginFailed}/>\r\n                            <br/>\r\n                        </Grid>\r\n                    </Grid>\r\n                    <Container className=\"start-work-wrapper\">\r\n                        <Button variant=\"contained\"\r\n                                onClick={this.startWork}\r\n                                disabled={!this.state.brsAuthorized || !this.state.googleAuthorized}\r\n                                color=\"secondary\">начать работу</Button>\r\n                    </Container>\r\n                    <CustomAlert open={this.state.openAlert}\r\n                                 message={this.state.alertMessage}\r\n                                 type={this.state.alertType}\r\n                                 onClose={this.handleCloseAlert}/>\r\n                </Container>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\ninterface State {\r\n    brsAuthorized: boolean;\r\n    googleAuthorized: boolean;\r\n    submitLoading: boolean;\r\n    redirect: boolean;\r\n    openAlert: boolean,\r\n    alertMessage: string,\r\n    alertType: \"error\" | \"success\";\r\n}\r\n\r\ninterface Props {\r\n    brsAuth: BrsAuth;\r\n}\r\n","import React from \"react\";\r\nimport Context from \"../../Context\";\r\nimport LoginPage from \"./index\";\r\nimport BrsAuth from \"../../apis/brsAuth\";\r\n\r\nexport default function () {\r\n    return (\r\n        <Context.Consumer>\r\n            {\r\n                context => <LoginPage brsAuth={(context as { brsAuth: BrsAuth }).brsAuth}/>\r\n            }\r\n        </Context.Consumer>\r\n    );\r\n}\r\n","import React from 'react';\r\nimport {createStyles, makeStyles, Theme} from '@material-ui/core/styles';\r\nimport {\r\n    ListSubheader,\r\n    Collapse,\r\n    ListItemText,\r\n    ListItemIcon,\r\n    ListItem,\r\n    List\r\n} from '@material-ui/core';\r\nimport {ExpandLess, ExpandMore} from '@material-ui/icons';\r\nimport GroupIcon from '@material-ui/icons/Group';\r\nimport ViewModuleIcon from '@material-ui/icons/ViewModule';\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n    createStyles({\r\n        root: {\r\n            width: '100%',\r\n            backgroundColor: theme.palette.background.default,\r\n        },\r\n        nested: {\r\n            paddingLeft: theme.spacing(4),\r\n        },\r\n        onEmptyMessage: {\r\n            textAlign: \"center\"\r\n        }\r\n    }),\r\n);\r\n\r\nexport default function NestedList(props: NestedListProps) {\r\n    const {title, items, collapsed = true} = props;\r\n    const classes = useStyles();\r\n\r\n    const listSubheader = (\r\n        <ListSubheader component=\"div\" id=\"nested-list-subheader\" hidden={!title}>\r\n            {title}\r\n        </ListSubheader>\r\n    );\r\n\r\n    return (\r\n        <List\r\n            component=\"nav\"\r\n            aria-labelledby=\"nested-list-subheader\"\r\n            subheader={listSubheader}\r\n            className={classes.root}>\r\n            {\r\n                items.length ?\r\n                    ConstructItems(items, collapsed) :\r\n                    <ListItem className={classes.onEmptyMessage}>\r\n                        <ListItemText primary=\"No items\"/>\r\n                    </ListItem>\r\n            }\r\n        </List>\r\n    );\r\n}\r\n\r\nfunction ConstructItems(items: NestedListItem[], collapsed: boolean) {\r\n    return items.map((item, index) => (\r\n        <Item key={index}\r\n              item={item}\r\n              collapsed={collapsed}/>\r\n    ));\r\n}\r\n\r\nfunction Item(props: ItemProps) {\r\n    const {item, collapsed} = props;\r\n    const [open, setOpen] = React.useState(!collapsed);\r\n    const {title, nestedItems} = item;\r\n\r\n    const hasSubItems = nestedItems && nestedItems.length > 0; //(item.nestedItems ?? []).length > 0;\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <ListItem button onClick={() => setOpen(!open)}>\r\n                <ListItemIcon>\r\n                    <ViewModuleIcon/>\r\n                </ListItemIcon>\r\n                <ListItemText primary={title}/>\r\n                {hasSubItems && (open ? <ExpandLess/> : <ExpandMore/>)}\r\n            </ListItem>\r\n            {\r\n                nestedItems?.map((nestedItemTitle, index) =>\r\n                    <NestedItem {...{index, open, nestedItemTitle}}/>)\r\n            }\r\n        </React.Fragment>\r\n    );\r\n}\r\n\r\nfunction NestedItem({index, nestedItemTitle, open}: NestedItemProps) {\r\n    const classes = useStyles();\r\n\r\n    return (\r\n        <Collapse key={index} in={open} timeout=\"auto\" unmountOnExit>\r\n            <List component=\"div\" className={classes.nested} disablePadding>\r\n                <ListItem button>\r\n                    <ListItemIcon>\r\n                        <GroupIcon/>\r\n                    </ListItemIcon>\r\n                    <ListItemText primary={nestedItemTitle}/>\r\n                </ListItem>\r\n            </List>\r\n        </Collapse>\r\n    );\r\n}\r\n\r\nexport interface NestedListItem {\r\n    title: string,\r\n    nestedItems?: string[]\r\n}\r\n\r\ninterface ItemsProps {\r\n    items: NestedListItem[];\r\n    collapsed?: boolean;\r\n}\r\n\r\ninterface NestedListProps extends ItemsProps {\r\n    title?: string;\r\n}\r\n\r\ninterface ItemProps {\r\n    item: NestedListItem;\r\n    collapsed?: boolean;\r\n}\r\n\r\ninterface NestedItemProps {\r\n    index: number;\r\n    nestedItemTitle: string;\r\n    open: boolean;\r\n}\r\n","export class CustomError {\r\n    readonly message: string;\r\n    readonly statusCode: StatusCode;\r\n\r\n    constructor(statusCode: StatusCode, message: string = '') {\r\n        this.statusCode = statusCode;\r\n        this.message = message;\r\n    }\r\n}\r\n\r\nexport enum StatusCode {\r\n    BrsUnauthorized = 1,\r\n    GoogleUnauthorized\r\n}\r\n","import 'bluebird';\r\nimport request from 'request-promise';\r\nimport * as cache from '../helpers/cache';\r\nimport BrsAuth from \"./brsAuth\";\r\nimport BrsUrlProvider from \"./brsUrlProvider\";\r\nimport {CustomError, StatusCode} from \"../helpers/CustomError\";\r\n\r\nexport default class BrsApi {\r\n    private readonly brsAuth: BrsAuth;\r\n    private readonly brsUrlProvider: BrsUrlProvider;\r\n\r\n    constructor(brsAuth: BrsAuth, brsUrlProvider: BrsUrlProvider) {\r\n        this.brsAuth = brsAuth;\r\n        this.brsUrlProvider = brsUrlProvider;\r\n    }\r\n\r\n    async getDisciplineCachedAsync(\r\n        year: number,\r\n        termType: TermType,\r\n        course: number,\r\n        isModule: boolean\r\n    ) {\r\n        const cacheName = `${this.brsAuth.login}_getDiscipline_${year}_${termType}_${course}_${isModule}`;\r\n        const cacheResult = cache.read<Discipline[]>(cacheName);\r\n        if (cacheResult) {\r\n            return cacheResult;\r\n        }\r\n\r\n        const result = await this.getDisciplineInternalAsync(\r\n            year,\r\n            termType,\r\n            course,\r\n            isModule\r\n        );\r\n        cache.save(cacheName, result);\r\n        return result;\r\n    }\r\n\r\n    async getDisciplineInternalAsync(\r\n        year: number,\r\n        termType: TermType,\r\n        course: number,\r\n        isModule: boolean\r\n    ) {\r\n        const queryString = `?year=${year}&termType=${termType}&course=${course}&total=0&page=1&pageSize=1000&search=`;\r\n        if (isModule) {\r\n            const disciplines = await this.requestApiJsonAsync<Discipline[]>(\r\n                '/mvc/mobile/module/fetch' + queryString\r\n            );\r\n            for (const d of disciplines) {\r\n                d.isModule = true;\r\n            }\r\n            return disciplines;\r\n        } else {\r\n            const paging = await this.requestApiJsonAsync<Paging<Discipline>>(\r\n                '/mvc/mobile/discipline/fetch' + queryString\r\n            );\r\n            const disciplines = paging.content;\r\n            for (const d of disciplines) {\r\n                d.isModule = false;\r\n            }\r\n            return disciplines;\r\n        }\r\n    }\r\n\r\n    async getAllStudentMarksAsync(discipline: Discipline) {\r\n        const students = [\r\n            ...(await this.getStudentMarksAsync(discipline, 'lecture', 'current')),\r\n            ...(await this.getStudentMarksAsync(discipline, 'lecture', 'intermediate')),\r\n            ...(await this.getStudentMarksAsync(discipline, 'laboratory', 'current')),\r\n            ...(await this.getStudentMarksAsync(discipline, 'laboratory', 'intermediate')),\r\n        ];\r\n\r\n        const uniqueStudents: { [id: string]: StudentMark } = {};\r\n        for (const s of students) {\r\n            const knownStudent = uniqueStudents[s.studentUuid] || {};\r\n            uniqueStudents[s.studentUuid] = {...knownStudent, ...s};\r\n        }\r\n\r\n        return Object.keys(uniqueStudents).map(k => uniqueStudents[k]);\r\n    }\r\n\r\n    async getStudentMarksAsync(\r\n        discipline: Discipline,\r\n        cardType: CardType,\r\n        markType: MarkType\r\n    ) {\r\n        return this.getStudentMarksInternalAsync(\r\n            discipline.disciplineLoad,\r\n            discipline.isModule,\r\n            discipline.groupHistoryId,\r\n            discipline.groupId,\r\n            cardType,\r\n            markType\r\n        );\r\n    }\r\n\r\n    async getStudentMarksInternalAsync(\r\n        disciplineLoad: string,\r\n        isModule: boolean,\r\n        groupUuid: string,\r\n        techgroup: string,\r\n        cardType: CardType,\r\n        markType: MarkType,\r\n        isTotal: boolean = false,\r\n        showActiveStudents: boolean = false\r\n    ) {\r\n        const groupPart = isModule\r\n            ? `techgroup=${techgroup}`\r\n            : `groupUuid=${groupUuid}`;\r\n        return this.requestApiJsonAsync<StudentMark[]>(\r\n            `/mvc/mobile/studentMarks/fetch?disciplineLoad=${disciplineLoad}&${groupPart}` +\r\n            `&cardType=${cardType}&hasTest=false&isTotal=${isTotal}` +\r\n            `&intermediate=${markType === 'intermediate'}` +\r\n            `&selectedTeachers=null&showActiveStudents=${showActiveStudents}`\r\n        );\r\n    }\r\n\r\n    async getAllControlActionsCachedAsync(discipline: Discipline) {\r\n        return [\r\n            ...(await this.getControlActionsCachedAsync(discipline, 'lecture', 'current')),\r\n            ...(await this.getControlActionsCachedAsync(\r\n                discipline,\r\n                'lecture',\r\n                'intermediate'\r\n            )),\r\n            ...(await this.getControlActionsCachedAsync(\r\n                discipline,\r\n                'laboratory',\r\n                'current'\r\n            )),\r\n            ...(await this.getControlActionsCachedAsync(\r\n                discipline,\r\n                'laboratory',\r\n                'intermediate'\r\n            )),\r\n            ...(await this.getControlActionsCachedAsync(discipline, 'practice', 'current')),\r\n            ...(await this.getControlActionsCachedAsync(\r\n                discipline,\r\n                'practice',\r\n                'intermediate'\r\n            )),\r\n            ...(await this.getControlActionsCachedAsync(\r\n                discipline,\r\n                'additionalPractice',\r\n                'current'\r\n            )),\r\n            ...(await this.getControlActionsCachedAsync(\r\n                discipline,\r\n                'additionalPractice',\r\n                'intermediate'\r\n            )),\r\n        ];\r\n    }\r\n\r\n    async getControlActionsCachedAsync(\r\n        discipline: Discipline,\r\n        cardType: CardType,\r\n        markType: MarkType\r\n    ) {\r\n        const cacheName = `${this.brsAuth.login}_getControlActions_${discipline.disciplineLoad}` +\r\n            `_${discipline.isModule}_${discipline.groupHistoryId}_${discipline.groupId}_${cardType}_${markType}`;\r\n        const cacheResult = cache.read<ControlAction[]>(cacheName);\r\n        if (cacheResult) {\r\n            return cacheResult;\r\n        }\r\n\r\n        const result = await this.getControlActionsInternalAsync(\r\n            discipline.disciplineLoad,\r\n            discipline.isModule,\r\n            discipline.groupHistoryId,\r\n            discipline.groupId,\r\n            cardType,\r\n            markType\r\n        );\r\n        cache.save(cacheName, result);\r\n        return result;\r\n    }\r\n\r\n    async getControlActionsInternalAsync(\r\n        disciplineLoad: string,\r\n        isModule: boolean,\r\n        groupUuid: string,\r\n        techgroup: string,\r\n        cardType: CardType,\r\n        markType: MarkType\r\n    ) {\r\n        const modulePart = isModule ? '/module' : '';\r\n        const groupPart = isModule ? techgroup : groupUuid;\r\n        const response = await this.requestApiAsync<string>(\r\n            `/mvc/mobile/view/mark/${disciplineLoad}/${groupPart}/teachers${modulePart}/${cardType}/${markType}`\r\n        );\r\n\r\n        const prefix = 'gridColumns = toTextArray(';\r\n        const suffix = ');';\r\n        const linesWithId = response\r\n            .split('\\r\\n')\r\n            .map(s => s.trim())\r\n            .filter(s => s.startsWith(prefix));\r\n        if (linesWithId.length !== 1) {\r\n            throw new Error(\r\n                'Control actions page should contain single line target line with techcard identifier'\r\n            );\r\n        }\r\n\r\n        const columns: Array<{ controlAction: string; uuid: string }> =\r\n            JSON.parse(\r\n                linesWithId[0].substr(\r\n                    prefix.length,\r\n                    linesWithId[0].length - prefix.length - suffix.length\r\n                )\r\n            ) || [];\r\n\r\n        const uuidPrefix = 'technologyCard';\r\n        const result = columns\r\n            .filter(c => c.uuid && c.uuid.startsWith(uuidPrefix))\r\n            .map(c => ({\r\n                uuid: c.uuid,\r\n                uuidWithoutPrefix: c.uuid.substr(uuidPrefix.length),\r\n                controlAction: c.controlAction,\r\n            }));\r\n        return result as ControlAction[];\r\n    }\r\n\r\n    async putStudentMarkAsync(\r\n        studentUuid: string,\r\n        controlActionId: string,\r\n        mark: number,\r\n        groupId: string,\r\n        cardTypeKey: CardType,\r\n        disciplineLoadUuid: string\r\n    ) {\r\n        const body = `student=${studentUuid}&techcard=${controlActionId}&mark=${\r\n            isNaN(mark) ? '' : mark.toString()\r\n        }&groupId=${groupId}&cardTypeKey=${cardTypeKey}&disciplineLoadUuid=${disciplineLoadUuid}`;\r\n        return this.requestApiJsonAsync<StudentMark>(\r\n            `/mvc/mobile/studentMarks/put`,\r\n            {\r\n                method: 'POST',\r\n                body,\r\n                json: false,\r\n            },\r\n            {\r\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n            }\r\n        );\r\n    }\r\n\r\n    async putStudentFailureAsync(\r\n        studentUuid: string,\r\n        discipline: Discipline,\r\n        studentFailure: StudentFailure = StudentFailure.NoFailure,\r\n        cardType: CardType = 'lecture'\r\n    ) {\r\n        const body = `markFailure=${studentFailure}&cardType=${cardType}&disciplineLoad=${discipline.disciplineLoad}&studentId=${studentUuid}`;\r\n        await this.requestApiAsync(\r\n            `/mvc/mobile/failure/update`,\r\n            {\r\n                method: 'POST',\r\n                body,\r\n                json: false,\r\n            },\r\n            {\r\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n            }\r\n        );\r\n    }\r\n\r\n    async updateAllMarksAsync(discipline: Discipline) {\r\n        // Одного вызова достаточно, чтобы обновить все оценки по предмету у группы.\r\n        await this.updateMarksAsync(discipline, 'lecture', 'intermediate');\r\n        // await updateMarksAsync(discipline, 'lecture', 'current');\r\n        // await updateMarksAsync(discipline, 'lecture', 'intermediate');\r\n        // await updateMarksAsync(discipline, 'laboratory', 'current');\r\n        // await updateMarksAsync(discipline, 'laboratory', 'intermediate');\r\n        // await updateMarksAsync(discipline, 'practice', 'current');\r\n        // await updateMarksAsync(discipline, 'practice', 'intermediate');\r\n    }\r\n\r\n    async updateMarksAsync(\r\n        discipline: Discipline,\r\n        cardType: CardType,\r\n        markType: MarkType\r\n    ) {\r\n        return this.updateMarksInternalAsync(\r\n            discipline.disciplineLoad,\r\n            discipline.isModule,\r\n            discipline.groupHistoryId,\r\n            discipline.groupId,\r\n            cardType,\r\n            markType\r\n        );\r\n    }\r\n\r\n    async updateMarksInternalAsync(\r\n        disciplineLoad: string,\r\n        isModule: boolean,\r\n        groupUuid: string,\r\n        techgroup: string,\r\n        cardType: CardType,\r\n        markType: MarkType\r\n    ) {\r\n        const modulePart = isModule ? '/module' : '';\r\n        const groupPart = isModule\r\n            ? `techgroup=${techgroup}`\r\n            : `groupUuid=${groupUuid}`;\r\n        const body =\r\n            `disciplineLoad=${disciplineLoad}&${groupPart}` +\r\n            `&cardType=${cardType}&hasTest=false&isTotal=false` +\r\n            `&intermediate=${markType === 'intermediate'}` +\r\n            `&selectedTeachers=null&showActiveStudents=true`;\r\n        return this.requestApiAsync<string>(\r\n            `/mvc/mobile/updateMarks${modulePart}`,\r\n            {\r\n                method: 'POST',\r\n                body,\r\n                json: false,\r\n            },\r\n            {\r\n                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\r\n            }\r\n        );\r\n    }\r\n\r\n    async requestApiJsonAsync<T>(\r\n        uri: string,\r\n        options?: RequestOptions,\r\n        headers?: RequestHeaders\r\n    ): Promise<T> {\r\n        const response = await this.requestApiAsync<string>(uri, options, headers);\r\n\r\n        return JSON.parse(response);\r\n    }\r\n\r\n    async requestApiAsync<T>(\r\n        uri: string,\r\n        options?: RequestOptions,\r\n        headers?: RequestHeaders\r\n    ): Promise<T> {\r\n        const response = await request({\r\n            method: 'GET',\r\n            ...options,\r\n            url: this.brsUrlProvider.baseUrl + uri,\r\n            headers: {\r\n                'X-Cookie': `JSESSIONID=${this.brsAuth.sid}`,\r\n                'X-Requested-With': 'XMLHttpRequest',\r\n                ...headers,\r\n            },\r\n        });\r\n\r\n        if (response.trimLeft().startsWith('<!DOCTYPE html>')) {\r\n            throw new CustomError(StatusCode.BrsUnauthorized, uri + ' is Forbidden');\r\n        }\r\n\r\n        return response;\r\n    }\r\n}\r\n\r\nexport enum StudentFailure {\r\n    /** -, дефис, все хорошо */ NoFailure = -1,\r\n    /** Не выбрана */ NotChosen = -19,\r\n    /** Не допущен (деканат) */ NotAllowedByDeansOffice = -18,\r\n    /** Не явился */ NotAppeared = 0,\r\n    /** Неуважительная */ DisrespectfulReason = 12,\r\n    /** Уважительная */ RespectfulReason = 13,\r\n    /** Не допущен */ NotAllowedByTeacher = 18,\r\n    /** Не должен сдавать */ ShouldNotPass = 19,\r\n    /** Академический отпуск */ AcademicLeave = 20,\r\n    /** Выбыл */ DroppedOut = 21,\r\n}\r\n\r\nexport enum TermType {\r\n    Fall = 1,\r\n    Spring = 2,\r\n}\r\n\r\nexport type CardType = 'lecture' | 'laboratory' | 'practice' | 'additionalPractice';\r\nexport type MarkType = 'intermediate' | 'current';\r\n\r\nexport interface RegisterInfo {\r\n    registerInfoStr: string;\r\n    registerId: number;\r\n    passDate: any;\r\n    cardType: string;\r\n    sheet: string;\r\n}\r\n\r\nexport interface Discipline {\r\n    groupId: string;\r\n    discipline: string;\r\n    group: string;\r\n    registerInfo: RegisterInfo[];\r\n    disciplineLoad: string;\r\n    groupHistoryId: string;\r\n    isModule: boolean;\r\n}\r\n\r\n// eslint-disable-next-line\r\nconst studentMarkSample: StudentMark = {\r\n    studentPersonalNumber: '09800106',\r\n    isEdit: false,\r\n    studentUuid:\r\n        'studen18hc2jg0000magk6mi3iec84bsundigr18hc2jg0000m53o7mlgvora278',\r\n    status: 1,\r\n    studentStatus: 'Активный',\r\n    ignoreCurrentDebars: false,\r\n    studentFio: 'Анисимова Маргарита Васильевна',\r\n    isExtern: false,\r\n    teacherName: '',\r\n    cardType: 'lecture',\r\n    studentName: 'Анисимова М.В.',\r\n    studentGroup: 'РИ-180001',\r\n    registerClosed: false,\r\n    subgroupsITS: '',\r\n    disciplineLoad: 'unpldd18hc2jg0000m5kojcd3te76bnk',\r\n};\r\n\r\nexport interface StudentMark {\r\n    studentPersonalNumber: string;\r\n    isEdit: boolean;\r\n    studentUuid: string;\r\n    status: number;\r\n    studentStatus: string;\r\n    ignoreCurrentDebars: boolean;\r\n    studentFio: string;\r\n    isExtern: boolean;\r\n    teacherName: string;\r\n    cardType: CardType;\r\n    studentName: string;\r\n    studentGroup: string;\r\n    registerClosed: boolean;\r\n    subgroupsITS: string;\r\n    disciplineLoad: string;\r\n    failure?: StudentFailure;\r\n    failureName?: string;\r\n\r\n    [props: string]: number | string | boolean | undefined;\r\n}\r\n\r\nexport interface ControlAction {\r\n    uuid: string;\r\n    uuidWithoutPrefix: string;\r\n    controlAction: string;\r\n}\r\n\r\ninterface RequestOptions {\r\n    method?: string;\r\n    body?: object | string;\r\n    json?: boolean;\r\n}\r\n\r\ninterface RequestHeaders {\r\n    'Content-Type'?: string;\r\n}\r\n\r\ninterface Paging<T> {\r\n    content: T[];\r\n    last: boolean;\r\n    totalPages: number;\r\n    totalElements: number;\r\n    size: number;\r\n    number: number;\r\n    sort: any;\r\n    first: boolean;\r\n    numberOfElements: number;\r\n}\r\n","export function fixSpaces(str: string) {\r\n    return str && str.replace(/[\\s]/g, ' ');\r\n}\r\n\r\nexport function normalizeString(str: string) {\r\n    return (\r\n        str &&\r\n        str\r\n            .toLowerCase()\r\n            .replace('ё', 'е')\r\n            .replace(/[^A-Za-zА-ЯЁа-яё0-9]/g, '')\r\n    );\r\n}\r\n\r\nexport function compareNormalized(s1: string, s2: string) {\r\n    return normalizeString(s1) === normalizeString(s2);\r\n}\r\n\r\nexport function parseAnyFloat(s: string) {\r\n    return parseFloat(s && s.replace(',', '.'));\r\n}\r\n\r\nexport function groupBy<TItem, TKey>(items: TItem[], key: keyof TItem) {\r\n    const reducer: { [group: string]: TItem[] } = {};\r\n    return items.reduce((reducer, item) => {\r\n        const itemKey = `${item[key]}`;\r\n        (reducer[itemKey] = reducer[itemKey] || []).push(item);\r\n        return reducer;\r\n    }, reducer);\r\n}\r\n","import React from 'react';\r\nimport {\r\n    Checkbox,\r\n    createStyles,\r\n    FormControl,\r\n    FormControlLabel,\r\n    InputLabel,\r\n    makeStyles,\r\n    MenuItem,\r\n    Select,\r\n    TextField\r\n} from \"@material-ui/core\";\r\nimport SubmitWithLoading from \"./submitWithLoading\";\r\n\r\nconst useStyles = makeStyles(() =>\r\n    createStyles({\r\n        termType: {\r\n            minWidth: 100,\r\n            marginRight: 10\r\n        },\r\n        year: {\r\n            width: 60,\r\n            marginRight: 10\r\n        },\r\n        course: {\r\n            width: 50,\r\n            marginRight: 10\r\n        },\r\n        submit: {\r\n            display: 'inline-block',\r\n            top: 5\r\n        },\r\n        isModule: {\r\n            marginTop: 15\r\n        },\r\n    }),\r\n);\r\n\r\nexport default function ({loading, onSubmit}: Props) {\r\n    const classes = useStyles();\r\n\r\n    const [course, setCourse] = React.useState(1);\r\n    const [year, setYear] = React.useState(new Date().getFullYear());\r\n    const [termType, setTermType] = React.useState(getTermType());\r\n    const [isModule, setIsModule] = React.useState(false);\r\n\r\n    function handleChange(event: any) {\r\n        const target = event.target;\r\n        switch (target.name) {\r\n            case 'year':\r\n                setYear(target.value as number);\r\n                break;\r\n            case 'term-type':\r\n                setTermType(target.value as TermType);\r\n                break;\r\n            case 'course':\r\n                setCourse(target.value as number);\r\n                break;\r\n            case 'is-module':\r\n                setIsModule(target.checked as boolean);\r\n                break;\r\n        }\r\n    }\r\n\r\n    function handleSubmit(e: any) {\r\n        e.preventDefault();\r\n        onSubmit({course, year, isModule, termType});\r\n    }\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit}>\r\n            <TextField name=\"year\"\r\n                       className={classes.year}\r\n                       label=\"Год\"\r\n                       type=\"number\"\r\n                       value={year}\r\n                       onChange={handleChange}\r\n                       required/>\r\n            <FormControl className={classes.termType} required>\r\n                <InputLabel id=\"term-label\">Семестр</InputLabel>\r\n                <Select name=\"term-type\"\r\n                        value={termType}\r\n                        onChange={handleChange}>\r\n                    <MenuItem value=\"Осенний\">Осенний</MenuItem>\r\n                    <MenuItem value=\"Весенний\">Весенний</MenuItem>\r\n                </Select>\r\n            </FormControl>\r\n            <TextField name=\"course\"\r\n                       className={classes.course}\r\n                       label=\"Курс\"\r\n                       type=\"number\"\r\n                       value={course}\r\n                       onChange={handleChange}\r\n                       required/>\r\n            <FormControlLabel label=\"Модуль\"\r\n                              className={classes.isModule}\r\n                              control={<Checkbox name=\"is-module\"\r\n                                                 color=\"primary\"\r\n                                                 value={isModule}\r\n                                                 onChange={handleChange}/>}/>\r\n            <SubmitWithLoading title=\"вывести\" loading={loading} className={classes.submit}/>\r\n        </form>\r\n    )\r\n}\r\n\r\nfunction getTermType(): TermType {\r\n    const date = new Date();\r\n    const month = date.getMonth() + 1;\r\n    const day = date.getDate();\r\n\r\n    return (\r\n        month >= 9 ||           // September to December\r\n        month == 1 ||           // January\r\n        month == 2 && day <= 7) // Until February 7\r\n        ? \"Осенний\"\r\n        : \"Весенний\";\r\n}\r\n\r\nexport interface DisciplinesFetchData {\r\n    year: number;\r\n    termType: TermType;\r\n    course: number;\r\n    isModule: boolean;\r\n}\r\n\r\ninterface Props {\r\n    loading: boolean;\r\n    onSubmit: (fetchData: DisciplinesFetchData) => void;\r\n}\r\n\r\ntype TermType = \"Осенний\" | \"Весенний\";\r\n","import React, {memo} from \"react\";\r\nimport {Collapse, createStyles, makeStyles} from \"@material-ui/core\";\r\nimport NestedList, {NestedListItem} from \"./NestedList\";\r\nimport BrsApi, {Discipline, TermType} from \"../apis/brsApi\";\r\nimport {groupBy} from \"../helpers/tools\";\r\nimport DisciplinesFetchControls, {DisciplinesFetchData} from \"./DisciplinesFetchControls\";\r\n\r\nconst useStyles = makeStyles(() =>\r\n    createStyles({\r\n        header: {\r\n            marginBottom: 10\r\n        },\r\n        disciplinesList: {\r\n            marginTop: 25\r\n        }\r\n    }),\r\n);\r\n\r\nfunction DisciplinesFetch({brsApi, onError}: Props) {\r\n    const classes = useStyles();\r\n\r\n    const [openDisciplines, setOpenDisciplines] = React.useState(false);\r\n    const [disciplines, setDisciplines] = React.useState([] as NestedListItem[]);\r\n    const [loading, setLoading] = React.useState(false);\r\n\r\n    async function loadDisciplines(fetchData: DisciplinesFetchData) {\r\n        setLoading(true);\r\n\r\n        const termType = fetchData.termType === 'Осенний' ? TermType.Fall : TermType.Spring;\r\n        const {year, course, isModule} = fetchData;\r\n\r\n        let rawDisciplines: Discipline[];\r\n        try {\r\n            rawDisciplines = await brsApi.getDisciplineCachedAsync(year, termType, course, isModule);\r\n        } catch (e) {\r\n            setLoading(false);\r\n            onError(e);\r\n            return;\r\n        }\r\n\r\n        setDisciplines(convertToListItems(rawDisciplines));\r\n        setLoading(false);\r\n        setOpenDisciplines(true);\r\n    }\r\n\r\n    function convertToListItems(disciplines: Discipline[]) {\r\n        return Object\r\n            .entries(groupBy(disciplines, 'discipline'))\r\n            .map(d => ({\r\n                title: d[0],\r\n                nestedItems: d[1].map(x => x.group)\r\n            }));\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <h3 className={classes.header}>Выбери параметры курса в БРС</h3>\r\n            <DisciplinesFetchControls loading={loading} onSubmit={loadDisciplines}/>\r\n            <Collapse in={openDisciplines} className={classes.disciplinesList}>\r\n                <NestedList title=\"Доступные дисциплины\" items={disciplines}/>\r\n            </Collapse>\r\n        </React.Fragment>\r\n    );\r\n}\r\n\r\nexport default memo(DisciplinesFetch);\r\n\r\ninterface Props {\r\n    brsApi: BrsApi;\r\n    onError: (error: any) => void;\r\n}\r\n","export function getSpreadsheet(spreadsheetId: string): Spreadsheet {\r\n    // @ts-ignore\r\n    const sheets = gapi.client.sheets;\r\n\r\n    async function readAsync(range: string) {\r\n        const response = await sheets.spreadsheets.values.get({\r\n            spreadsheetId,\r\n            range,\r\n        });\r\n        return response.result;\r\n    }\r\n\r\n    function writeAsync(range: string, values: any[][], asEnteredByUser = false) {\r\n        const valueInputOption = asEnteredByUser ? \"USER_ENTERED\" : \"RAW\";\r\n        const requestBody = {\r\n            values,\r\n        };\r\n        return sheets.spreadsheets.values.update({\r\n            spreadsheetId,\r\n            range,\r\n            valueInputOption,\r\n            requestBody,\r\n        });\r\n    }\r\n\r\n    function appendAsync(\r\n        range: string,\r\n        values: any[][],\r\n        asEnteredByUser = false\r\n    ) {\r\n        const valueInputOption = asEnteredByUser ? \"USER_ENTERED\" : \"RAW\";\r\n        const requestBody = {\r\n            values,\r\n        };\r\n        return sheets.spreadsheets.values.append({\r\n            spreadsheetId,\r\n            range,\r\n            valueInputOption,\r\n            requestBody,\r\n        });\r\n    }\r\n\r\n    return {\r\n        readAsync,\r\n        writeAsync,\r\n        appendAsync,\r\n    };\r\n}\r\n\r\nexport async function getSpreadsheetProperties(spreadsheetId: string): Promise<SpreadsheetProperties[]> {\r\n    // @ts-ignore\r\n    const sheets = gapi.client.sheets;\r\n\r\n    const res = await sheets.spreadsheets.get({spreadsheetId});\r\n    const sheetProps = JSON.parse(res.body).sheets as [{ properties: SpreadsheetProperties }];\r\n    return sheetProps.map(s => s.properties)\r\n}\r\n\r\nexport interface Spreadsheet {\r\n    readAsync: (range: string) => Promise<ValueRange>;\r\n    writeAsync: (\r\n        range: string,\r\n        values: any[][],\r\n        asEnteredByUser?: boolean\r\n    ) => Promise<any>;\r\n    appendAsync: (\r\n        range: string,\r\n        values: any[][],\r\n        asEnteredByUser?: boolean\r\n    ) => Promise<any>;\r\n}\r\n\r\nexport interface ValueRange {\r\n    majorDimension?: string | null;\r\n    range?: string | null;\r\n    values?: any[][] | null;\r\n}\r\n\r\nexport interface SpreadsheetProperties {\r\n    sheetId: number;\r\n    title: string;\r\n}\r\n","import { StudentFailure } from '../apis/brsApi';\r\nimport { compareNormalized } from './tools';\r\n\r\nconst failureMapping: { [key: string]: StudentFailure } = {\r\n    '-': StudentFailure.NoFailure,\r\n    'Не выбрана': StudentFailure.NotChosen,\r\n    'Не допущен (деканат)': StudentFailure.NotAllowedByDeansOffice,\r\n    'Не явился': StudentFailure.NotAppeared,\r\n    Неуважительная: StudentFailure.DisrespectfulReason,\r\n    Уважительная: StudentFailure.RespectfulReason,\r\n    'Не допущен': StudentFailure.NotAllowedByTeacher,\r\n    'Не должен сдавать': StudentFailure.ShouldNotPass,\r\n    'Академический отпуск': StudentFailure.AcademicLeave,\r\n    Выбыл: StudentFailure.DroppedOut,\r\n};\r\n\r\nexport function parseStudentFailure(input: string): StudentFailure | null {\r\n    if (input === null || input === undefined) {\r\n        return null;\r\n    }\r\n\r\n    for (let key of Object.keys(failureMapping)) {\r\n        if (compareNormalized(key, input)) {\r\n            return failureMapping[key];\r\n        }\r\n    }\r\n\r\n    return StudentFailure.NoFailure;\r\n}\r\n\r\nexport function formatStudentFailure(\r\n    input: StudentFailure | null | undefined\r\n): string | null {\r\n    if (input === null || input === undefined) {\r\n        return null;\r\n    }\r\n\r\n    for (let key of Object.keys(failureMapping)) {\r\n        if (failureMapping[key] === input) {\r\n            return key;\r\n        }\r\n    }\r\n\r\n    return '-';\r\n}\r\n","import { StudentFailure } from '../apis/brsApi';\r\nimport * as googleApi from '../apis/googleApi';\r\nimport { parseStudentFailure } from '../helpers/brsHelpers';\r\n\r\nexport interface ActualStudent {\r\n    fullName: string;\r\n    groupName: string;\r\n    id: string | null;\r\n    failure: StudentFailure | null;\r\n    properties: string[];\r\n}\r\n\r\nexport async function fromSpreadsheetAsync(\r\n    spreadsheetId: string,\r\n    readRange: string,\r\n    fullNameIndex: number = 0,\r\n    groupNameIndex: number = 1,\r\n    idIndex: number | null = null,\r\n    failureIndex: number | null = null\r\n) {\r\n    const sheet = googleApi.getSpreadsheet(spreadsheetId);\r\n\r\n    const rows = (await sheet.readAsync(readRange)).values || [];\r\n\r\n    const result: ActualStudent[] = [];\r\n    for (const row of rows) {\r\n        const fullName = row[fullNameIndex];\r\n        const groupName = row[groupNameIndex];\r\n        const id = idIndex !== null ? row[idIndex] : null;\r\n        const failure =\r\n            failureIndex !== null\r\n                ? parseStudentFailure(row[failureIndex])\r\n                : null;\r\n        if (fullName && groupName) {\r\n            result.push({\r\n                fullName,\r\n                groupName,\r\n                id: id,\r\n                failure: failure,\r\n                properties: row,\r\n            });\r\n        }\r\n    }\r\n    return result;\r\n}\r\n","import { TermType, Discipline, StudentFailure } from '../apis/brsApi';\r\nimport { MarksData, DisciplineConfig } from '../marksActions/MarksManager';\r\nimport * as readStudents from './readStudentsAsync';\r\nimport { ActualStudent } from './readStudentsAsync';\r\nimport * as googleApi from '../apis/googleApi';\r\nimport { normalizeString, compareNormalized } from '../helpers/tools';\r\nimport { parseStudentFailure } from '../helpers/brsHelpers';\r\nimport { ControlActionConfig } from '../marksActions/MarksManager';\r\n\r\nexport default async function buildAutoMarksConfigAsync(\r\n    spreadsheetId: string,\r\n    sheetName: string,\r\n    isSuitableDiscipline: ((d: Discipline) => boolean) | null = null,\r\n    isSuitableActualStudent: ((s: ActualStudent) => boolean) | null = null\r\n): Promise<MarksData> {\r\n    const rows = await readRowsFromSpreadsheetAsync(spreadsheetId, sheetName);\r\n    const header = getHeader(rows);\r\n\r\n    const indices = buildIndicesBy(header);\r\n    const dataRange = buildDataRange(sheetName, indices);\r\n    const controlActionConfigs = buildControlActionConfig(header, indices);\r\n    const disciplineConfig = buildDisciplineConfig(\r\n        rows,\r\n        indices,\r\n        isSuitableDiscipline\r\n    );\r\n\r\n    const allActualStudents = await readStudents.fromSpreadsheetAsync(\r\n        spreadsheetId,\r\n        dataRange,\r\n        indices.fullNameColumn - indices.left,\r\n        indices.groupColumn - indices.left,\r\n        null,\r\n        indices.failureColumn - indices.left\r\n    );\r\n    const actualStudents = isSuitableActualStudent\r\n        ? allActualStudents.filter(isSuitableActualStudent)\r\n        : allActualStudents;\r\n\r\n    return {\r\n        actualStudents,\r\n        disciplineConfig,\r\n        controlActionConfigs,\r\n    };\r\n}\r\n\r\nasync function readRowsFromSpreadsheetAsync(\r\n    spreadsheetId: string,\r\n    sheetName: string\r\n) {\r\n    const sheet = googleApi.getSpreadsheet(spreadsheetId);\r\n    const rows = (await sheet.readAsync(sheetName + '!A1:ZZ100'))\r\n        .values as string[][];\r\n    return rows || null;\r\n}\r\n\r\nfunction getHeader(rows: string[][]) {\r\n    const header = rows && rows[0];\r\n    if (!header) throw new Error(`Can't read header of spreadsheet`);\r\n    return header;\r\n}\r\n\r\nfunction buildIndicesBy(header: string[]): Indices {\r\n    const defaultGroupColumnName = 'Группа в БРС';\r\n    const defaultFullNameColumnName = 'Фамилия Имя в БРС';\r\n    const defaultFailureColumnName = 'Причина отсутствия';\r\n    const disciplineParameterKeyColumnPrefix = 'Названия параметров';\r\n    const disciplineParameterValueColumnPrefix = 'Значения параметров';\r\n\r\n    const normalizedHeader = header && header.map((s) => normalizeString(s));\r\n    const groupColumnIndex = normalizedHeader.indexOf(\r\n        normalizeString(defaultGroupColumnName)\r\n    );\r\n    const fullNameColumnIndex = normalizedHeader.indexOf(\r\n        normalizeString(defaultFullNameColumnName)\r\n    );\r\n    const failureColumnIndex = normalizedHeader.indexOf(\r\n        normalizeString(defaultFailureColumnName)\r\n    );\r\n    const disciplineParameterKeyColumnIndex = normalizedHeader.indexOf(\r\n        normalizeString(disciplineParameterKeyColumnPrefix)\r\n    );\r\n    const disciplineParameterValueColumnIndex = normalizedHeader.indexOf(\r\n        normalizeString(disciplineParameterValueColumnPrefix)\r\n    );\r\n\r\n    if (\r\n        failureColumnIndex < 0 ||\r\n        groupColumnIndex < 0 ||\r\n        fullNameColumnIndex < 0 ||\r\n        groupColumnIndex > failureColumnIndex ||\r\n        fullNameColumnIndex > failureColumnIndex ||\r\n        Math.abs(fullNameColumnIndex - groupColumnIndex) !== 1 ||\r\n        disciplineParameterKeyColumnIndex < 0 ||\r\n        disciplineParameterValueColumnIndex < 0 ||\r\n        disciplineParameterKeyColumnIndex <= failureColumnIndex ||\r\n        disciplineParameterValueColumnIndex <= failureColumnIndex ||\r\n        disciplineParameterValueColumnIndex !==\r\n            disciplineParameterKeyColumnIndex + 1\r\n    )\r\n        throw new Error(`Wrong order of columns`);\r\n    const leftIndex = Math.min(groupColumnIndex, fullNameColumnIndex);\r\n    const rightIndex = failureColumnIndex;\r\n\r\n    return {\r\n        groupColumn: groupColumnIndex,\r\n        fullNameColumn: fullNameColumnIndex,\r\n        failureColumn: failureColumnIndex,\r\n        disciplineKeyColumn: disciplineParameterKeyColumnIndex,\r\n        disciplineValueColumn: disciplineParameterValueColumnIndex,\r\n        left: leftIndex,\r\n        right: rightIndex,\r\n    };\r\n}\r\n\r\nfunction buildDataRange(sheetName: string, indices: Indices) {\r\n    const leftLetter = String.fromCharCode('A'.charCodeAt(0) + indices.left);\r\n    const rightLetter = String.fromCharCode('A'.charCodeAt(0) + indices.right);\r\n    return `${sheetName}!${leftLetter}2:${rightLetter}`;\r\n}\r\n\r\nfunction buildControlActionConfig(header: string[], indices: Indices) {\r\n    const controlActionConfigs: ControlActionConfig[] = [];\r\n    for (let index = indices.left; index <= indices.right; index++) {\r\n        if (\r\n            index === indices.groupColumn ||\r\n            index === indices.fullNameColumn ||\r\n            index === indices.failureColumn ||\r\n            !header[index]\r\n        ) {\r\n            continue;\r\n        }\r\n        controlActionConfigs.push({\r\n            controlActions: [header[index]],\r\n            propertyIndex: index - indices.left,\r\n        });\r\n    }\r\n\r\n    for (const config of controlActionConfigs) {\r\n        if (config.controlActions.length === 1) {\r\n            const sameColumns = controlActionConfigs.filter(\r\n                (c) =>\r\n                    c.controlActions.length === 1 &&\r\n                    compareNormalized(\r\n                        c.controlActions[0],\r\n                        config.controlActions[0]\r\n                    )\r\n            );\r\n            if (sameColumns.length > 1) {\r\n                config.matchCount = sameColumns.length;\r\n                for (\r\n                    let matchIndex = 0;\r\n                    matchIndex < sameColumns.length;\r\n                    matchIndex++\r\n                ) {\r\n                    sameColumns[matchIndex].matchIndex = matchIndex;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return controlActionConfigs;\r\n}\r\n\r\nfunction buildDisciplineConfig(\r\n    rows: string[][],\r\n    indices: Indices,\r\n    isSuitableDiscipline: ((d: Discipline) => boolean) | null\r\n) {\r\n    const result: DisciplineConfig = {\r\n        name: '',\r\n        year: 0,\r\n        termType: TermType.Fall,\r\n        course: 1,\r\n        isModule: false,\r\n        defaultStudentFailure: StudentFailure.NoFailure,\r\n        isSuitableDiscipline: null,\r\n    };\r\n\r\n    for (let i = 0; i < rows.length; i++) {\r\n        const key = rows[i][indices.disciplineKeyColumn]?.trim();\r\n        if (!key) {\r\n            break;\r\n        }\r\n        const value = rows[i][indices.disciplineValueColumn]?.trim();\r\n        addDisciplineConfigParameter(result, key, value);\r\n    }\r\n\r\n    result.isSuitableDiscipline = isSuitableDiscipline;\r\n    return result;\r\n}\r\n\r\nfunction addDisciplineConfigParameter(\r\n    config: DisciplineConfig,\r\n    key: string,\r\n    value: string\r\n) {\r\n    if (compareNormalized(key, 'Дисциплина')) {\r\n        if (value) {\r\n            config.name = value;\r\n        }\r\n    } else if (compareNormalized(key, 'ИТС')) {\r\n        if (value) {\r\n            config.isModule = value.toLowerCase() === 'да';\r\n        }\r\n    } else if (compareNormalized(key, 'Год')) {\r\n        if (value) {\r\n            config.year = parseInt(value.toLowerCase(), 10);\r\n        }\r\n    } else if (compareNormalized(key, 'Семестр')) {\r\n        if (value) {\r\n            if (value.toLowerCase() === 'осенний') {\r\n                config.termType = TermType.Fall;\r\n            } else if (value.toLowerCase() === 'весенний') {\r\n                config.termType = TermType.Spring;\r\n            }\r\n        }\r\n    } else if (compareNormalized(key, 'Курс')) {\r\n        if (value) {\r\n            const lowerValue = value.toLowerCase().trim();\r\n            if (lowerValue === 'все курсы') {\r\n                config.course = 0;\r\n            } else {\r\n                config.course = parseInt(value.toLowerCase(), 10);\r\n            }\r\n        }\r\n    } else if (compareNormalized(key, 'Причина отсутствия по умолчанию')) {\r\n        config.defaultStudentFailure =\r\n            parseStudentFailure(value) ?? StudentFailure.NoFailure;\r\n    }\r\n}\r\n\r\ninterface Indices {\r\n    groupColumn: number;\r\n    fullNameColumn: number;\r\n    failureColumn: number;\r\n    disciplineKeyColumn: number;\r\n    disciplineValueColumn: number;\r\n    left: number;\r\n    right: number;\r\n}\r\n","import React, {FormEvent, memo} from \"react\";\r\nimport buildAutoMarksConfigAsync from \"../../functions/buildAutoMarksConfigAsync\";\r\nimport NestedList, {NestedListItem} from \"../NestedList\";\r\nimport {Collapse, TextField} from \"@material-ui/core\";\r\nimport SubmitWithLoading from \"../submitWithLoading\";\r\nimport {MarksData} from \"../../marksActions/MarksManager\";\r\nimport './styles.css';\r\nimport {getSpreadsheetProperties} from \"../../apis/googleApi\";\r\n\r\nclass SpreadsheetFetch extends React.Component<Props, State> {\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            tableUrl: '',\r\n            loading: false,\r\n            tableUrlError: {error: false, message: ''},\r\n            moduleGroups: []\r\n        };\r\n\r\n    }\r\n\r\n    handleChange = (event: React.ChangeEvent<{ name?: string | undefined, value: unknown }>) => {\r\n        const target = event.target;\r\n        switch (target.name) {\r\n            case 'table-url':\r\n                if (this.state.tableUrlError.error)\r\n                    this.setState({tableUrlError: {error: false, message: ''}});\r\n                this.setState({tableUrl: target.value as string});\r\n        }\r\n    }\r\n\r\n    prepareModuleGroup(marksData: MarksData): NestedListItem {\r\n        const groups = marksData.actualStudents.map(s => s.groupName);\r\n        return {\r\n            title: marksData.disciplineConfig.name,\r\n            nestedItems: Array.from(new Set(groups))\r\n        }\r\n    }\r\n\r\n    loadTable = async (e: FormEvent) => {\r\n        e.preventDefault();\r\n        this.setState({loading: true});\r\n\r\n        const spreadsheetInfo = await this.getSpreadsheetInfo();\r\n        if (!spreadsheetInfo) {\r\n            this.setState({loading: false});\r\n            return;\r\n        }\r\n\r\n        let marksData: MarksData;\r\n        try {\r\n            marksData = await buildAutoMarksConfigAsync(spreadsheetInfo.spreadsheetId, spreadsheetInfo.sheetName);\r\n        } catch (e) {\r\n            this.setState({loading: false})\r\n            this.props.onError(e.message || JSON.stringify(e));\r\n            return;\r\n        }\r\n        const moduleGroup = this.prepareModuleGroup(marksData);\r\n\r\n        this.setState({\r\n            loading: false,\r\n            moduleGroups: [moduleGroup]\r\n        });\r\n        this.props.onDataLoaded?.call(null, marksData);\r\n    }\r\n\r\n    async getSpreadsheetInfo(): Promise<{ spreadsheetId: string, sheetName: string } | null> {\r\n        const regExp = /d\\/(?<spreadsheetId>[a-zA-Z0-9-_]+)\\/edit(#gid=(?<sheetId>[0-9]+))?/;\r\n        const result = this.state.tableUrl.match(regExp);\r\n\r\n        if (!result?.groups || !result.groups.spreadsheetId) {\r\n            this.setState({\r\n                loading: false,\r\n                tableUrlError: {error: true, message: 'Неверный url-адрес.'}\r\n            });\r\n            return null;\r\n        }\r\n        const spreadsheetId = result.groups.spreadsheetId;\r\n        const maybeSheetId = result.groups.sheetId || null;\r\n\r\n        try {\r\n            const spreadsheetProperties = await getSpreadsheetProperties(spreadsheetId);\r\n            const maybeSheet = maybeSheetId\r\n                ? spreadsheetProperties.filter(s => s.sheetId.toString() === maybeSheetId)[0]\r\n                : spreadsheetProperties[0];\r\n            if (!maybeSheet) {\r\n                this.props.onError('Sheet is not found');\r\n                return null;\r\n            }\r\n            const sheetName = maybeSheet.title;\r\n            return {spreadsheetId, sheetName};\r\n        } catch (e) {\r\n            this.props.onError(e.message || JSON.stringify(e));\r\n            return null;\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <span className={'spreadsheet-fetch'}>\r\n                <h3 className={'header'}>Вставь ссылку на Google Таблицу</h3>\r\n                <form onSubmit={this.loadTable} className={'form'}>\r\n                    <TextField name=\"table-url\"\r\n                               label=\"Ссылка\"\r\n                               type=\"text\"\r\n                               className={'tableUrl'}\r\n                               value={this.state.tableUrl}\r\n                               onChange={this.handleChange}\r\n                               error={this.state.tableUrlError.error}\r\n                               helperText={this.state.tableUrlError.message}\r\n                               required/>\r\n                    <SubmitWithLoading title=\"загрузить\"\r\n                                       loading={this.state.loading}\r\n                                       className={'submit'}/>\r\n                </form>\r\n                <Collapse in={!!this.state.moduleGroups.length}>\r\n                    <NestedList items={this.state.moduleGroups} collapsed={false}/>\r\n                </Collapse>\r\n            </span>\r\n        );\r\n    }\r\n}\r\n\r\nexport default memo(SpreadsheetFetch);\r\n\r\ninterface Props {\r\n    onDataLoaded: (data: MarksData) => void;\r\n    onError: (errorMessage: string) => void;\r\n}\r\n\r\ninterface State {\r\n    tableUrl: string;\r\n    loading: boolean;\r\n    tableUrlError: { error: boolean, message: string };\r\n    moduleGroups: NestedListItem[];\r\n}\r\n","import React from 'react';\r\nimport {withStyles} from '@material-ui/core/styles';\r\nimport {Dialog, List, ListItem, ListItemText} from \"@material-ui/core\";\r\nimport MuiDialogTitle from '@material-ui/core/DialogTitle';\r\nimport MuiDialogContent from '@material-ui/core/DialogContent';\r\nimport MuiDialogActions from '@material-ui/core/DialogActions';\r\nimport SubmitWithLoading from \"./submitWithLoading\";\r\nimport MarksManager, {MarksData} from \"../marksActions/MarksManager\";\r\n\r\nconst DialogContent = withStyles(() => ({\r\n    root: {\r\n        padding: 0,\r\n    },\r\n}))(MuiDialogContent);\r\n\r\nconst DialogActions = withStyles(() => ({\r\n    root: {\r\n        display: 'flex',\r\n        justifyContent: 'space-around'\r\n    },\r\n}))(MuiDialogActions);\r\n\r\nexport default class WorkerDialog extends React.Component<Props, State> {\r\n    marksManager: MarksManager;\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.marksManager = props.marksManager;\r\n\r\n        this.state = {\r\n            okLoading: true,\r\n            cancelPending: false,\r\n            logItems: [],\r\n        };\r\n\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.startWork();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.cancelWork();\r\n    }\r\n\r\n    logMessage = (message: string) => {\r\n        this.setState({logItems: [...this.state.logItems, message]});\r\n    }\r\n\r\n    startWork = async () => {\r\n        this.marksManager.getLogger().addLogHandler(this.logMessage);\r\n\r\n        await this.marksManager.putMarksToBrsAsync(this.props.marksData);\r\n\r\n        this.marksManager.getLogger().removeLogHandler(this.logMessage);\r\n\r\n        this.setState({\r\n            cancelPending: false,\r\n            okLoading: false\r\n        });\r\n    }\r\n\r\n    cancelWork = () => {\r\n        this.setState({cancelPending: true});\r\n        this.marksManager.cancel();\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <React.Fragment>\r\n                <Dialog open={this.props.runWork} maxWidth=\"lg\" fullWidth>\r\n                    <MuiDialogTitle>Лог действий</MuiDialogTitle>\r\n                    <DialogContent dividers>\r\n                        <List dense disablePadding style={{minHeight: 400}}>\r\n                            {this.state.logItems.map((item, index) => (\r\n                                <ListItem key={index} style={{paddingTop: 0, paddingBottom: 0}}>\r\n                                    <ListItemText primary={item} style={{marginTop: 2, marginBottom: 2}}/>\r\n                                </ListItem>\r\n                            ))}\r\n                        </List>\r\n                    </DialogContent>\r\n                    <DialogActions>\r\n                        <SubmitWithLoading loading={this.state.okLoading}\r\n                                           onClick={this.props.onClosed}\r\n                                           title=\"ок\"/>\r\n                        <SubmitWithLoading loading={this.state.cancelPending}\r\n                                           disabled={!this.state.okLoading}\r\n                                           onClick={this.cancelWork}\r\n                                           title=\"отмена\"/>\r\n                    </DialogActions>\r\n                </Dialog>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}\r\n\r\ninterface Props {\r\n    runWork: boolean;\r\n    marksManager: MarksManager;\r\n    marksData: MarksData;\r\n    onClosed: () => void;\r\n}\r\n\r\ninterface State {\r\n    okLoading: boolean;\r\n    cancelPending: boolean;\r\n    logItems: string[];\r\n}\r\n","export function toShow(fio: string) {\r\n    return fio.replace('ё', 'е').replace(/[ ]+/, ' ');\r\n}\r\n\r\nexport function toKey(fio: string) {\r\n    return fio.toLowerCase().replace('ё', 'е').replace(/[ ]+/, ' ').trim();\r\n}\r\n","import BrsApi from '../apis/brsApi';\r\nimport {\r\n    ControlAction,\r\n    Discipline,\r\n    StudentMark,\r\n    StudentFailure,\r\n} from '../apis/brsApi';\r\nimport { parseAnyFloat, compareNormalized } from '../helpers/tools';\r\nimport * as fio from '../helpers/fio';\r\nimport { ActualStudent } from '../functions/readStudentsAsync';\r\nimport { formatStudentFailure } from '../helpers/brsHelpers';\r\nimport { Logger } from '../helpers/logger';\r\n\r\nexport default class DisciplineMarksManager {\r\n    private readonly brsApi: BrsApi;\r\n    private readonly options: PutMarksOptions;\r\n    readonly logger: Logger;\r\n\r\n    constructor(brsApi: BrsApi, logger: Logger, options: PutMarksOptions) {\r\n        this.brsApi = brsApi;\r\n        this.logger = logger;\r\n        this.options = options;\r\n    }\r\n\r\n    async putMarksForDisciplineAsync(\r\n        discipline: Discipline,\r\n        actualStudents: ActualStudent[],\r\n        defaultStudentFailure: StudentFailure,\r\n        controlActionConfigs: ControlActionConfig[]\r\n    ) {\r\n        if (actualStudents.length === 0) return;\r\n        this.logger.log(`# Processing group ${discipline.group}`);\r\n        this.logger.log('');\r\n\r\n        const controlActions = await this.brsApi.getAllControlActionsCachedAsync(\r\n            discipline\r\n        );\r\n        if (\r\n            !this.checkControlActionsConfiguration(\r\n                controlActions,\r\n                controlActionConfigs\r\n            )\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        const brsStudents = await this.brsApi.getAllStudentMarksAsync(\r\n            discipline\r\n        );\r\n        const {\r\n            mergedStudents,\r\n            skippedActualStudents,\r\n            skippedBrsStudents,\r\n        } = this.mergeStudents(actualStudents, brsStudents);\r\n        this.logMergedStudents(\r\n            mergedStudents,\r\n            skippedActualStudents,\r\n            skippedBrsStudents\r\n        );\r\n        this.logger.log('');\r\n\r\n        await this.putMarksForStudentsAsync(\r\n            discipline,\r\n            mergedStudents,\r\n            controlActionConfigs,\r\n            controlActions\r\n        );\r\n        this.logger.log('');\r\n\r\n        await this.updateFailuresForSkippedStudentsAsync(\r\n            skippedBrsStudents,\r\n            discipline,\r\n            defaultStudentFailure\r\n        );\r\n        this.logger.log('');\r\n\r\n        if (this.options.save) {\r\n            await this.brsApi.updateAllMarksAsync(discipline);\r\n        }\r\n\r\n        this.logger.log('');\r\n    }\r\n\r\n    checkControlActionsConfiguration(\r\n        controlActions: ControlAction[],\r\n        controlActionConfigs: ControlActionConfig[]\r\n    ) {\r\n        for (const config of controlActionConfigs) {\r\n            if (!this.getSuitableControlAction(config, controlActions)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    async putMarksForStudentsAsync(\r\n        discipline: Discipline,\r\n        students: MergedStudent[],\r\n        controlActionConfigs: ControlActionConfig[],\r\n        controlActions: ControlAction[]\r\n    ) {\r\n        const statusCounters: { [k: string]: number } = {};\r\n\r\n        for (const student of students) {\r\n            const status = await this.putMarksForStudentAsync(\r\n                discipline,\r\n                student,\r\n                controlActionConfigs,\r\n                controlActions\r\n            );\r\n            if (statusCounters[status] === undefined) {\r\n                statusCounters[status] = 0;\r\n            }\r\n            statusCounters[status]++;\r\n        }\r\n\r\n        this.logger.log('Marks update statuses:');\r\n        for (const k of Object.keys(statusCounters)) {\r\n            this.logger.log(`- ${k} = ${statusCounters[k]}`);\r\n        }\r\n    }\r\n\r\n    async putMarksForStudentAsync(\r\n        discipline: Discipline,\r\n        student: MergedStudent,\r\n        controlActionConfigs: ControlActionConfig[],\r\n        controlActions: ControlAction[]\r\n    ) {\r\n        let updated = 0;\r\n        let failed = 0;\r\n\r\n        const marks = [];\r\n        for (const config of controlActionConfigs) {\r\n            const controlAction = this.getSuitableControlAction(\r\n                config,\r\n                controlActions\r\n            );\r\n            if (!controlAction) {\r\n                throw new Error();\r\n            }\r\n\r\n            const brsMark = parseAnyFloat(\r\n                student.brs[controlAction.uuid] as string\r\n            );\r\n            const actualMark = parseAnyFloat(\r\n                student.actual.properties[config.propertyIndex]\r\n            );\r\n\r\n            if (actualMark === brsMark || actualMark === 0) {\r\n                marks.push(\r\n                    `    ${actualMark} `.substr(`${actualMark}`.length - 1)\r\n                );\r\n                continue;\r\n            } else {\r\n                marks.push(\r\n                    `    ${actualMark}!`.substr(`${actualMark}`.length - 1)\r\n                );\r\n            }\r\n\r\n            try {\r\n                if (this.options.save) {\r\n                    await this.brsApi.putStudentMarkAsync(\r\n                        student.brs.studentUuid,\r\n                        controlAction.uuidWithoutPrefix,\r\n                        actualMark,\r\n                        discipline.groupHistoryId,\r\n                        student.brs.cardType,\r\n                        student.brs.disciplineLoad\r\n                    );\r\n                }\r\n                updated++;\r\n            } catch (error) {\r\n                failed++;\r\n            }\r\n        }\r\n\r\n        const brsFailureStatus =\r\n            (student.brs.failure as StudentFailure) ?? StudentFailure.NoFailure;\r\n        const actualFailure =\r\n            student.actual.failure ?? StudentFailure.NoFailure;\r\n        let failureStatus = '';\r\n        if (actualFailure === brsFailureStatus) {\r\n            failureStatus = `${formatStudentFailure(actualFailure)}`;\r\n        } else {\r\n            failureStatus = `${formatStudentFailure(actualFailure)}!`;\r\n            try {\r\n                if (this.options.save) {\r\n                    await this.brsApi.putStudentFailureAsync(\r\n                        student.brs.studentUuid,\r\n                        discipline,\r\n                        actualFailure\r\n                    );\r\n                }\r\n                updated++;\r\n            } catch (error) {\r\n                failed++;\r\n            }\r\n        }\r\n\r\n        const status =\r\n            failed > 0 ? 'FAILED ' : updated > 0 ? 'UPDATED' : 'SKIPPED';\r\n        if (this.options.verbose || failed > 0) {\r\n            const studentName = (\r\n                student.actual.fullName + '                              '\r\n            ).substr(0, 30);\r\n            this.logger.log(\r\n                `${status} ${studentName} updated: ${updated}, failed: ${failed}, marks: ${marks.join(\r\n                    ' '\r\n                )}, failureStatus: ${failureStatus}`\r\n            );\r\n        }\r\n        return status;\r\n    }\r\n\r\n    getSuitableControlAction(\r\n        config: ControlActionConfig,\r\n        controlActions: ControlAction[]\r\n    ) {\r\n        const suitableControlActions = controlActions.filter((a) =>\r\n            config.controlActions.some((b) =>\r\n                compareNormalized(a.controlAction, b)\r\n            )\r\n        );\r\n\r\n        if (suitableControlActions.length === 0) {\r\n            this.logger.log(\r\n                `All of ${config.controlActions.join(', ')} not found`\r\n            );\r\n            this.logger.log(\r\n                `Known actions: ${controlActions\r\n                    .map((a) => a.controlAction)\r\n                    .join(', ')}`\r\n            );\r\n            return null;\r\n        }\r\n\r\n        if (\r\n            config.matchIndex !== undefined ||\r\n            config.matchCount !== undefined\r\n        ) {\r\n            if (\r\n                config.matchIndex === undefined ||\r\n                config.matchCount === undefined ||\r\n                suitableControlActions.length !== config.matchCount ||\r\n                config.matchIndex >= config.matchCount\r\n            ) {\r\n                this.logger.log(\r\n                    `Invalid configuration of ${config.controlActions.join(\r\n                        ', '\r\n                    )}`\r\n                );\r\n                this.logger.log(\r\n                    `Can't match: ${config.matchIndex}/${config.matchCount} of ${suitableControlActions.length}`\r\n                );\r\n                return null;\r\n            }\r\n            return suitableControlActions[config.matchIndex];\r\n        }\r\n\r\n        if (suitableControlActions.length > 1) {\r\n            this.logger.log(\r\n                `Several control actions found for ${config.controlActions.join(\r\n                    ', '\r\n                )}`\r\n            );\r\n            this.logger.log(\r\n                `Found actions: ${suitableControlActions\r\n                    .map((a) => a.controlAction)\r\n                    .join(', ')}`\r\n            );\r\n            return null;\r\n        }\r\n\r\n        return suitableControlActions[0];\r\n    }\r\n\r\n    async updateFailuresForSkippedStudentsAsync(\r\n        students: StudentMark[],\r\n        discipline: Discipline,\r\n        defaultStudentFailure: StudentFailure\r\n    ) {\r\n        const statusCounters: { [k: string]: number } = {};\r\n\r\n        for (const student of students) {\r\n            const status = await this.updateFailureForStudent(\r\n                student,\r\n                discipline,\r\n                defaultStudentFailure\r\n            );\r\n            if (statusCounters[status] === undefined) {\r\n                statusCounters[status] = 0;\r\n            }\r\n            statusCounters[status]++;\r\n        }\r\n\r\n        const statusKeys = Object.keys(statusCounters);\r\n        if (statusKeys.length > 0) {\r\n            this.logger.log('Failures update statuses:');\r\n            for (const k of statusKeys) {\r\n                this.logger.log(`- ${k} = ${statusCounters[k]}`);\r\n            }\r\n        } else {\r\n            this.logger.log('No failures for skipped students');\r\n        }\r\n    }\r\n\r\n    async updateFailureForStudent(\r\n        student: StudentMark,\r\n        discipline: Discipline,\r\n        defaultStudentFailure: StudentFailure\r\n    ) {\r\n        let status = '';\r\n        const brsFailureStatus = student.failure\r\n            ? (student.failure as StudentFailure)\r\n            : StudentFailure.NoFailure;\r\n        const actualFailure = defaultStudentFailure;\r\n        if (actualFailure === brsFailureStatus) {\r\n            status = 'SKIPPED';\r\n        } else {\r\n            try {\r\n                if (this.options.save) {\r\n                    await this.brsApi.putStudentFailureAsync(\r\n                        student.studentUuid,\r\n                        discipline,\r\n                        actualFailure\r\n                    );\r\n                }\r\n                status = 'UPDATED';\r\n            } catch (error) {\r\n                status = 'FAILED';\r\n            }\r\n        }\r\n\r\n        if (this.options.verbose || status === 'FAILED') {\r\n            const studentName = (\r\n                student.studentFio + '                              '\r\n            ).substr(0, 30);\r\n            const description =\r\n                status !== 'SKIPPED'\r\n                    ? `${formatStudentFailure(\r\n                          actualFailure\r\n                      )} from ${formatStudentFailure(brsFailureStatus)}`\r\n                    : formatStudentFailure(actualFailure);\r\n            this.logger.log(`${status} ${studentName} ${description}`);\r\n        }\r\n        return status;\r\n    }\r\n\r\n    mergeStudents(actualStudents: ActualStudent[], brsStudents: StudentMark[]) {\r\n        const activeBrsStudents = brsStudents.filter(isStudentActive);\r\n\r\n        const mergedStudents: MergedStudent[] = [];\r\n        const skippedActualStudents: ActualStudent[] = [];\r\n        for (const actualStudent of actualStudents) {\r\n            const suitableStudents = activeBrsStudents.filter((brsStudent) =>\r\n                areStudentsLike(brsStudent, actualStudent)\r\n            );\r\n            if (suitableStudents.length === 1) {\r\n                mergedStudents.push({\r\n                    actual: actualStudent,\r\n                    brs: suitableStudents[0],\r\n                });\r\n            } else {\r\n                skippedActualStudents.push(actualStudent);\r\n            }\r\n        }\r\n\r\n        const skippedBrsStudents: StudentMark[] = [];\r\n        for (const brsStudent of activeBrsStudents) {\r\n            if (\r\n                !mergedStudents.some(\r\n                    (ms) => ms.brs.studentUuid === brsStudent.studentUuid\r\n                )\r\n            ) {\r\n                skippedBrsStudents.push(brsStudent);\r\n            }\r\n        }\r\n\r\n        return { mergedStudents, skippedActualStudents, skippedBrsStudents };\r\n    }\r\n\r\n    logMergedStudents(\r\n        mergedStudents: MergedStudent[],\r\n        skippedActualStudents: ActualStudent[],\r\n        skippedBrsStudents: StudentMark[]\r\n    ) {\r\n        this.logger.log(`Merged students = ${mergedStudents.length}`);\r\n        this.logger.log(\r\n            `Can't merge actual students = ${skippedActualStudents.length}`\r\n        );\r\n        for (const s of skippedActualStudents) {\r\n            this.logger.log('- ' + s.fullName);\r\n        }\r\n        this.logger.log(\r\n            `Can't merge BRS students = ${skippedBrsStudents.length}`\r\n        );\r\n        for (const s of skippedBrsStudents) {\r\n            this.logger.log('- ' + s.studentFio);\r\n        }\r\n    }\r\n}\r\n\r\nfunction isStudentActive(brsStudent: StudentMark) {\r\n    return (\r\n        brsStudent.studentStatus !== 'Переведен' &&\r\n        brsStudent.studentStatus !== 'Отчислен'\r\n    );\r\n}\r\n\r\nfunction areStudentsLike(\r\n    brsStudent: StudentMark,\r\n    actualStudent: ActualStudent\r\n) {\r\n    const brsFullName = fio.toKey(brsStudent.studentFio);\r\n    const actualFullName = fio.toKey(actualStudent.fullName);\r\n    return brsFullName.startsWith(actualFullName);\r\n}\r\n\r\nexport interface ControlActionConfig {\r\n    controlActions: string[];\r\n    matchIndex?: number;\r\n    matchCount?: number;\r\n    propertyIndex: number;\r\n}\r\n\r\nexport interface PutMarksOptions {\r\n    save: boolean;\r\n    verbose: boolean;\r\n}\r\n\r\ninterface MergedStudent {\r\n    actual: ActualStudent;\r\n    brs: StudentMark;\r\n}\r\n","import BrsApi, { Discipline, StudentFailure } from '../apis/brsApi';\r\nimport { compareNormalized } from '../helpers/tools';\r\nimport { Logger } from '../helpers/logger';\r\nimport { ActualStudent } from '../functions/readStudentsAsync';\r\nimport DisciplineMarksManager, {\r\n    ControlActionConfig,\r\n    PutMarksOptions,\r\n} from './DisciplineMarksManager';\r\n\r\nexport type { ControlActionConfig, PutMarksOptions };\r\n\r\nexport default class MarksManager {\r\n    private readonly brsApi: BrsApi;\r\n    private readonly logger: Logger;\r\n    private readonly disciplineMarksManager: DisciplineMarksManager;\r\n    private cancelPending: boolean = false;\r\n\r\n    constructor(brsApi: BrsApi, logger: Logger, options: PutMarksOptions) {\r\n        this.brsApi = brsApi;\r\n        this.logger = logger;\r\n        this.disciplineMarksManager = new DisciplineMarksManager(\r\n            brsApi,\r\n            logger,\r\n            options\r\n        );\r\n    }\r\n\r\n    cancel() {\r\n        this.cancelPending = true;\r\n    }\r\n\r\n    async putMarksToBrsAsync(marksData: MarksData) {\r\n        const {\r\n            actualStudents,\r\n            disciplineConfig,\r\n            controlActionConfigs,\r\n        } = marksData;\r\n\r\n        try {\r\n            const disciplines = await this.getSuitableDisciplinesAsync(\r\n                disciplineConfig\r\n            );\r\n\r\n            for (const discipline of disciplines) {\r\n                await this.disciplineMarksManager.putMarksForDisciplineAsync(\r\n                    discipline,\r\n                    actualStudents.filter((s) =>\r\n                        compareNormalized(s.groupName, discipline.group)\r\n                    ),\r\n                    disciplineConfig.defaultStudentFailure,\r\n                    controlActionConfigs\r\n                );\r\n                if (this.cancelPending) {\r\n                    break;\r\n                }\r\n            }\r\n        } catch (e) {\r\n            this.logger.error(e);\r\n        }\r\n    }\r\n\r\n    async getSuitableDisciplinesAsync(disciplineConfig: DisciplineConfig) {\r\n        const allDisciplines = await this.brsApi.getDisciplineCachedAsync(\r\n            disciplineConfig.year,\r\n            disciplineConfig.termType,\r\n            disciplineConfig.course,\r\n            disciplineConfig.isModule\r\n        );\r\n        const disciplines = allDisciplines.filter(\r\n            (d) =>\r\n                compareNormalized(d.discipline, disciplineConfig.name) &&\r\n                (!disciplineConfig.isSuitableDiscipline ||\r\n                    disciplineConfig.isSuitableDiscipline(d))\r\n        );\r\n        return disciplines;\r\n    }\r\n\r\n    getLogger() {\r\n        return this.logger;\r\n    }\r\n}\r\n\r\nexport interface MarksData {\r\n    actualStudents: ActualStudent[];\r\n    disciplineConfig: DisciplineConfig;\r\n    controlActionConfigs: ControlActionConfig[];\r\n}\r\n\r\nexport interface DisciplineConfig {\r\n    name: string;\r\n    year: number;\r\n    termType: number;\r\n    course: number;\r\n    isModule: boolean;\r\n    defaultStudentFailure: StudentFailure;\r\n    isSuitableDiscipline: ((d: Discipline) => boolean) | null;\r\n}\r\n","import React from 'react';\r\nimport {Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, Slide} from '@material-ui/core';\r\nimport {TransitionProps} from '@material-ui/core/transitions';\r\nimport {Redirect} from 'react-router-dom';\r\nimport BrsAuth from \"../apis/brsAuth\";\r\n\r\nconst Transition = React.forwardRef(function Transition(\r\n    props: TransitionProps & { children?: React.ReactElement<any, any> },\r\n    ref: React.Ref<unknown>,\r\n) {\r\n    return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\nexport default function SessionExpiredAlert({open, sessionName, brsAuth}: Props) {\r\n    const [redirect, setRedirect] = React.useState(false);\r\n\r\n    const handleOk = () => {\r\n        brsAuth.logout();\r\n        setRedirect(true);\r\n    };\r\n\r\n    return (\r\n        <React.Fragment>\r\n            {redirect && <Redirect to=\"/brs-extensions\"/>}\r\n            <Dialog\r\n                open={open}\r\n                TransitionComponent={Transition}\r\n                keepMounted\r\n                aria-labelledby=\"alert-dialog-slide-title\"\r\n                aria-describedby=\"alert-dialog-slide-description\">\r\n                <DialogTitle id=\"alert-dialog-slide-title\">Необходимо авторизоваться</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText id=\"alert-dialog-slide-description\">\r\n                        Кажется, действие сессии {sessionName} истекло. Необходимо повторно авторизоваться.\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions style={{display: 'flex', justifyContent: 'space-around'}}>\r\n                    <Button onClick={handleOk} color=\"primary\">Ок</Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </React.Fragment>\r\n    );\r\n}\r\n\r\ninterface Props {\r\n    open: boolean;\r\n    sessionName: string;\r\n    brsAuth: BrsAuth;\r\n}\r\n","const CLIENT_ID = '122993083593-pacve8csj86voko30ia65raeg0ncrtuv.apps.googleusercontent.com';\r\nconst DISCOVERY_DOCS = [\"https://sheets.googleapis.com/$discovery/rest?version=v4\"];\r\nconst SCOPES = \"https://www.googleapis.com/auth/spreadsheets\";\r\n\r\nconst googleAuth = {\r\n    async init() {\r\n        // @ts-ignore\r\n        if (gapi.client)\r\n            return;\r\n        return new Promise(resolve => {\r\n            gapi.load('client:auth2', async () => {\r\n                await gapi.client.init({\r\n                    clientId: CLIENT_ID,\r\n                    discoveryDocs: DISCOVERY_DOCS,\r\n                    scope: SCOPES\r\n                }).catch(console.error);\r\n                resolve();\r\n            });\r\n        });\r\n    },\r\n\r\n    checkAuthorized() {\r\n        // @ts-ignore\r\n        return gapi.auth2?.getAuthInstance()?.isSignedIn?.get();\r\n    },\r\n};\r\n\r\nexport default googleAuth;\r\n","export class Logger {\r\n    private logHandlers?: ((message: string) => void)[];\r\n    private errorHandlers?: ((errorMessage: string) => void)[];\r\n\r\n    addLogHandler(logHandler: ((message: string) => void)) {\r\n        if (!this.logHandlers)\r\n            this.logHandlers = [];\r\n        this.logHandlers.push(logHandler);\r\n    }\r\n\r\n    removeLogHandler(logHandler: ((message: string) => void)) {\r\n        if (!this.logHandlers)\r\n            return;\r\n        this.logHandlers = this.logHandlers.filter(h => h !== logHandler);\r\n    }\r\n\r\n    addErrorHandler(errorHandler: (errorMessage: string) => void) {\r\n        if (!this.errorHandlers)\r\n            this.errorHandlers = [];\r\n        this.errorHandlers.push(errorHandler);\r\n    }\r\n\r\n    removeErrorHandler(errorHandler: ((errorMessage: string) => void)) {\r\n        if (!this.errorHandlers)\r\n            return;\r\n        this.errorHandlers = this.errorHandlers.filter(h => h !== errorHandler);\r\n    }\r\n\r\n    log(message: string) {\r\n        if (!this.logHandlers)\r\n            return;\r\n        for (const logHandler of this.logHandlers)\r\n            logHandler(message);\r\n    }\r\n\r\n    error(errorMessage: string) {\r\n        if (!this.errorHandlers)\r\n            return;\r\n        for (const errorHandler of this.errorHandlers)\r\n            errorHandler(errorMessage);\r\n    }\r\n}\r\n","import {Button, Collapse, Grid} from \"@material-ui/core\";\r\nimport React from \"react\";\r\n\r\nexport default function ({show, onRunWorkSafe, onRunWorkUnsafe}: Props) {\r\n    return (\r\n        <Collapse in={show}>\r\n            <Grid container justify=\"space-around\">\r\n                <Grid item>\r\n                    <Button variant=\"contained\"\r\n                            onClick={onRunWorkSafe}\r\n                            color=\"primary\">\r\n                        Попробуй сделать хорошо\r\n                    </Button>\r\n                </Grid>\r\n                <Grid item>\r\n                    <Button variant=\"contained\"\r\n                            onClick={onRunWorkUnsafe}\r\n                            color=\"secondary\">\r\n                        Сделай хорошо\r\n                    </Button>\r\n                </Grid>\r\n            </Grid>\r\n        </Collapse>\r\n    );\r\n}\r\n\r\ninterface Props {\r\n    show: boolean;\r\n    onRunWorkSafe: () => void;\r\n    onRunWorkUnsafe: () => void;\r\n}\r\n","import React from 'react';\r\nimport {Container,} from \"@material-ui/core\";\r\nimport DisciplinesFetch from \"../DisciplinesFetch\";\r\nimport SpreadsheetFetch from \"../spreadsheetFetch\";\r\nimport WorkerDialog from \"../WorkerDialog\";\r\nimport MarksManager, {MarksData, PutMarksOptions} from \"../../marksActions/MarksManager\";\r\nimport BrsApi from \"../../apis/brsApi\";\r\nimport SessionExpiredAlert from \"../SessionExpiredAlert\";\r\nimport CustomAlert from \"../CustomAlert\";\r\nimport googleAuth from \"../../apis/googleAuth\";\r\nimport {Logger} from \"../../helpers/logger\";\r\nimport BrsAuth from \"../../apis/brsAuth\";\r\nimport RunWorkerButtons from \"../RunWorkerButtons\";\r\nimport {StatusCode} from \"../../helpers/CustomError\";\r\n\r\nexport default class WorkPage extends React.Component<Props, State> {\r\n    marksData: MarksData;\r\n    marksManager: MarksManager\r\n\r\n    constructor(props: Props) {\r\n        super(props);\r\n\r\n        this.marksData = {} as any;\r\n        this.marksManager = {} as any;\r\n\r\n        this.state = {\r\n            showControls: false,\r\n            runWork: false,\r\n            openSessionExpiredAlert: false,\r\n            sessionName: '',\r\n            errorMessage: '',\r\n        }\r\n\r\n    }\r\n\r\n    async componentDidMount() {\r\n        await googleAuth.init();\r\n\r\n        const brsAuthorized = this.props.brsAuth.checkAuth();\r\n        const googleAuthorized = googleAuth.checkAuthorized();\r\n\r\n        if (!brsAuthorized)\r\n            this.handleSessionExpired(\"БРС\");\r\n        else if (!googleAuthorized)\r\n            this.handleSessionExpired(\"Google\");\r\n    }\r\n\r\n    handleDataLoaded = (data: MarksData) => {\r\n        this.marksData = data;\r\n        this.setState({showControls: true});\r\n    }\r\n\r\n    runWork = (save: boolean) => {\r\n        const logger = new Logger();\r\n        logger.addErrorHandler(this.handleError);\r\n\r\n        const options: PutMarksOptions = {save, verbose: true};\r\n\r\n        const brsAuth: BrsAuth = this.props.brsAuth;\r\n        const brsApi = new BrsApi(brsAuth, brsAuth.brsUrlProvider);\r\n        this.marksManager = new MarksManager(brsApi, logger, options);\r\n\r\n        this.setState({runWork: true});\r\n    }\r\n\r\n    handleRunWorkSafe = () => {\r\n        this.runWork(false);\r\n    }\r\n\r\n    handleRunWorkUnsafe = () => {\r\n        this.runWork(true);\r\n    }\r\n\r\n    handleClosed = () => {\r\n        this.setState({runWork: false});\r\n    }\r\n\r\n    handleSessionExpired = (sessionName: string) => {\r\n        this.setState({openSessionExpiredAlert: true, sessionName});\r\n    }\r\n\r\n    handleError = (error: any) => {\r\n        const errorMessage: string = error.message || JSON.stringify(error);\r\n        if (error.statusCode)\r\n            if (error.statusCode === StatusCode.BrsUnauthorized)\r\n                this.handleSessionExpired(\"БРС\");\r\n            else\r\n                this.handleSessionExpired(\"Google\");\r\n        else if (error.name === \"RequestError\")\r\n            this.setState({errorMessage: \"В данный момент сервер недоступен. Попробуйте позже.\"});\r\n        else\r\n            this.setState({errorMessage});\r\n    }\r\n\r\n    closeError = () => {\r\n        this.setState({errorMessage: ''})\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <React.Fragment>\r\n                {this.state.openSessionExpiredAlert && <SessionExpiredAlert brsAuth={this.props.brsAuth}\r\n                                                                            sessionName={this.state.sessionName}\r\n                                                                            open={this.state.openSessionExpiredAlert}/>}\r\n                {this.state.errorMessage && <CustomAlert open={!!this.state.errorMessage}\r\n                                                         message={this.state.errorMessage}\r\n                                                         type={'error'}\r\n                                                         onClose={this.closeError}/>}\r\n                <div className=\"work-page\">\r\n                    <Container maxWidth=\"md\">\r\n                        <DisciplinesFetch brsApi={this.props.brsApi}\r\n                                          onError={this.handleError}/>\r\n                        <hr/>\r\n                        <SpreadsheetFetch onDataLoaded={this.handleDataLoaded}\r\n                                          onError={this.handleError}/>\r\n                        <br/>\r\n                        <RunWorkerButtons show={this.state.showControls}\r\n                                          onRunWorkUnsafe={this.handleRunWorkUnsafe}\r\n                                          onRunWorkSafe={this.handleRunWorkSafe}/>\r\n                        {\r\n                            this.state.runWork &&\r\n                            <WorkerDialog runWork={this.state.runWork}\r\n                                          marksData={this.marksData}\r\n                                          marksManager={this.marksManager}\r\n                                          onClosed={this.handleClosed}/>\r\n                        }\r\n                    </Container>\r\n                </div>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}\r\n\r\ninterface State {\r\n    showControls: boolean;\r\n    openSessionExpiredAlert: boolean;\r\n    sessionName: string;\r\n    errorMessage: string;\r\n    runWork: boolean;\r\n}\r\n\r\ninterface Props {\r\n    brsAuth: BrsAuth;\r\n    brsApi: BrsApi;\r\n}\r\n","import React from \"react\";\r\nimport Context from \"../../Context\";\r\nimport WorkPage from \"./WorkPage\";\r\n\r\nexport default function () {\r\n    return (\r\n        <Context.Consumer>\r\n            {\r\n                context => <WorkPage brsAuth={context.brsAuth} brsApi={context.brsApi}/>\r\n            }\r\n        </Context.Consumer>\r\n    );\r\n}\r\n","import React from 'react';\r\nimport {BrowserRouter, Route, Switch} from 'react-router-dom';\r\nimport BrsUrlProvider from \"./apis/brsUrlProvider\";\r\nimport BrsAuth from \"./apis/brsAuth\";\r\nimport LoginPageWrapper from \"./components/loginPage/LoginPageWrapper\";\r\nimport WorkPageWrapper from \"./components/workPage/WorkPageWrapper\";\r\nimport BrsApi from \"./apis/brsApi\";\r\nimport Context from './Context';\r\n\r\nconst urlProvider = new BrsUrlProvider(true);\r\nconst brsAuth = new BrsAuth(urlProvider);\r\nconst brsApi = new BrsApi(brsAuth, urlProvider);\r\n\r\nexport default function App() {\r\n    return (\r\n        <Context.Provider value={{brsAuth, brsApi}}>\r\n            <BrowserRouter>\r\n                <Switch>\r\n                    <Route path=\"/brs-extensions/work\" component={WorkPageWrapper}/>\r\n                    <Route exact path=\"/brs-extensions\" component={LoginPageWrapper}/>\r\n                </Switch>\r\n            </BrowserRouter>\r\n        </Context.Provider>\r\n    )\r\n}\r\n","import {ReportHandler} from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n    if (onPerfEntry && onPerfEntry instanceof Function) {\r\n        import('web-vitals').then(({getCLS, getFID, getFCP, getLCP, getTTFB}) => {\r\n            getCLS(onPerfEntry);\r\n            getFID(onPerfEntry);\r\n            getFCP(onPerfEntry);\r\n            getLCP(onPerfEntry);\r\n            getTTFB(onPerfEntry);\r\n        });\r\n    }\r\n}\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\n\r\nimport './index.css';\r\n\r\nReactDOM.render(\r\n    <React.StrictMode>\r\n        <App/>\r\n    </React.StrictMode>,\r\n    document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}