(this["webpackJsonpbrs-extensions"]=this["webpackJsonpbrs-extensions"]||[]).push([[0],{314:function(e,t){},316:function(e,t){},325:function(e,t){},327:function(e,t){},352:function(e,t){},354:function(e,t){},355:function(e,t){},360:function(e,t){},362:function(e,t){},368:function(e,t){},370:function(e,t){},389:function(e,t){},401:function(e,t){},404:function(e,t){},430:function(e,t){},525:function(e,t,n){},526:function(e,t,n){},531:function(e,t,n){},533:function(e,t,n){},534:function(e,t,n){},535:function(e,t,n){},540:function(e,t,n){},541:function(e,t,n){},542:function(e,t,n){"use strict";n.r(t);var r,a,s=n(0),i=n.n(s),c=n(18),o=n.n(c),u=n(120),l=n(27),d=n(22),p=n(20),h="https://docs.google.com/spreadsheets/d/1Owzl3JfmFASIdC7ZMMw-0kkA3pwFSab1QdVO5dhZoxY/edit#gid=675912523",f="https://brs.urfu.ru/mrd",b=function(){function e(t){Object(d.a)(this,e),this.withProxy=void 0,this.withProxy=t}return Object(p.a)(e,[{key:"baseUrl",get:function(){return this.withProxy?"".concat("https://bbamc5stve2edro7t455.containers.yandexcloud.net","/").concat(f):f}}]),e}(),v=n(3),g=n.n(v),m=n(7),j=n(103),x=n.n(j);function y(e,t,n){if(!t)return!1;var a=JSON.stringify(t);return n!==r.Local&&n!==r.LocalAndSession||localStorage.setItem(e,a),n!==r.Session&&n!==r.LocalAndSession||sessionStorage.setItem(e,a),!0}function k(e,t){var n,a=null;if(t===r.Local&&(a=localStorage.getItem(e)),t===r.Session&&(a=sessionStorage.getItem(e)),t===r.LocalAndSession&&(a=null!==(n=sessionStorage.getItem(e))&&void 0!==n?n:localStorage.getItem(e)),!a)return null;var s=JSON.parse(a);return s||null}function A(e,t){return t!==r.Local&&t!==r.LocalAndSession||localStorage.removeItem(e),t!==r.Session&&t!==r.LocalAndSession||sessionStorage.removeItem(e),!0}!function(e){e[e.Local=0]="Local",e[e.Session=1]="Session",e[e.LocalAndSession=2]="LocalAndSession"}(r||(r={})),function(e){e[e.BrsUnauthorized=1]="BrsUnauthorized",e[e.GoogleUnauthorized=2]="GoogleUnauthorized"}(a||(a={}));var O,S=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(d.a)(this,e),this.message=void 0,this.statusCode=void 0,this.statusCode=t,this.message=n};!function(e){e[e.Succeed=0]="Succeed",e[e.InvalidCredentials=1]="InvalidCredentials",e[e.Error=2]="Error"}(O||(O={}));var w=function(){function e(t){Object(d.a)(this,e),this.brsUrlProvider=void 0,this._sid=null,this._safeUserName=null,this._userName="Anonymous",this.brsUrlProvider=t}return Object(p.a)(e,[{key:"sid",get:function(){if(!this._sid)throw new S(a.BrsUnauthorized,"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0432 \u0411\u0420\u0421");return this._sid}},{key:"safeUserName",get:function(){if(!this._safeUserName)throw new S(a.BrsUnauthorized,"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u0432 \u0411\u0420\u0421");return this._safeUserName}},{key:"userName",get:function(){return this._userName}},{key:"checkAuth",value:function(){return!(!this._sid||!this._safeUserName)}},{key:"tryRestoreAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._sid||!this._safeUserName){e.next=2;break}return e.abrupt("return");case 2:if(!(t=k("loginInfo",r.Session))){e.next=6;break}return this.saveLoginInfo(t.sid,t.userName),e.abrupt("return");case 6:if(t=k("loginInfo",r.Local)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,this.checkSidAsync(t.sid);case 11:(null===(n=e.sent)||void 0===n?void 0:n.success)&&this.saveLoginInfo(t.sid,t.userName);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkSidAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var n,r;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x()({method:"GET",url:this.brsUrlProvider.baseUrl+"/mvc/mobile",headers:{"X-Cookie":"JSESSIONID=".concat(t),"X-Requested-With":"XMLHttpRequest"}});case 3:if(n=e.sent,!(r=n.match(/username">([\u0410-\u042f\u0401\u0430-\u044f\u0451 -]+)</))){e.next=7;break}return e.abrupt("return",{success:!0,userName:r[1]});case 7:return e.abrupt("return",{success:!1,userName:"Anonymous"});case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"loginAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n){var r,a,s,i,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.requestSidAsync(t,n);case 2:if((r=e.sent)&&"x-set-cookie"in r.headers){e.next=5;break}return e.abrupt("return",O.Error);case 5:if(a=r.headers["x-set-cookie"],s=a.match(/(?<=JSESSIONID=)\w+/)){e.next=9;break}return e.abrupt("return",O.Error);case 9:return i=s[0],e.next=12,this.checkSidAsync(i);case 12:if(null!==(c=e.sent)){e.next=15;break}return e.abrupt("return",O.Error);case 15:if(c.success){e.next=17;break}return e.abrupt("return",O.InvalidCredentials);case 17:return this.saveLoginInfo(i,c.userName),e.abrupt("return",O.Succeed);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"authBySidAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",O.InvalidCredentials);case 2:return e.next=4,this.checkSidAsync(t);case 4:if(null!==(n=e.sent)){e.next=7;break}return e.abrupt("return",O.Error);case 7:if(n.success){e.next=9;break}return e.abrupt("return",O.InvalidCredentials);case 9:return this.saveLoginInfo(t,n.userName),e.abrupt("return",O.Succeed);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveLoginInfo",value:function(e,t){var n=t.replaceAll(/[^A-Za-z\u0410-\u042f\u0401\u0430-\u044f\u0451]/g,"_");y("loginInfo",{sid:e,safeUserName:n,userName:t},r.LocalAndSession),this._sid=e,this._safeUserName=n,this._userName=t}},{key:"logout",value:function(){this._sid=null,this._safeUserName=null,A("loginInfo",r.LocalAndSession)}},{key:"requestSidAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x()({url:this.brsUrlProvider.baseUrl+"/login",method:"POST",body:"username=".concat(t,"&password=").concat(n),resolveWithFullResponse:!0,simple:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then((function(e){return e}),(function(){return null}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),C=["https://sheets.googleapis.com/$discovery/rest?version=v4"],N=function(){function e(){Object(d.a)(this,e)}return Object(p.a)(e,[{key:"ensureInitializedAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!gapi.client){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,new Promise((function(e){gapi.load("client:auth2",e)}));case 4:gapi.client.init({clientId:"122993083593-pacve8csj86voko30ia65raeg0ncrtuv.apps.googleusercontent.com",discoveryDocs:C,scope:"profile email https://www.googleapis.com/auth/spreadsheets"}).catch(console.error);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"listenAuthorized",value:function(e){var t,n,r;null===(t=gapi.auth2)||void 0===t||null===(n=t.getAuthInstance())||void 0===n||null===(r=n.isSignedIn)||void 0===r||r.listen(e)}},{key:"checkAuthorized",value:function(){var e,t,n;return null===(e=gapi.auth2)||void 0===e||null===(t=e.getAuthInstance())||void 0===t||null===(n=t.isSignedIn)||void 0===n?void 0:n.get()}},{key:"getUserName",value:function(){var e,t,n,r,a=null===(e=gapi.auth2)||void 0===e||null===(t=e.getAuthInstance())||void 0===t||null===(n=t.currentUser)||void 0===n||null===(r=n.get())||void 0===r?void 0:r.getBasicProfile();return(null===a||void 0===a?void 0:a.getName())||(null===a||void 0===a?void 0:a.getEmail())}},{key:"logout",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=gapi.auth2)||void 0===t||null===(n=t.getAuthInstance())||void 0===n?void 0:n.signOut();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),I=Object(s.createContext)(null),M=n(50),F=n(67),L=(n(525),n(574)),D=n(582),T=n(26),U=n(597),E=n(578),W=(n(526),n(2));function R(e){var t=e.title,n=e.loading,r=e.className,a=e.onClick,s=e.disabled,i=void 0!==s&&s;return Object(W.jsxs)("div",{className:"submit-with-loading "+r,children:[Object(W.jsx)(L.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",onClick:a,disabled:n||i,children:t}),n&&Object(W.jsx)(E.a,{color:"secondary",size:24,className:"button-progress"})]})}n(531);function P(e){var t=e.onSubmit,n=e.submitting,r=e.loading,a=e.signedIn,s=e.onLogout,c=e.userName,o=i.a.useState(""),u=Object(T.a)(o,2),l=u[0],d=u[1],p=i.a.useState(""),h=Object(T.a)(p,2),f=h[0],b=h[1],v=i.a.useState(""),g=Object(T.a)(v,2),m=g[0],j=g[1];return a?Object(W.jsxs)(i.a.Fragment,{children:[Object(W.jsxs)("p",{children:["\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c, ",c]}),Object(W.jsx)(L.a,{type:"button",fullWidth:!0,variant:"contained",onClick:s,color:"primary",children:"\u0412\u044b\u0439\u0442\u0438 \u0438\u0437 \u0411\u0420\u0421"})]}):Object(W.jsxs)("div",{className:"brs-login-form",children:[Object(W.jsxs)("p",{children:[Object(W.jsx)("b",{children:"\u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0411\u0420\u0421"}),", \u0447\u0442\u043e\u0431\u044b \u0441\u0435\u0440\u0432\u0438\u0441 \u043c\u043e\u0433 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0432\u0430\u0448\u0438\u0445 \u043a\u0443\u0440\u0441\u0430\u0445 \u0438 \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u044f\u0442\u044c \u043e\u0446\u0435\u043d\u043a\u0438 \u043e\u0442 \u0432\u0430\u0448\u0435\u0433\u043e \u0438\u043c\u0435\u043d\u0438"]}),Object(W.jsx)("p",{children:"\u042d\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0447\u0435\u0440\u0435\u0437 \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c \u0411\u0420\u0421"}),Object(W.jsxs)("form",{className:"form",onSubmit:function(e){e.preventDefault(),r||t({login:l,password:f,sid:m})},children:[Object(W.jsx)(U.a,{className:"form-component",variant:"outlined",margin:"normal",fullWidth:!0,id:"username",label:"\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",name:"username",autoFocus:!0,value:l,disabled:r,onChange:function(e){var t=e.target.value;d(t),j("")}}),Object(W.jsx)(U.a,{className:"form-component",variant:"outlined",margin:"normal",fullWidth:!0,name:"password",label:"\u041f\u0430\u0440\u043e\u043b\u044c",type:"password",id:"password",autoComplete:"current-password",value:f,disabled:r,onChange:function(e){var t=e.target.value;b(t),j("")}}),Object(W.jsx)("p",{className:"form-component text-align-center",children:"\u0438\u043b\u0438 \u0447\u0435\u0440\u0435\u0437 JSESSIONID \u043f\u0440\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0438 \u0435\u0434\u0438\u043d\u043e\u0439 \u0443\u0447\u0435\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0438\u0441\u0438 \u0423\u0440\u0424\u0423"}),Object(W.jsx)(U.a,{className:"form-component",variant:"outlined",margin:"normal",fullWidth:!0,name:"sid",label:"JSESSIONID",type:"password",id:"sid",value:m,disabled:r,onChange:function(e){var t=e.target.value;j(t),d(""),b("")}}),Object(W.jsx)("a",{href:"https://docs.google.com/document/d/1btXePo-5bE8RyX7RFXnBuS-UN9SmwUithpc_UXhAWsg/edit",className:"button-link",target:"_blank",rel:"noreferrer",children:"\u041a\u0430\u043a \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c JSESSIONID"}),Object(W.jsx)(R,{className:"vertical-margin-medium",title:"\u0432\u043e\u0439\u0442\u0438",loading:n,disabled:r})]}),r&&Object(W.jsx)(E.a,{color:"primary",size:150,className:"progress"})]})}var _=n(269),B=n.n(_);function z(e){var t=e.onSignedIn,n=e.onFailure,r=e.signedIn,a=e.userName,s=e.onLogout;return Object(W.jsx)(i.a.Fragment,{children:r?Object(W.jsxs)(D.a,{className:"text-align-center",children:[Object(W.jsxs)("p",{children:["\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c, ",a]}),Object(W.jsx)(L.a,{type:"button",fullWidth:!0,variant:"contained",onClick:s,color:"primary",children:"\u0412\u044b\u0439\u0442\u0438 \u0438\u0437 Google"})]}):Object(W.jsxs)(D.a,{className:"text-align-center",children:[Object(W.jsxs)("p",{children:[Object(W.jsx)("b",{children:"\u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 Google"}),", \u0447\u0442\u043e\u0431\u044b \u0441\u0435\u0440\u0432\u0438\u0441 \u043c\u043e\u0433 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u043e\u0446\u0435\u043d\u043a\u0438 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432 \u0438\u0437 \u0432\u0430\u0448\u0438\u0445 Google\xa0\u0422\u0430\u0431\u043b\u0438\u0446"]}),Object(W.jsx)(B.a,{clientId:"122993083593-pacve8csj86voko30ia65raeg0ncrtuv.apps.googleusercontent.com",buttonText:"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 Google",onSuccess:t,onFailure:n,scope:"profile email https://www.googleapis.com/auth/spreadsheets",isSignedIn:!0})]})})}var G=n(54),J=n(598),q=n(600);function X(e){var t=e.open,n=e.message,r=e.type,a=e.onClose;return Object(W.jsx)(i.a.Fragment,{children:Object(W.jsx)(q.a,{open:t,autoHideDuration:1e4,anchorOrigin:{vertical:"top",horizontal:"center"},onClose:a,children:Object(W.jsx)(H,{severity:r,onClose:a,children:n})})})}function H(e){return Object(W.jsx)(J.a,Object(G.a)({elevation:6,variant:"filled"},e))}var V=function(e){Object(M.a)(n,e);var t=Object(F.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).handleBrsSubmit=function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.setState({submitLoading:!0}),e.next=3,r.loginBrsAsync(t);case 3:n=e.sent,r.setState({submitLoading:!1}),e.t0=n,e.next=e.t0===O.Succeed?8:e.t0===O.Error?10:e.t0===O.InvalidCredentials?12:13;break;case 8:return r.setState({alertMessage:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e",openAlert:!0,alertType:"success",brsAuthorized:!0}),e.abrupt("break",13);case 10:return r.setState({alertMessage:"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a :( \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435",openAlert:!0,alertType:"error"}),e.abrupt("break",13);case 12:r.setState({alertMessage:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0435 \u043b\u043e\u0433\u0438\u043d, \u043f\u0430\u0440\u043e\u043b\u044c \u0438\u043b\u0438 JSESSIONID",openAlert:!0,alertType:"error"});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.loginBrsAsync=function(){var e=Object(m.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.sid){e.next=4;break}return e.next=3,r.props.brsAuth.authBySidAsync(t.sid);case 3:return e.abrupt("return",e.sent);case 4:if(!t.login||!t.password){e.next=8;break}return e.next=7,r.props.brsAuth.loginAsync(t.login,t.password);case 7:return e.abrupt("return",e.sent);case 8:return e.abrupt("return",O.InvalidCredentials);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleCloseAlert=function(){r.setState({openAlert:!1})},r.handleGoogleSignedIn=function(){r.setState({googleAuthorized:!0})},r.handleGoogleLoginFailed=function(e){console.error(e),r.setState({openAlert:!0,alertType:"error",alertMessage:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0412\u0430\u0448 Google \u0430\u043a\u043a\u0430\u0443\u043d\u0442 :("})},r.startWork=function(){r.setState({redirect:!0})},r.handleBrsLogout=function(){r.props.brsAuth.logout(),r.setState({brsAuthorized:!1,alertMessage:"\u0412\u044b \u0432\u044b\u0448\u043b\u0438 \u0438\u0437 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 \u0411\u0420\u0421",alertType:"success",openAlert:!0})},r.handleGoogleLogout=Object(m.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.props.googleAuth.logout();case 2:r.setState({googleAuthorized:!1,alertType:"success",alertMessage:"\u0412\u044b \u0432\u044b\u0448\u043b\u0438 \u0438\u0437 \u0430\u043a\u043a\u0430\u0443\u043d\u0442\u0430 Google",openAlert:!0});case 3:case"end":return e.stop()}}),e)}))),r.renderGreeting=function(){return Object(W.jsxs)("div",{className:"greeting",children:[Object(W.jsx)("h2",{children:"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0432 \u0420\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u044f \u0411\u0420\u0421"}),Object(W.jsx)("h3",{className:"block-header",children:"\u041a\u0430\u043a \u0432\u0441\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442"}),Object(W.jsxs)("ol",{children:[Object(W.jsxs)("li",{children:["\u0412 Google\xa0\u0422\u0430\u0431\u043b\u0438\u0446\u0430\u0445 \u0432\u044b \u0437\u0430\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0435 \u043e\u0446\u0435\u043d\u043a\u0438 \u0437\u0430 \u043a\u0443\u0440\u0441 \u043f\u043e \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443"," ",Object(W.jsx)("a",{href:h,target:"_blank",rel:"noreferrer",className:"button-link",children:"\u0448\u0430\u0431\u043b\u043e\u043d\u0443"})]}),Object(W.jsx)("li",{children:"\u041f\u043e\u0441\u043b\u0435 \u044d\u0442\u043e\u0433\u043e \u0438\u043c\u043f\u043e\u0440\u0442\u0438\u0440\u0443\u0435\u0442\u0435 Google \u0422\u0430\u0431\u043b\u0438\u0446\u0443 \u0432 \u0441\u0435\u0440\u0432\u0438\u0441 \u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0435 \u043f\u0440\u043e\u0431\u043d\u044b\u0439 \u0437\u0430\u043f\u0443\u0441\u043a \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0446\u0435\u043d\u043e\u043a, \u0447\u0442\u043e\u0431\u044b \u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0438"}),Object(W.jsx)("li",{children:"\u041d\u0430\u043a\u043e\u043d\u0435\u0446 \u0434\u0435\u043b\u0430\u0435\u0442\u0435 \u0437\u0430\u043f\u0443\u0441\u043a \u0441 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u043c \u0432\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435\u043c \u043e\u0446\u0435\u043d\u043e\u043a"})]}),Object(W.jsx)("h3",{className:"block-header",children:"\u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445"}),Object(W.jsxs)("p",{children:["\u0412\u0430\u0448 \u043b\u043e\u0433\u0438\u043d \u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043f\u0435\u0440\u0435\u0434\u0430\u044e\u0442\u0441\u044f \u0432 \u0411\u0420\u0421 \u0438 \u043d\u0438\u0433\u0434\u0435 \u043d\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044e\u0442\u0441\u044f",Object(W.jsx)("br",{}),"\u0414\u0430\u043d\u043d\u044b\u0435 \u043e \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0432\u0430\u043c \u043a\u0443\u0440\u0441\u0430\u0445 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u044e\u0442\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0432\u0430\u0448\u0435\u043c \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0435"]}),Object(W.jsx)("hr",{})]})},r.renderBrsLogin=function(){return Object(W.jsx)(P,{onSubmit:r.handleBrsSubmit,loading:r.state.brsLoading,signedIn:r.state.brsAuthorized,onLogout:r.handleBrsLogout,userName:r.props.brsAuth.userName,submitting:r.state.submitLoading})},r.renderGoogleLogin=function(){return Object(W.jsx)(z,{onSignedIn:r.handleGoogleSignedIn,signedIn:r.state.googleAuthorized,userName:r.props.googleAuth.getUserName(),onLogout:r.handleGoogleLogout,onFailure:r.handleGoogleLoginFailed})},r.renderStartWorkButton=function(){return Object(W.jsx)(L.a,{variant:"contained",onClick:r.startWork,disabled:!r.state.brsAuthorized||!r.state.googleAuthorized,color:"secondary",children:"\u043d\u0430\u0447\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443"})},r.state={brsLoading:!0,brsAuthorized:!1,googleAuthorized:!1,redirect:!1,submitLoading:!1,openAlert:!1,alertMessage:"",alertType:"error"},r}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t,n,r=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.googleAuth.ensureInitializedAsync();case 2:return e.next=4,this.props.brsAuth.tryRestoreAsync();case 4:this.props.googleAuth.listenAuthorized((function(e){r.setState({googleAuthorized:e})})),t=this.props.brsAuth.checkAuth(),n=this.props.googleAuth.checkAuthorized(),this.setState({brsLoading:!1,brsAuthorized:t,googleAuthorized:n});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(W.jsxs)("div",{className:"login-page",children:[this.state.redirect&&Object(W.jsx)(l.a,{to:"/work"}),Object(W.jsxs)(D.a,{component:"main",maxWidth:"md",children:[this.renderGreeting(),Object(W.jsxs)(D.a,{maxWidth:"xs",children:[Object(W.jsx)(D.a,{children:this.renderBrsLogin()}),Object(W.jsx)("hr",{className:"vertical-margin-medium"}),Object(W.jsx)(D.a,{children:this.renderGoogleLogin()})]}),Object(W.jsx)(D.a,{className:"text-align-center vertical-margin-large",children:this.renderStartWorkButton()}),Object(W.jsx)(X,{open:this.state.openAlert,message:this.state.alertMessage,type:this.state.alertType,onClose:this.handleCloseAlert})]})]})}}]),n}(i.a.Component);function Z(){return Object(W.jsx)(I.Consumer,{children:function(e){return e&&Object(W.jsx)(V,{brsAuth:e.brsAuth,googleAuth:e.googleAuth})}})}var K,Y,Q=n(35),$=n(21);n(175);!function(e){e[e.NoFailure=-1]="NoFailure",e[e.NotChosen=-19]="NotChosen",e[e.NotAllowedByDeansOffice=-18]="NotAllowedByDeansOffice",e[e.NotAppeared=0]="NotAppeared",e[e.DisrespectfulReason=12]="DisrespectfulReason",e[e.RespectfulReason=13]="RespectfulReason",e[e.NotAllowedByTeacher=18]="NotAllowedByTeacher",e[e.ShouldNotPass=19]="ShouldNotPass",e[e.AcademicLeave=20]="AcademicLeave",e[e.DroppedOut=21]="DroppedOut"}(K||(K={})),function(e){e[e.Fall=1]="Fall",e[e.Spring=2]="Spring"}(Y||(Y={}));var ee=function(){function e(t,n){Object(d.a)(this,e),this.brsAuth=void 0,this.brsUrlProvider=void 0,this.brsAuth=t,this.brsUrlProvider=n}return Object(p.a)(e,[{key:"getDisciplineCachedAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,a,s){var i,c,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.getDisciplineCacheName(t,n,a,s),!(c=k(i,r.Session))){e.next=4;break}return e.abrupt("return",c);case 4:return e.next=6,this.getDisciplineTotalAsync(t,n,a,s);case 6:return o=e.sent,e.next=9,this.getDisciplineInternalAsync(t,n,a,s,1,Math.max(1e3,o),o);case 9:return u=e.sent,y(i,u.disciplines,r.Session),e.abrupt("return",u.disciplines);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getDisciplineInternalAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s,i,c){var o,u,l,d,p,h,f,b,v;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="?year=".concat(t,"&termType=").concat(n,"&course=").concat(r,"&total=").concat(c,"&page=").concat(s,"&pageSize=").concat(i,"&search="),!a){e.next=11;break}return e.next=4,this.requestApiJsonAsync("/mvc/mobile/module/fetch"+o);case 4:u=e.sent,l=u.content,d=Object(Q.a)(l);try{for(d.s();!(p=d.n()).done;)p.value.isModule=!0}catch(g){d.e(g)}finally{d.f()}return e.abrupt("return",{disciplines:l,numberOfElements:u.numberOfElements});case 11:return e.next=13,this.requestApiJsonAsync("/mvc/mobile/discipline/fetch"+o);case 13:h=e.sent,f=h.content,b=Object(Q.a)(f);try{for(b.s();!(v=b.n()).done;)v.value.isModule=!1}catch(g){b.e(g)}finally{b.f()}return e.abrupt("return",{disciplines:f,numberOfElements:h.numberOfElements});case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i,c){return e.apply(this,arguments)}}()},{key:"clearDisciplineCacheAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,a,s){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(this.getDisciplineCacheName(t,n,a,s),r.Session);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getDisciplineTotalAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a){var s,i,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a?"&its=true":"",i="?year=".concat(t,"&termType=").concat(n,"&course=").concat(r)+s,e.next=4,this.requestApiJsonAsync("/mvc/mobile/discipline/amount"+i);case 4:return c=e.sent,e.abrupt("return",c);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getAllStudentMarksAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var n,r,a,s,i,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=$.a,e.next=4,this.getStudentMarksAsync(t,"lecture","current");case 4:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=$.a,e.next=9,this.getStudentMarksAsync(t,"lecture","intermediate");case 9:return e.t5=e.sent,e.t6=(0,e.t4)(e.t5),e.t7=$.a,e.next=14,this.getStudentMarksAsync(t,"laboratory","current");case 14:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t10=$.a,e.next=19,this.getStudentMarksAsync(t,"laboratory","intermediate");case 19:return e.t11=e.sent,e.t12=(0,e.t10)(e.t11),e.t13=$.a,e.next=24,this.getStudentMarksAsync(t,"practice","current");case 24:return e.t14=e.sent,e.t15=(0,e.t13)(e.t14),e.t16=$.a,e.next=29,this.getStudentMarksAsync(t,"practice","intermediate");case 29:return e.t17=e.sent,e.t18=(0,e.t16)(e.t17),e.t19=$.a,e.next=34,this.getStudentMarksAsync(t,"additionalPractice","current");case 34:return e.t20=e.sent,e.t21=(0,e.t19)(e.t20),e.t22=$.a,e.next=39,this.getStudentMarksAsync(t,"additionalPractice","intermediate");case 39:e.t23=e.sent,e.t24=(0,e.t22)(e.t23),n=e.t0.concat.call(e.t0,e.t3,e.t6,e.t9,e.t12,e.t15,e.t18,e.t21,e.t24),r={},a=Object(Q.a)(n);try{for(a.s();!(s=a.n()).done;)i=s.value,c=r[i.studentUuid]||{},r[i.studentUuid]=Object(G.a)(Object(G.a)({},c),i)}catch(o){a.e(o)}finally{a.f()}return e.abrupt("return",Object.keys(r).map((function(e){return r[e]})));case 46:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStudentMarksAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getStudentMarksInternalAsync(t.disciplineLoad,t.isModule,t.groupHistoryId,t.groupId,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getStudentMarksInternalAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s,i){var c,o,u,l=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=l.length>6&&void 0!==l[6]&&l[6],o=l.length>7&&void 0!==l[7]&&l[7],u=n?"techgroup=".concat(a):"groupUuid=".concat(r),e.abrupt("return",this.requestApiJsonAsync("/mvc/mobile/studentMarks/fetch?disciplineLoad=".concat(t,"&").concat(u)+"&cardType=".concat(s,"&hasTest=false&isTotal=").concat(c)+"&intermediate=".concat("intermediate"===i)+"&selectedTeachers=null&showActiveStudents=".concat(o)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()},{key:"getDisciplineMetaAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={lecture:null,laboratory:null,practice:null,additionalPractice:null},e.next=3,this.fillCardMetaAsync(n,t,"lecture");case 3:return e.next=5,this.fillCardMetaAsync(n,t,"laboratory");case 5:return e.next=7,this.fillCardMetaAsync(n,t,"practice");case 7:return e.next=9,this.fillCardMetaAsync(n,t,"additionalPractice");case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fillCardMetaAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r){var a,s,i,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getControlActionColumnsCachedAsync(n,r,"current");case 2:return a=e.sent,e.next=5,this.getControlActionColumnsCachedAsync(n,r,"intermediate");case 5:if(s=e.sent,a.length+s.length!==0){e.next=8;break}return e.abrupt("return");case 8:return i={currentControlActions:this.extractControlActions(a),currentFactor:0,intermediateControlActions:this.extractControlActions(s),intermediateFactor:0,totalFactor:0},this.fillFactors(i,a),this.fillFactors(i,s),t[r]=i,e.next=14,this.getControlActionColumnsCachedAsync(n,r,"total");case 14:c=e.sent,this.fillTotalFactors(t,c);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getControlActionColumnsCachedAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,a){var s,i,c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="".concat(this.brsAuth.safeUserName,"_getControlActionColumns_").concat(t.disciplineLoad)+"_".concat(t.isModule,"_").concat(t.groupHistoryId,"_").concat(t.groupId,"_").concat(n,"_").concat(a),!(i=k(s,r.Session))){e.next=4;break}return e.abrupt("return",i);case 4:return e.next=6,this.getControlActionColumnsInternalAsync(t.disciplineLoad,t.isModule,t.groupHistoryId,t.groupId,n,a);case 6:return c=e.sent,y(s,c,r.Session),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getControlActionColumnsInternalAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s,i){var c,o,u,l,d,p,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n?"/module":"",o=n?a:r,e.next=4,this.requestApiAsync("/mvc/mobile/view/mark/".concat(t,"/").concat(o,"/teachers").concat(c,"/").concat(s,"/").concat(i));case 4:if(u=e.sent,l="gridColumns = toTextArray(",d=");",1===(p=u.split("\r\n").map((function(e){return e.trim()})).filter((function(e){return e.startsWith(l)}))).length){e.next=10;break}throw new Error("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0440\u0430\u0437\u043e\u0431\u0440\u0430\u0442\u044c \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0411\u0420\u0421 \u0441\u043e \u0441\u043f\u0438\u0441\u043a\u043e\u043c \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0439. \u041e\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044f, \u0447\u0442\u043e \u044d\u0442\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0435\u0434\u0438\u043d\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u0441\u0442\u0440\u043e\u0447\u043a\u0443 \u0441 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0442\u043e\u0440\u043e\u043c \u0442\u0435\u0445\u043a\u0430\u0440\u0442\u044b.");case 10:return h=JSON.parse(p[0].substr(l.length,p[0].length-l.length-d.length))||[],e.abrupt("return",h);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()},{key:"extractControlActions",value:function(e){var t="technologyCard";return e.filter((function(e){return e.uuid&&e.uuid.startsWith(t)})).map((function(e){return{uuid:e.uuid,uuidWithoutPrefix:e.uuid.substr(t.length),maxValue:e.maxValue,isIntermediate:e.intermediate>0,controlAction:e.controlAction}}))}},{key:"fillFactors",value:function(e,t){var n,r=Object(Q.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;switch(a.uuid){case"currentWithFactor":e.currentFactor="string"===typeof a.value?parseFloat(a.value):a.value;break;case"intermediateWithFactor":e.intermediateFactor="string"===typeof a.value?parseFloat(a.value):a.value}}}catch(s){r.e(s)}finally{r.f()}}},{key:"fillTotalFactors",value:function(e,t){var n,r=Object(Q.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;switch(a.uuid){case"lecture":case"laboratory":case"practice":case"additionalPractice":var s=e[a.uuid];null!==s&&(s.totalFactor="string"===typeof a.value?parseFloat(a.value):a.value)}}}catch(i){r.e(i)}finally{r.f()}}},{key:"putStudentMarkAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s,i){var c;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c="student=".concat(t,"&techcard=").concat(n,"&mark=").concat(isNaN(r)?"":r.toString(),"&groupId=").concat(a,"&cardTypeKey=").concat(s,"&disciplineLoadUuid=").concat(i),e.abrupt("return",this.requestApiJsonAsync("/mvc/mobile/studentMarks/put",{method:"POST",body:c,json:!1},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()},{key:"putStudentFailureAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n){var r,a,s,i=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:K.NoFailure,a=i.length>3&&void 0!==i[3]?i[3]:"lecture",s="markFailure=".concat(r,"&cardType=").concat(a,"&disciplineLoad=").concat(n.disciplineLoad,"&studentId=").concat(t),e.next=5,this.requestApiAsync("/mvc/mobile/failure/update",{method:"POST",body:s,json:!1},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"});case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateAllMarksAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateMarksAsync(t,"lecture","intermediate");case 2:return e.next=4,this.updateMarksAsync(t,"lecture","current");case 4:return e.next=6,this.updateMarksAsync(t,"lecture","intermediate");case 6:return e.next=8,this.updateMarksAsync(t,"laboratory","current");case 8:return e.next=10,this.updateMarksAsync(t,"laboratory","intermediate");case 10:return e.next=12,this.updateMarksAsync(t,"practice","current");case 12:return e.next=14,this.updateMarksAsync(t,"practice","intermediate");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateMarksAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.updateMarksInternalAsync(t.disciplineLoad,t.isModule,t.groupHistoryId,t.groupId,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateMarksInternalAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s,i){var c,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n?"/module":"",o=n?"techgroup=".concat(a):"groupUuid=".concat(r),u="disciplineLoad=".concat(t,"&").concat(o)+"&cardType=".concat(s,"&hasTest=false&isTotal=false")+"&intermediate=".concat("intermediate"===i)+"&selectedTeachers=null&showActiveStudents=true",e.abrupt("return",this.requestApiAsync("/mvc/mobile/updateMarks".concat(c),{method:"POST",body:u,json:!1},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()},{key:"getDisciplineCacheName",value:function(e,t,n,r){return"".concat(this.brsAuth.safeUserName,"_getDiscipline_").concat(e,"_").concat(t,"_").concat(n,"_").concat(r)}},{key:"requestApiJsonAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r){var a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.requestApiAsync(t,n,r);case 2:return a=e.sent,e.abrupt("return",JSON.parse(a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"requestApiAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r){var s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x()(Object(G.a)(Object(G.a)({method:"GET"},n),{},{url:this.brsUrlProvider.baseUrl+t,headers:Object(G.a)({"X-Cookie":"JSESSIONID=".concat(this.brsAuth.sid),"X-Requested-With":"XMLHttpRequest"},r)}));case 2:if(!(s=e.sent).trimLeft().startsWith("<!DOCTYPE html>")){e.next=5;break}throw new S(a.BrsUnauthorized,t+" is Forbidden");case 5:return e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();function te(e){var t=gapi.client.sheets;function n(){return(n=Object(m.a)(g.a.mark((function n(r){var a;return g.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.spreadsheets.values.get({spreadsheetId:e,range:r});case 2:return a=n.sent,n.abrupt("return",a.result);case 4:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return{readAsync:function(e){return n.apply(this,arguments)}}}function ne(e){return re.apply(this,arguments)}function re(){return(re=Object(m.a)(g.a.mark((function e(t){var n,r,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=gapi.client.sheets,e.next=3,n.spreadsheets.get({spreadsheetId:t});case 3:return r=e.sent,a=JSON.parse(r.body).sheets,e.abrupt("return",a.map((function(e){return e.properties})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return e&&e.toLowerCase().replace("\u0451","\u0435").replace(/[^A-Za-z\u0410-\u042f\u0401\u0430-\u044f\u04510-9]/g,"")}function se(e,t){return ae(e)===ae(t)}function ie(e){return parseFloat(e&&e.replace(",","."))}function ce(e,t){return e.reduce((function(e,n){var r="".concat(n[t]);return(e[r]=e[r]||[]).push(n),e}),{})}function oe(e,t,n,r){return e%10===0||e%10>=5||e%100>10&&e%100<20?r:e%10===1?t:n}function ue(e){return Math.round(10*e)/10}function le(e){return Math.round(100*e)/100}var de={"-":K.NoFailure,"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430":K.NotChosen,"\u041d\u0435 \u0434\u043e\u043f\u0443\u0449\u0435\u043d (\u0434\u0435\u043a\u0430\u043d\u0430\u0442)":K.NotAllowedByDeansOffice,"\u041d\u0435 \u044f\u0432\u0438\u043b\u0441\u044f":K.NotAppeared,"\u041d\u0435\u0443\u0432\u0430\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f":K.DisrespectfulReason,"\u0423\u0432\u0430\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f":K.RespectfulReason,"\u041d\u0435 \u0434\u043e\u043f\u0443\u0449\u0435\u043d":K.NotAllowedByTeacher,"\u041d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u0434\u0430\u0432\u0430\u0442\u044c":K.ShouldNotPass,"\u0410\u043a\u0430\u0434\u0435\u043c\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043e\u0442\u043f\u0443\u0441\u043a":K.AcademicLeave,"\u0412\u044b\u0431\u044b\u043b":K.DroppedOut};function pe(e){if(null===e||void 0===e)return null;for(var t=0,n=Object.keys(de);t<n.length;t++){var r=n[t];if(se(r,e))return de[r]}return K.NoFailure}function he(e){if(null===e||void 0===e)return null;for(var t=0,n=Object.keys(de);t<n.length;t++){var r=n[t];if(de[r]===e)return r}return"-"}var fe=function(){function e(t){Object(d.a)(this,e),this.spreadsheetId=void 0,this.spreadsheetId=t}return Object(p.a)(e,[{key:"getSpreadsheetDataAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var n,r,a,s,i,c,o;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ge(this.spreadsheetId,t);case 2:return n=e.sent,r=je(n),a=xe(r),s=ye(t,a),i=ke(r,a),c=Ae(n,a),e.next=10,be(this.spreadsheetId,s,a.fullNameColumn-a.left,a.groupColumn-a.left,null,a.failureColumn-a.left);case 10:return o=e.sent,e.abrupt("return",{actualStudents:o,disciplineConfig:c,controlActionConfigs:i});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function be(e,t){return ve.apply(this,arguments)}function ve(){return(ve=Object(m.a)(g.a.mark((function e(t,n){var r,a,s,i,c,o,u,l,d,p,h,f,b,v,m=arguments;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=m.length>2&&void 0!==m[2]?m[2]:0,a=m.length>3&&void 0!==m[3]?m[3]:1,s=m.length>4&&void 0!==m[4]?m[4]:null,i=m.length>5&&void 0!==m[5]?m[5]:null,c=te(t),e.next=7,c.readAsync(n);case 7:if(e.t0=e.sent.values,e.t0){e.next=10;break}e.t0=[];case 10:o=e.t0,u=[],l=Object(Q.a)(o);try{for(l.s();!(d=l.n()).done;)p=d.value,h=p[r],f=p[a],b=null!==s?p[s]:null,v=null!==i?pe(p[i]):null,h&&f&&u.push({fullName:h,groupName:f,id:b,failure:v,properties:p})}catch(g){l.e(g)}finally{l.f()}return e.abrupt("return",u);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e,t){return me.apply(this,arguments)}function me(){return(me=Object(m.a)(g.a.mark((function e(t,n){var r,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=te(t),e.next=3,r.readAsync(n+"!A1:ZZ100");case 3:return a=e.sent.values,e.abrupt("return",a||null);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e){var t=e&&e[0];if(!t)throw new Error("\u041b\u0438\u0441\u0442 Google-\u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0441\u0442\u0440\u043e\u043a");return t}function xe(e){var t=e&&e.map((function(e){return ae(e)})),n=t.indexOf(ae("\u0413\u0440\u0443\u043f\u043f\u0430 \u0432 \u0411\u0420\u0421")),r=t.indexOf(ae("\u0424\u0430\u043c\u0438\u043b\u0438\u044f \u0418\u043c\u044f \u0432 \u0411\u0420\u0421")),a=t.indexOf(ae("\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u044f")),s=t.indexOf(ae("\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432")),i=t.indexOf(ae("\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432"));if(a<0||n<0||r<0||n>a||r>a||1!==Math.abs(r-n)||s<0||i<0||s<=a||i<=a||i!==s+1)throw new Error("\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432");return{groupColumn:n,fullNameColumn:r,failureColumn:a,disciplineKeyColumn:s,disciplineValueColumn:i,left:Math.min(n,r),right:a}}function ye(e,t){var n=String.fromCharCode("A".charCodeAt(0)+t.left),r=String.fromCharCode("A".charCodeAt(0)+t.right);return"".concat(e,"!").concat(n,"2:").concat(r)}function ke(e,t){for(var n=[],r=t.left;r<=t.right;r++)r!==t.groupColumn&&r!==t.fullNameColumn&&r!==t.failureColumn&&e[r]&&n.push({controlAction:e[r],propertyIndex:r-t.left});for(var a=function(){var e=i[s],t=n.filter((function(t){return se(t.controlAction,e.controlAction)}));if(t.length>1){e.matchCount=t.length;for(var r=0;r<t.length;r++)t[r].matchIndex=r}},s=0,i=n;s<i.length;s++)a();return n}function Ae(e,t){for(var n={name:"",year:0,termType:Y.Fall,course:1,isModule:!1,defaultStudentFailure:K.NoFailure},r={name:"\u0414\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0430",year:"\u0423\u0447\u0435\u0431\u043d\u044b\u0439 \u0433\u043e\u0434",termType:"\u0421\u0435\u043c\u0435\u0441\u0442\u0440",course:"\u041a\u0443\u0440\u0441",isModule:"\u0418\u0422\u0421",defaultStudentFailure:"\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u044f \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e"},a=0;a<e.length;a++){var s,i,c=null===(s=e[a][t.disciplineKeyColumn])||void 0===s?void 0:s.trim();if(!c)break;var o=null===(i=e[a][t.disciplineValueColumn])||void 0===i?void 0:i.trim();Oe(n,r,c,o)}var u,l=function(e){var t,n=[],r=Object(Q.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!==a&&n.push(a)}}catch(s){r.e(s)}finally{r.f()}return n}((u=r,Object.keys(u)).map((function(e){return r[e]})));if(l.length>0){var d=l.map((function(e){return"\xab".concat(e,"\xbb")})).join(", ");throw new Error("\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0434\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u044b \u043d\u0435 \u0437\u0430\u0434\u0430\u043d\u044b: ".concat(d))}return n}function Oe(e,t,n,r){if(se(n,"\u0414\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0430"))r&&(e.name=r,t.name=null);else if(se(n,"\u0418\u0422\u0421"))r&&(e.isModule="\u0434\u0430"===r.toLowerCase(),t.isModule=null);else if(se(n,"\u0413\u043e\u0434"))r&&(e.year=parseInt(r.toLowerCase(),10),t.year=null);else if(se(n,"\u0423\u0447\u0435\u0431\u043d\u044b\u0439 \u0433\u043e\u0434")){if(r){var a=r.toLowerCase().split("/");e.year=parseInt(a[0],10),t.year=null}}else if(se(n,"\u0421\u0435\u043c\u0435\u0441\u0442\u0440"))r&&("\u043e\u0441\u0435\u043d\u043d\u0438\u0439"===r.toLowerCase()?(e.termType=Y.Fall,t.termType=null):"\u0432\u0435\u0441\u0435\u043d\u043d\u0438\u0439"===r.toLowerCase()&&(e.termType=Y.Spring,t.termType=null));else if(se(n,"\u041a\u0443\u0440\u0441")){if(r)"\u0432\u0441\u0435 \u043a\u0443\u0440\u0441\u044b"===r.toLowerCase().trim()?(e.course=0,t.course=null):(e.course=parseInt(r.toLowerCase(),10),t.course=null)}else if(se(n,"\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u044f \u043f\u043e \u0443\u043c\u043e\u043b\u0447\u0430\u043d\u0438\u044e")){var s;e.defaultStudentFailure=null!==(s=pe(r))&&void 0!==s?s:K.NoFailure,t.defaultStudentFailure=null}}n(533);var Se=n(583),we=n(581),Ce=n(584),Ne=n(585),Ie=n(586),Me=n(589),Fe=n(587),Le=n(588);function De(e){var t=e.title,n=e.items,r=e.icons,a=Object(W.jsx)(Se.a,{component:"div",id:"nested-list-subheader",hidden:!t,children:t});return Object(W.jsx)(we.a,{component:"nav","aria-labelledby":"nested-list-subheader",subheader:a,className:"nested-list primary",children:n.length?Te(n,0,r):Object(W.jsx)(Ce.a,{className:"text-align-center",children:Object(W.jsx)(Ne.a,{primary:"..."})})})}function Te(e,t,n){return e.map((function(e,r){return Object(W.jsx)(Ue,{item:e,icons:n,level:t},r)}))}function Ue(e){var t,n=e.item,r=e.level,a=e.icons,s=n.title,c=n.nestedItems,o=n.colored,u=n.collapsed,l=n.renderAsText,d=i.a.useState(!u),p=Object(T.a)(d,2),h=p[0],f=p[1],b=c&&c.length>0,v=o&&"colored-back",g=a&&a[r],m=g&&Object(W.jsx)(Ie.a,{children:g});return Object(W.jsxs)(i.a.Fragment,{children:[Object(W.jsxs)(Ce.a,{button:!0,onClick:function(){return f(!h)},style:r?{paddingLeft:40*r}:void 0,className:"hover "+v,children:[m,Object(W.jsx)(Ne.a,{primary:s}),b&&(h?Object(W.jsx)(Fe.a,{}):Object(W.jsx)(Le.a,{}))]}),b&&Object(W.jsx)(Me.a,{in:h,unmountOnExit:!0,children:l?Object(W.jsx)("div",{style:{paddingLeft:40*(r+1),paddingTop:10,paddingBottom:10},children:c&&(t=c,t.map((function(e,t){return Object(W.jsx)("div",{children:e.title},t)})))}):Object(W.jsx)(we.a,{component:"div",disablePadding:!0,children:c&&Te(c,r+1,a)})})]})}n(534);var Ee=n(590);function We(e){var t=e.enabled,n=e.onRunWorkSafe,r=e.onRunWorkUnsafe;return Object(W.jsxs)(Ee.a,{container:!0,justify:"space-around",children:[Object(W.jsx)(Ee.a,{item:!0,children:Object(W.jsx)(L.a,{variant:"contained",disabled:!t,onClick:n,color:"primary",children:"\u041f\u043e\u043f\u0440\u043e\u0431\u043e\u0432\u0430\u0442\u044c \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0445\u043e\u0440\u043e\u0448\u043e"})}),Object(W.jsx)(Ee.a,{item:!0,children:Object(W.jsx)(L.a,{variant:"contained",disabled:!t,onClick:r,color:"secondary",children:"\u0421\u0434\u0435\u043b\u0430\u0442\u044c \u0445\u043e\u0440\u043e\u0448\u043e"})})]})}n(535);var Re=n(6),Pe=n(601),_e=n(593),Be=n(591),ze=n(592);function Ge(e){return e.toLowerCase().replace("\u0451","\u0435").replace(/[ ]+/," ").trim()}var Je,qe="auto";!function(e){e[e.Updated=0]="Updated",e[e.Failed=1]="Failed",e[e.Skipped=2]="Skipped"}(Je||(Je={}));var Xe=function(){function e(t,n,r){Object(d.a)(this,e),this.brsApi=void 0,this.save=void 0,this.cancelPending=!1,this.reportManager=void 0,this.brsApi=t,this.reportManager=n,this.save=r}return Object(p.a)(e,[{key:"cancel",value:function(){this.cancelPending=!0}},{key:"putMarksToBrsAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n){var r,a,s,i,c,o,u,l=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.actualStudents,a=t.disciplineConfig,s=t.controlActionConfigs,e.prev=1,i=Object(Q.a)(n),e.prev=3,o=g.a.mark((function e(){var t,n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.value,0!==(n=r.filter((function(e){return se(e.groupName,t.group)}))).length){e.next=4;break}return e.abrupt("return","continue");case 4:return l.reportManager.newReport(t.group,t.teacherName),e.next=7,l.putMarksForDisciplineAsync(t,n,a.defaultStudentFailure,s);case 7:if(e.sent?l.reportManager.finishReport():l.reportManager.cancelReport(),!l.cancelPending){e.next=11;break}return e.abrupt("return","break");case 11:case"end":return e.stop()}}),e)})),i.s();case 6:if((c=i.n()).done){e.next=15;break}return e.delegateYield(o(),"t0",8);case 8:if("continue"!==(u=e.t0)){e.next=11;break}return e.abrupt("continue",13);case 11:if("break"!==u){e.next=13;break}return e.abrupt("break",15);case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(3),i.e(e.t1);case 20:return e.prev=20,i.f(),e.finish(20);case 23:return e.abrupt("return",null);case 26:return e.prev=26,e.t2=e.catch(1),e.abrupt("return",e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,26],[3,17,20,23]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"putMarksForDisciplineAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a){var s,i,c,o,u,l;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.brsApi.getDisciplineMetaAsync(t);case 2:if(s=e.sent,this.checkControlActionsConfiguration(t,s,a)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,this.brsApi.getAllStudentMarksAsync(t);case 7:return i=e.sent,c=this.mergeStudents(n,i),o=c.mergedStudents,u=c.skippedActualStudents,l=c.skippedBrsStudents,this.logMergedStudents(o,u,l),e.next=12,this.putMarksForStudentsAsync(t,s,o,a);case 12:return e.next=14,this.updateFailuresForSkippedStudentsAsync(l,t,r);case 14:if(!this.save){e.next=17;break}return e.next=17,this.brsApi.updateAllMarksAsync(t);case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"checkControlActionsConfiguration",value:function(e,t,n){if(this.tryGetAutoControlActionConfig(n))return!0;var r,a=this.getControlActions(t),s=Object(Q.a)(n);try{for(s.s();!(r=s.n()).done;){var i=r.value;if(!this.getSuitableControlAction(e,i,a))return!1}}catch(c){s.e(c)}finally{s.f()}return!0}},{key:"putMarksForStudentsAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a){var s,i,c,o=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(r.map(function(){var e=Object(m.a)(g.a.mark((function e(r){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.putMarksForStudentAsync(t,n,r,a);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:i=e.sent,c=Object.entries(ce(i,"status")).map((function(e){var t=Object(T.a)(e,2),n=(t[0],t[1]);return{title:Ve(n[0].status),students:n.map((function(e){return e.infoString}))}})),(s=this.reportManager.currentReport.marks).push.apply(s,Object($.a)(c));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"putMarksForStudentAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a){var s,i,c,o,u,l,d,p,h,f,b;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=this.tryGetAutoControlActionConfig(a),o=this.getControlActions(n),u={failed:0,updated:0,marks:[]},null===c){e.next=8;break}return e.next=6,this.putAutoMarksForStudentAsync(u,t,n,r,c);case 6:e.next=10;break;case 8:return e.next=10,this.putManualMarksForStudentAsync(u,t,r,a,o);case 10:if(l=null!==(s=r.brs.failure)&&void 0!==s?s:K.NoFailure,(d=null!==(i=r.actual.failure)&&void 0!==i?i:K.NoFailure)!==l){e.next=16;break}p="".concat(he(d)),e.next=27;break;case 16:if(p="".concat(he(d),"!"),e.prev=17,!this.save){e.next=21;break}return e.next=21,this.brsApi.putStudentFailureAsync(r.brs.studentUuid,t,d);case 21:u.updated++,e.next=27;break;case 24:e.prev=24,e.t0=e.catch(17),u.failed++;case 27:return h=u.failed>0?Je.Failed:u.updated>0?Je.Updated:Je.Skipped,f=r.actual.fullName.substr(0,30),b="".concat(f," \u0431\u0430\u043b\u043b\u044b: ").concat(u.marks.join(" ")),p&&"-"!==p&&(b+=", ".concat(p)),e.abrupt("return",{status:h,infoString:b});case 32:case"end":return e.stop()}}),e,this,[[17,24]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"putAutoMarksForStudentAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s){var i,c,o,u,l,d,p,h,f,b;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.actual.properties[s.propertyIndex],c=ie(i),o=this.getControlActionGroups(r),u=o.filter((function(e){return!e.isIntermediate})),l=u.reduce((function(e,t){return e+t.factor}),0),d=o.filter((function(e){return e.isIntermediate})),p=d.reduce((function(e,t){return t.factor}),0),h="[auto=".concat(c,"]"),t.marks.push("             ".concat(h).substr("".concat(h).length-1)),!(40<=c)){e.next=14;break}return e.next=12,this.putMarksTryFillActionsWithMaxScoreAsync(t,n,a,o,c);case 12:e.next=21;break;case 14:return f=0,b=le(l>0?(c-p*f)/l:0),e.next=19,this.putMarksTryFillActionsWithMaxScoreAsync(t,n,a,u,b);case 19:return e.next=21,this.putMarksTryFillActionsWithMaxScoreAsync(t,n,a,d,f);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s){return e.apply(this,arguments)}}()},{key:"putMarksTryFillActionsWithMaxScoreAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s){var i,c,o,u,l,d,p,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(Q.a)(a),e.prev=1,i.s();case 3:if((c=i.n()).done){e.next=19;break}o=c.value,u=o.controlActions,l=s,d=0;case 8:if(!(d<u.length)){e.next=17;break}return p=u[d],h=p.maxValue<l?p.maxValue:ue(l),l-=h,e.next=14,this.putMarkAsync(t,n,r,p,h);case 14:d++,e.next=8;break;case 17:e.next=3;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(1),i.e(e.t0);case 24:return e.prev=24,i.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[1,21,24,27]])})));return function(t,n,r,a,s){return e.apply(this,arguments)}}()},{key:"putManualMarksForStudentAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s){var i,c,o,u,l,d;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(Q.a)(a),e.prev=1,i.s();case 3:if((c=i.n()).done){e.next=14;break}if(o=c.value,u=this.getSuitableControlAction(n,o,s)){e.next=8;break}throw new Error("\u041f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435 \u0434\u043b\u044f \xab".concat(o.controlAction,"\xbb \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0432 \u0411\u0420\u0421"));case 8:return l=r.actual.properties[o.propertyIndex],d=ie(l),e.next=12,this.putMarkAsync(t,n,r,u,d);case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),i.e(e.t0);case 19:return e.prev=19,i.f(),e.finish(19);case 22:return e.abrupt("return",t);case 23:case"end":return e.stop()}}),e,this,[[1,16,19,22]])})));return function(t,n,r,a,s){return e.apply(this,arguments)}}()},{key:"putMarkAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r,a,s){var i,c,o,u,l;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.brs[a.uuid],c=ie(i),o=!isNaN(s)&&!(isNaN(c)?0===s:c===s),u=isNaN(s)?"-":s.toString(),l=a.controlAction.substring(0,3),!o){e.next=9;break}t.marks.push("       ".concat(l,"=").concat(u,"!").substr("".concat(u).length-1)),e.next=11;break;case 9:return t.marks.push("       ".concat(l,"=").concat(u," ").substr("".concat(u).length-1)),e.abrupt("return");case 11:if(e.prev=11,!this.save){e.next=15;break}return e.next=15,this.brsApi.putStudentMarkAsync(r.brs.studentUuid,a.uuidWithoutPrefix,s,n.groupHistoryId,r.brs.cardType,r.brs.disciplineLoad);case 15:t.updated++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),t.failed++;case 21:case"end":return e.stop()}}),e,this,[[11,18]])})));return function(t,n,r,a,s){return e.apply(this,arguments)}}()},{key:"getSuitableControlAction",value:function(e,t,n){var r=n.filter((function(e){return se(e.controlAction,t.controlAction)})),a=[];return 0===r.length?(a.push("\u0413\u0440\u0443\u043f\u043f\u0430 ".concat(e.group)+(void 0!==e.teacherName?", \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c ".concat(e.teacherName):"")),a.push("- \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435 \xab".concat(t.controlAction,"\xbb \u043d\u0435 \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e \u0441 \u0411\u0420\u0421")),a.push("- \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0435 \u0432 \u0411\u0420\u0421 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f: ".concat(n.map((function(e){return e.controlAction})).join(", "))),this.reportManager.onInvalidConfiguration(a),null):void 0!==t.matchIndex||void 0!==t.matchCount?void 0===t.matchIndex||void 0===t.matchCount||r.length!==t.matchCount||t.matchIndex>=t.matchCount?(a.push("\u041d\u0435\u0432\u0435\u0440\u043d\u0430\u044f \u043a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u043e\u0433\u043e \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f \xab".concat(t.controlAction,"\xbb")),r.length!==t.matchCount&&a.push("\u0412 \u0411\u0420\u0421 \u043d\u0430\u0439\u0434\u0435\u043d\u043e ".concat(r.length," ").concat(oe(r.length,"\u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u043e\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0435","\u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f","\u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0438\u0445 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0439"),", \u0430 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e ").concat(t.matchCount)),this.reportManager.onInvalidConfiguration(a),null):r[t.matchIndex]:r.length>1?(a.push("\u041d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0445 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u0439 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0434\u043b\u044f \xab".concat(t.controlAction,"\xbb")),a.push("\u041d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0435 \u043c\u0435\u0440\u043e\u043f\u0440\u0438\u044f\u0442\u0438\u044f: ".concat(r.map((function(e){return e.controlAction})).join(", "))),this.reportManager.onInvalidConfiguration(a),null):r[0]}},{key:"updateFailuresForSkippedStudentsAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r){var a,s,i,c=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return c.updateFailureForStudent(e,n,r)})));case 2:(a=e.sent).length>0&&(i=Object.entries(ce(a,"status")).map((function(e){var t=Object(T.a)(e,2),n=(t[0],t[1]);return{title:Ve(n[0].status),students:n.map((function(e){return e.infoString}))}})),(s=this.reportManager.currentReport.skipped).push.apply(s,Object($.a)(i)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateFailureForStudent",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n,r){var a,s,i,c,o,u;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.failure?t.failure:K.NoFailure,(i=r)!==s){e.next=6;break}a=Je.Skipped,e.next=16;break;case 6:if(e.prev=6,!this.save){e.next=10;break}return e.next=10,this.brsApi.putStudentFailureAsync(t.studentUuid,n,i);case 10:a=Je.Updated,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),a=Je.Failed;case 16:return c=t.studentFio.substr(0,30),o=a!==Je.Skipped?"\u0432\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e \xab".concat(he(i),"\xbb, \u0431\u044b\u043b\u043e \xab").concat(he(s),"\xbb"):"\xab".concat(he(i),"\xbb"),u="".concat(c,", ").concat(o),e.abrupt("return",{status:a,infoString:u});case 20:case"end":return e.stop()}}),e,this,[[6,13]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"tryGetAutoControlActionConfig",value:function(e){var t=e.filter((function(e){return e.controlAction.toLowerCase()===qe}));return 1===t.length?t[0]:(t.length>1&&this.reportManager.onInvalidConfiguration(["\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043a\u043e\u043b\u043e\u043d\u043e\u043a \xab".concat(qe,"\xbb \u0441 \u0430\u0432\u0442\u043e\u0438\u0442\u043e\u0433\u043e\u043c")]),null)}},{key:"getControlActions",value:function(e){var t,n,r,a,s,i,c,o;return[].concat(Object($.a)((null===(t=e.lecture)||void 0===t?void 0:t.currentControlActions)||[]),Object($.a)((null===(n=e.lecture)||void 0===n?void 0:n.intermediateControlActions)||[]),Object($.a)((null===(r=e.laboratory)||void 0===r?void 0:r.currentControlActions)||[]),Object($.a)((null===(a=e.laboratory)||void 0===a?void 0:a.intermediateControlActions)||[]),Object($.a)((null===(s=e.practice)||void 0===s?void 0:s.currentControlActions)||[]),Object($.a)((null===(i=e.practice)||void 0===i?void 0:i.intermediateControlActions)||[]),Object($.a)((null===(c=e.additionalPractice)||void 0===c?void 0:c.currentControlActions)||[]),Object($.a)((null===(o=e.additionalPractice)||void 0===o?void 0:o.intermediateControlActions)||[]))}},{key:"getControlActionGroups",value:function(e){var t=[];return e.lecture&&this.pushControlActionGroups(t,e.lecture),e.laboratory&&this.pushControlActionGroups(t,e.laboratory),e.practice&&this.pushControlActionGroups(t,e.practice),e.additionalPractice&&this.pushControlActionGroups(t,e.additionalPractice),t}},{key:"pushControlActionGroups",value:function(e,t){if(t.currentControlActions.length>0){var n=le(t.currentFactor*t.totalFactor),r=t.currentControlActions;e.push({factor:n,controlActions:r,isIntermediate:!1})}if(t.intermediateControlActions.length>0){var a=le(t.intermediateFactor*t.totalFactor),s=t.intermediateControlActions;e.push({factor:a,controlActions:s,isIntermediate:!0})}}},{key:"mergeStudents",value:function(e,t){var n,r=t.filter(He),a=[],s=[],i=Object(Q.a)(e);try{var c=function(){var e=n.value,t=r.filter((function(t){return function(e,t){var n=Ge(e.studentFio),r=Ge(t.fullName);return n.startsWith(r)}(t,e)}));1===t.length?a.push({actual:e,brs:t[0]}):s.push(e)};for(i.s();!(n=i.n()).done;)c()}catch(p){i.e(p)}finally{i.f()}var o,u=[],l=Object(Q.a)(r);try{var d=function(){var e=o.value;a.some((function(t){return t.brs.studentUuid===e.studentUuid}))||u.push(e)};for(l.s();!(o=l.n()).done;)d()}catch(p){l.e(p)}finally{l.f()}return{mergedStudents:a,skippedActualStudents:s,skippedBrsStudents:u}}},{key:"logMergedStudents",value:function(e,t,n){var r=this.reportManager.currentReport;r.merge.succeed=e.length,t.length>0&&(r.merge.failedActual=t.map((function(e){return e.fullName}))),n.length>0&&(r.merge.failedBrs=n.map((function(e){return e.studentFio})))}}]),e}();function He(e){return"\u041f\u0435\u0440\u0435\u0432\u0435\u0434\u0435\u043d"!==e.studentStatus&&"\u041e\u0442\u0447\u0438\u0441\u043b\u0435\u043d"!==e.studentStatus&&"\u041f\u0435\u0440\u0435\u0432\u0435\u0434\u0435\u043d"!==e.studentStatus&&"\u041e\u0442\u043f.\u0430\u043a\u0430\u0434."!==e.studentStatus&&e.failure!==K.ShouldNotPass}function Ve(e){switch(e){case Je.Updated:return"\u041e\u0411\u041d\u041e\u0412\u041b\u0415\u041d\u041e";case Je.Skipped:return"\u041f\u0420\u041e\u041f\u0423\u0429\u0415\u041d\u041e";case Je.Failed:return"\u041f\u0420\u041e\u0412\u0410\u041b\u0415\u041d\u041e";default:throw new Error("\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439 \u0441\u0442\u0430\u0442\u0443\u0441 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0446\u0435\u043d\u043e\u043a")}}var Ze,Ke=function(){function e(t,n){Object(d.a)(this,e),this._currentReport=null,this.onReportFinished=void 0,this.onInvalidConfiguration=void 0,this.onReportFinished=t,this.onInvalidConfiguration=n}return Object(p.a)(e,[{key:"currentReport",get:function(){if(!this._currentReport)throw new Error("\u041f\u043e\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u0435 \u043e\u0442\u0447\u0435\u0442\u0430 \u0435\u0449\u0435 \u043d\u0435 \u043d\u0430\u0447\u0430\u0442\u043e");return this._currentReport}},{key:"newReport",value:function(e,t){this.finishReport(),this._currentReport={group:e,teacher:t,merge:{succeed:0},marks:[],skipped:[]}}},{key:"finishReport",value:function(){this._currentReport&&this.onReportFinished(this._currentReport),this._currentReport=null}},{key:"cancelReport",value:function(){this._currentReport=null}}]),e}(),Ye=Object(Re.a)((function(){return{root:{padding:0}}}))(Be.a),Qe=Object(Re.a)((function(){return{root:{display:"flex",justifyContent:"space-around"}}}))(ze.a),$e=function(e){Object(M.a)(n,e);var t=Object(F.a)(n);function n(e){var r;Object(d.a)(this,n),(r=t.call(this,e)).marksManager=void 0,r.logConfigurationErrors=function(e){var t=e.map((function(e){return{title:e,colored:!0}}));r.setState({logItems:t})},r.logMessage=function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.reportToNestedListItems(t);case 2:n=e.sent,r.setState({logItems:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.startWork=Object(m.a)(g.a.mark((function e(){var t,n,a,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.props.marksData,n=t.spreadsheetData,a=t.suitableDisciplines,e.next=3,r.marksManager.putMarksToBrsAsync(n,a);case 3:(s=e.sent)&&("object"===typeof s?r.props.onError(s.toString()):"string"===typeof s&&r.props.onError(s)),r.setState({cancelPending:!1,okLoading:!1});case 6:case"end":return e.stop()}}),e)}))),r.cancelWork=function(){r.setState({cancelPending:!0}),r.marksManager.cancel()};var a=e.brsApi,s=e.save,i=new Ke(r.logMessage,r.logConfigurationErrors);return r.marksManager=new Xe(a,i,s),r.state={okLoading:!0,cancelPending:!1,logItems:[]},r}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.startWork()}},{key:"componentWillUnmount",value:function(){this.marksManager.cancel()}},{key:"reportToNestedListItems",value:function(e){var t=this.state.logItems;return new Promise((function(n){var r,a,s="\u0413\u0440\u0443\u043f\u043f\u0430 ".concat(e.group)+(void 0!==e.teacher?", \u043f\u0440\u0435\u043f\u043e\u0434\u0430\u0432\u0430\u0442\u0435\u043b\u044c ".concat(e.teacher):""),i=[],c={title:s,collapsed:!0,nestedItems:i},o=!1,u=e.merge,l="\u0421\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435: ".concat(u.succeed," \u0443\u0441\u043f\u0435\u0448\u043d\u043e"),d=(null===(r=u.failedActual)||void 0===r?void 0:r.length)||0;l+=", ".concat(d," ").concat(oe(d,"\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439","\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445","\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445")," \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0435");var p,h,f=(null===(a=u.failedBrs)||void 0===a?void 0:a.length)||0,b={title:l+=", ".concat(f," ").concat(oe(f,"\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439","\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445","\u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0445")," \u0432 \u0411\u0420\u0421"),nestedItems:[],collapsed:!0};(i.push(b),u.failedActual)&&(o=!0,s="\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c ".concat(u.failedActual.length," ").concat(oe(u.failedActual.length,"\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430","\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432","\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432")," \u0438\u0437 Google \u0422\u0430\u0431\u043b\u0438\u0446\u044b"),null===(p=b.nestedItems)||void 0===p||p.push({title:s,nestedItems:u.failedActual.map((function(e){return{title:e}})),colored:!0,collapsed:!1,renderAsText:!0}));u.failedBrs&&(o=!0,s="\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c ".concat(u.failedBrs.length," ").concat(oe(u.failedBrs.length,"\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430","\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432","\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432")," \u0438\u0437 \u0411\u0420\u0421"),null===(h=b.nestedItems)||void 0===h||h.push({title:s,nestedItems:u.failedBrs.map((function(e){return{title:e}})),colored:!0,collapsed:!1,renderAsText:!0}));var v=e.marks,g={title:"\u0412\u044b\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0431\u0430\u043b\u043b\u043e\u0432",collapsed:!0};g.nestedItems=v.map((function(e){var t,n,r=e.title,a=e.students;return{title:"".concat(r,": ").concat(null!==(t=null===a||void 0===a?void 0:a.length)&&void 0!==t?t:0," ").concat(oe(null!==(n=null===a||void 0===a?void 0:a.length)&&void 0!==n?n:0,"\u0441\u0442\u0443\u0434\u0435\u043d\u0442","\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430","\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432")),nestedItems:null===a||void 0===a?void 0:a.map((function(e){return{title:e}})),collapsed:!1,renderAsText:!0}})),i.push(g);var m=e.skipped;if(m.length>0){var j={title:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0435 \u0441\u0442\u0443\u0434\u0435\u043d\u0442\u044b \u0438\u0437 \u0411\u0420\u0421",collapsed:!0};j.nestedItems=m.map((function(e){var t,n,r=e.title,a=e.students;return{title:"".concat(r,": ").concat(null!==(t=null===a||void 0===a?void 0:a.length)&&void 0!==t?t:0," ").concat(oe(null!==(n=null===a||void 0===a?void 0:a.length)&&void 0!==n?n:0,"\u0441\u0442\u0443\u0434\u0435\u043d\u0442","\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u0430","\u0441\u0442\u0443\u0434\u0435\u043d\u0442\u043e\u0432")),nestedItems:null===a||void 0===a?void 0:a.map((function(e){return{title:e}})),collapsed:!1,renderAsText:!0}})),i.push(j)}o&&(c.colored=!0),t.push(c),n(t)}))}},{key:"render",value:function(){return Object(W.jsx)(i.a.Fragment,{children:Object(W.jsxs)(Pe.a,{open:!0,maxWidth:"md",fullWidth:!0,className:"worker-dialog",children:[Object(W.jsx)(_e.a,{children:"\u0416\u0443\u0440\u043d\u0430\u043b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"}),Object(W.jsx)(Ye,{dividers:!0,children:Object(W.jsx)(De,{items:this.state.logItems})}),Object(W.jsxs)(Qe,{children:[Object(W.jsx)(R,{loading:this.state.okLoading,onClick:this.props.onClosed,title:"\u043e\u043a"}),Object(W.jsx)(R,{loading:this.state.cancelPending,disabled:!this.state.okLoading,onClick:this.cancelWork,title:"\u043e\u0442\u043c\u0435\u043d\u0430"})]})]})})}}]),n}(i.a.Component),et=n(270),tt=n.n(et),nt=n(594),rt=n(271);function at(e){var t=e.loading,n=e.onSubmit,r=Object(s.useState)(""),a=Object(T.a)(r,2),i=a[0],c=a[1],o=Object(s.useState)(null),u=Object(T.a)(o,2),l=u[0],d=u[1];return Object(W.jsxs)("form",{onSubmit:function(e){e.preventDefault();var t=Object(rt.a)(/d\/([\x2D0-9A-Z_a-z]+)\/edit(#gid=([0-9]+))?/,{spreadsheetId:1,sheetId:3}),r=i.match(t);if(!(null===r||void 0===r?void 0:r.groups)||!r.groups.spreadsheetId)return d("\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 url-\u0430\u0434\u0440\u0435\u0441."),null;var a=r.groups.spreadsheetId,s=r.groups.sheetId||null;n(a,s)},className:"vertical-margin-min",children:[Object(W.jsx)(U.a,{name:"table-url",label:"\u0421\u0441\u044b\u043b\u043a\u0430 \u0432\u0438\u0434\u0430 https://docs.google.com/spreadsheets/d/sjwa1/edit#gid=0",type:"text",className:"tableUrl",value:i,onChange:function(e){var t=e.target;l&&d(null),c(t.value)},error:!!l,helperText:l,required:!0}),Object(W.jsx)(R,{title:"\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c",loading:t,className:"submit"}),Object(W.jsx)("a",{href:h,target:"_blank",rel:"noreferrer",className:"button-link",children:"\u041f\u0440\u0438\u043c\u0435\u0440 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u0434\u043b\u044f \u044d\u043a\u0441\u043f\u043e\u0440\u0442\u0430 \u0432 \u0411\u0420\u0421"})]})}!function(e){e[e.None=0]="None",e[e.LoadDisciplines=1]="LoadDisciplines",e[e.RunWork=2]="RunWork"}(Ze||(Ze={}));var st=function(e){Object(M.a)(n,e);var t=Object(F.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).marksData={},r.workerSaveMode=!1,r.spreadsheetId="",r.sheetId=null,r.loadDisciplines=function(){var e=Object(m.a)(g.a.mark((function e(t,n){var a,s,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.spreadsheetId=t,r.sheetId=n,r.setState({loading:!0}),e.next=5,r.getActualSpreadsheetDataAsync(t,n);case 5:if(a=e.sent){e.next=9;break}return r.setState({loading:!1}),e.abrupt("return",!1);case 9:return e.next=11,r.getActualDisciplinesAsync(a.disciplineConfig);case 11:if(s=e.sent){e.next=15;break}return r.setState({loading:!1}),e.abrupt("return",!1);case 15:return i=r.disciplinesToListItems(s,a),r.marksData.spreadsheetData=a,r.marksData.suitableDisciplines=s,r.setState({loading:!1,disciplines:i.disciplines,showDisciplines:!0,lastAction:Ze.LoadDisciplines,allDisciplinesMissed:i.allMissed,missedDisciplinesCount:i.missedCount,showWorkerButtons:!i.allMissed}),e.abrupt("return",!i.allMissed);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),r.updateCachedDisciplines=function(e){var t;e.preventDefault(),r.setState({showDisciplines:!1});var n=null===(t=r.marksData.spreadsheetData)||void 0===t?void 0:t.disciplineConfig;n&&(r.props.brsApi.clearDisciplineCacheAsync(n.year,n.termType,n.course,n.isModule).then((function(e){return e}),(function(e){r.props.onError(e)})),r.loadDisciplines(r.spreadsheetId,r.sheetId))},r.runWork=function(){var e=Object(m.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.state.lastAction===Ze.LoadDisciplines){e.next=6;break}return e.next=3,r.loadDisciplines(r.spreadsheetId,r.sheetId);case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:r.workerSaveMode=t,r.setState({lastAction:Ze.RunWork,runWorker:!0});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.handleRunWorkSafe=function(){return r.runWork(!1)},r.handleRunWorkUnsafe=function(){return r.runWork(!0)},r.handleWorkerClosed=function(){return r.setState({runWorker:!1})},r.state={tableUrl:"",loading:!1,showDisciplines:!1,lastAction:Ze.None,tableUrlError:{error:!1,message:""},disciplines:[],allDisciplinesMissed:!1,missedDisciplinesCount:0,showWorkerButtons:!1,runWorker:!1},r}return Object(p.a)(n,[{key:"disciplinesToListItems",value:function(e,t){var n=new Set(t.actualStudents.map((function(e){return e.groupName}))),r=new Set(e.map((function(e){return e.group}))),a=0,s=Array.from(n).map((function(e){var t=!r.has(e);return t&&a++,{title:e,colored:t}}));return{allMissed:a===n.size,missedCount:a,disciplines:[{title:t.disciplineConfig.name,nestedItems:s}]}}},{key:"getActualDisciplinesAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t){var n;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.props.brsApi.getDisciplineCachedAsync(t.year,t.termType,t.course,t.isModule);case 3:return n=e.sent,e.abrupt("return",n.filter((function(e){return se(e.discipline,t.name)})));case 7:e.prev=7,e.t0=e.catch(0),this.props.onError(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getActualSpreadsheetDataAsync",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n){var r,a,s;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSheetName(t,n);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.prev=5,s=new fe(t),e.next=9,s.getSpreadsheetDataAsync(r);case 9:a=e.sent,e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(5),this.props.onError(e.t0.message||JSON.stringify(e.t0)),e.abrupt("return",null);case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSheetName",value:function(){var e=Object(m.a)(g.a.mark((function e(t,n){var r,a;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ne(t);case 3:if(r=e.sent,a=n?r.filter((function(e){return e.sheetId.toString()===n}))[0]:r[0]){e.next=8;break}return this.props.onError("\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430"),e.abrupt("return",null);case 8:return e.abrupt("return",a.title);case 11:return e.prev=11,e.t0=e.catch(0),this.props.onError(e.t0.message||JSON.stringify(e.t0)),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(W.jsxs)("span",{className:"spreadsheet-fetch",children:[Object(W.jsx)("h3",{className:"vertical-margin-min",children:"\u0412\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u043b\u0438\u0441\u0442 Google \u0422\u0430\u0431\u043b\u0438\u0446\u044b \u0441 \u043e\u0446\u0435\u043d\u043a\u0430\u043c\u0438"}),Object(W.jsx)(at,{loading:this.state.loading,onSubmit:this.loadDisciplines}),Object(W.jsxs)(Me.a,{in:this.state.showDisciplines,className:"vertical-margin-min",children:[Object(W.jsx)("h3",{children:"\u0417\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u0430\u044f \u0434\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0430 \u0438\u0437 Google \u0422\u0430\u0431\u043b\u0438\u0446\u044b"}),this.state.missedDisciplinesCount>0&&Object(W.jsxs)("p",{children:["\u0413\u0440\u0443\u043f\u043f\u044b, \u043a \u043a\u043e\u0442\u043e\u0440\u044b\u043c \u0443 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0432 \u0411\u0420\u0421,"," ",Object(W.jsx)("b",{className:"colored-text",children:" \u043f\u043e\u0434\u0441\u0432\u0435\u0447\u0435\u043d\u044b"})]}),Object(W.jsx)(De,{items:this.state.disciplines,icons:[Object(W.jsx)(nt.a,{}),Object(W.jsx)(tt.a,{})]}),this.state.allDisciplinesMissed?Object(W.jsxs)(i.a.Fragment,{children:[Object(W.jsx)("p",{children:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u043d\u0438 \u043a \u043e\u0434\u043d\u043e\u0439 \u0438\u0437 \u043f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0435\u043d\u043d\u044b\u0445 \u0433\u0440\u0443\u043f\u043f \u0432 \u0411\u0420\u0421"}),Object(W.jsx)("span",{children:"\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u044b\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f:"}),Object(W.jsxs)("ol",{className:"no-margin",children:[Object(W.jsx)("li",{children:"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0434\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u044b \u0432 \u0411\u0420\u0421 \u0438 \u0432 Google \u0422\u0430\u0431\u043b\u0438\u0446\u0430\u0445 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442"}),Object(W.jsx)("li",{children:"\u0417\u0430\u043f\u0440\u043e\u0441\u0438\u0442\u0435 \u0434\u043e\u0441\u0442\u0443\u043f \u043d\u0430 \u0434\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0443 \u0432 \u0411\u0420\u0421"}),Object(W.jsx)("li",{children:"\u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044c, \u0447\u0442\u043e \u0442\u0435\u0445\u043a\u0430\u0440\u0442\u0430 \u0441\u043e\u0433\u043b\u0430\u0441\u043e\u0432\u0430\u043d\u0430 \u0432 \u0411\u0420\u0421"}),Object(W.jsx)("li",{children:Object(W.jsx)("button",{className:"button-link",onClick:this.updateCachedDisciplines,children:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u043a\u044d\u0448 \u0433\u0440\u0443\u043f\u043f"})})]})]}):Object(W.jsxs)(i.a.Fragment,{children:[Object(W.jsxs)("p",{children:["\u0415\u0441\u043b\u0438 \u0432\u0430\u043c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u043d\u0435 \u0432\u0441\u0435 \u0433\u0440\u0443\u043f\u043f\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u0430\u043c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b \u0432 \u0411\u0420\u0421, \u0442\u043e"," ",Object(W.jsx)("button",{className:"button-link",onClick:this.updateCachedDisciplines,children:"\u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u043a\u044d\u0448 \u0433\u0440\u0443\u043f\u043f"})]}),Object(W.jsx)(D.a,{className:"vertical-margin-medium",children:Object(W.jsx)(We,{enabled:this.state.showWorkerButtons,onRunWorkSafe:this.handleRunWorkSafe,onRunWorkUnsafe:this.handleRunWorkUnsafe})})]})]}),this.state.runWorker&&Object(W.jsx)($e,{marksData:this.marksData,onClosed:this.handleWorkerClosed,brsApi:this.props.brsApi,onError:this.props.onError,save:this.workerSaveMode})]})}}]),n}(i.a.Component),it=Object(s.memo)(st),ct=n(595),ot=n(596),ut=i.a.forwardRef((function(e,t){return Object(W.jsx)(ct.a,Object(G.a)({direction:"up",ref:t},e))}));function lt(e){var t=e.open,n=e.sessionName,r=e.onOk;return Object(W.jsx)(i.a.Fragment,{children:Object(W.jsxs)(Pe.a,{open:t,TransitionComponent:ut,keepMounted:!0,"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description",children:[Object(W.jsx)(_e.a,{id:"alert-dialog-slide-title",children:"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f"}),Object(W.jsx)(Be.a,{children:Object(W.jsxs)(ot.a,{id:"alert-dialog-slide-description",children:["\u041a\u0430\u0436\u0435\u0442\u0441\u044f, \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 ",n," \u0438\u0441\u0442\u0435\u043a\u043b\u043e.",Object(W.jsx)("br",{}),"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f."]})}),Object(W.jsx)(ze.a,{style:{display:"flex",justifyContent:"space-around"},children:Object(W.jsx)(L.a,{onClick:r,color:"primary",children:"\u041e\u043a"})})]})})}n(540);function dt(){return Object(W.jsx)("div",{className:"loading-pane",children:Object(W.jsx)(E.a,{size:100,className:"progress"})})}var pt=function(e){Object(M.a)(n,e);var t=Object(F.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).handleError=function(e){var t=e.message||JSON.stringify(e);e.statusCode?e.statusCode===a.BrsUnauthorized?r.handleSessionExpired("\u0411\u0420\u0421"):r.handleSessionExpired("Google"):"RequestError"===e.name?r.setState({errorMessage:"\u0412 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0441\u0435\u0440\u0432\u0435\u0440 \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d. \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u043f\u043e\u0437\u0436\u0435."}):r.setState({errorMessage:t})},r.handleSessionExpired=function(e){r.setState({openSessionExpiredAlert:!0,sessionName:e,loading:!1})},r.handleSessionExpiredOk=function(){"\u0411\u0420\u0421"===r.state.sessionName?(r.props.brsAuth.logout(),r.returnToLoginPage(),r.setState({redirect:!0})):"Google"===r.state.sessionName&&r.returnToLoginPage()},r.closeError=function(){r.setState({errorMessage:""})},r.returnToLoginPage=function(){r.setState({redirect:!0})},r.state={showControls:!1,runWork:!1,openSessionExpiredAlert:!1,sessionName:"",errorMessage:"",loading:!0,redirect:!1},r}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=Object(m.a)(g.a.mark((function e(){var t=this;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.googleAuth.ensureInitializedAsync();case 2:return e.next=4,this.props.brsAuth.tryRestoreAsync();case 4:this.props.brsAuth.checkAuth()||this.handleSessionExpired("\u0411\u0420\u0421"),this.props.googleAuth.checkAuthorized()?this.setState({loading:!1}):setTimeout((function(){t.props.googleAuth.checkAuthorized()?t.setState({loading:!1}):t.handleSessionExpired("Google")}),1e3);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(W.jsxs)(i.a.Fragment,{children:[this.state.loading&&Object(W.jsx)(dt,{}),Object(W.jsx)(lt,{open:this.state.openSessionExpiredAlert,sessionName:this.state.sessionName,onOk:this.handleSessionExpiredOk}),this.state.errorMessage&&Object(W.jsx)(X,{open:!!this.state.errorMessage,message:this.state.errorMessage,type:"error",onClose:this.closeError}),this.state.redirect&&Object(W.jsx)(l.a,{to:"/"}),Object(W.jsx)("div",{className:"work-page",children:Object(W.jsxs)(D.a,{maxWidth:"md",children:[Object(W.jsx)(L.a,{variant:"contained",style:{marginTop:10},onClick:this.returnToLoginPage,children:"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 \u0432\u0445\u043e\u0434\u0430"}),Object(W.jsx)(it,{brsApi:this.props.brsApi,onError:this.handleError})]})})]})}}]),n}(i.a.Component);function ht(){return Object(W.jsx)(I.Consumer,{children:function(e){return e&&Object(W.jsx)(pt,{brsAuth:e.brsAuth,brsApi:e.brsApi,googleAuth:e.googleAuth})}})}var ft=new b(!0),bt=new w(ft),vt=new ee(bt,ft),gt=new N;function mt(){return Object(W.jsx)(I.Provider,{value:{brsAuth:bt,brsApi:vt,googleAuth:gt},children:Object(W.jsx)(u.a,{hashType:"noslash",children:Object(W.jsxs)(l.d,{children:[Object(W.jsx)(l.b,{path:"/work",component:ht}),Object(W.jsx)(l.b,{exact:!0,path:"",component:Z})]})})})}var jt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,602)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),s(e),i(e)}))};n(541);o.a.render(Object(W.jsx)(mt,{}),document.getElementById("root")),jt()}},[[542,1,2]]]);
//# sourceMappingURL=main.154e0b12.chunk.js.map