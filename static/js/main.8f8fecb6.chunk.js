(this["webpackJsonpbrs-extensions"]=this["webpackJsonpbrs-extensions"]||[]).push([[0],{310:function(e,t,n){},340:function(e,t){},342:function(e,t){},352:function(e,t){},354:function(e,t){},379:function(e,t){},381:function(e,t){},382:function(e,t){},388:function(e,t){},390:function(e,t){},408:function(e,t){},410:function(e,t){},422:function(e,t){},425:function(e,t){},430:function(e,t){},432:function(e,t){},455:function(e,t){},550:function(e,t,n){},553:function(e,t,n){},554:function(e,t,n){},555:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(0),s=n.n(a),i=n(17),c=n.n(i),o=n(127),u=n(26),l=n(6),d=n.n(l),h=n(10),p=n(30),f=n(22),b=n(15),g=n(55),v=n(73),j=n(598),m=n(622),y=n(590),x=n(594);n(310);function k(e){var t=e.title,n=e.loading,a=e.className,s=e.onClick,i=e.disabled,c=void 0!==i&&i;return Object(r.jsxs)("div",{className:"submit-with-loading "+a,children:[Object(r.jsx)(y.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",onClick:s,disabled:n||c,children:t}),n&&Object(r.jsx)(x.a,{color:"secondary",size:24,className:"button-progress"})]})}var O=n(131),A=n.n(O),w={};function C(e,t){if(!t)return!1;var n=JSON.stringify(t);return localStorage.setItem(e,n),w[e]=t,!0}function S(e){var t=w[e];if(t)return t;var n=localStorage.getItem(e);if(!n)return null;var r=JSON.parse(n);return r?(w[e]=r,r):null}var M=function(){function e(t){Object(p.a)(this,e),this.brsUrlProvider=void 0,this._sid=null,this._login=null,this.brsUrlProvider=t}return Object(f.a)(e,[{key:"checkAuth",value:function(){try{return this.loadLoginInfo(),!0}catch(e){return!1}}},{key:"authAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n){var r,a,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSid(t,n);case 2:if((r=e.sent)&&"x-set-cookie"in r.headers){e.next=5;break}return e.abrupt("return",!1);case 5:if(a=r.headers["x-set-cookie"],s=a.match(/(?<=JSESSIONID=)\w+/)){e.next=9;break}return e.abrupt("return",!1);case 9:return C("loginInfo",{sid:s[0],login:t}),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSid",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A()({url:this.brsUrlProvider.baseUrl+"/login",method:"POST",body:"username=".concat(t,"&password=").concat(n),resolveWithFullResponse:!0,simple:!1,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then((function(e){return e}),(function(){return null}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadLoginInfo",value:function(){var e=S("loginInfo");if(!e)throw new Error("BrsAuth unauthorized");this._sid=e.sid,this._login=e.login}},{key:"sid",get:function(){return this._sid||this.loadLoginInfo(),this._sid}},{key:"login",get:function(){return this._login||this.loadLoginInfo(),this._login}}]),e}(),I=function(){function e(t){Object(p.a)(this,e),this.withProxy=void 0,this.brsUrl="https://brs.urfu.ru/mrd",this.corsProxy="https://kamikoto-cors-proxy.herokuapp.com",this.withProxy=t}return Object(f.a)(e,[{key:"baseUrl",get:function(){return this.withProxy?"".concat(this.corsProxy,"/").concat(this.brsUrl):this.brsUrl}}]),e}(),N=n(59),U=n(617),T=n(620);function W(e){return Object(r.jsx)(U.a,Object(N.a)({elevation:6,variant:"filled"},e))}function L(e){var t=e.open,n=e.message,a=e.type,i=e.onClose;return Object(r.jsx)(s.a.Fragment,{children:Object(r.jsx)(T.a,{open:t,autoHideDuration:1e4,anchorOrigin:{vertical:"top",horizontal:"center"},onClose:i,children:Object(r.jsx)(W,{severity:a,onClose:i,children:n})})})}var F=n(599),D=(n(550),n(281)),E=n.n(D);function P(e){var t=e.onSignedIn,n=e.onFailure;return Object(r.jsx)(E.a,{clientId:"122993083593-pacve8csj86voko30ia65raeg0ncrtuv.apps.googleusercontent.com",buttonText:"\u0412\u043e\u0439\u0442\u0438 \u0432 \u0430\u043a\u043a\u0430\u0443\u043d\u0442 Google",onSuccess:t,onFailure:n,isSignedIn:!0})}var R=new M(new I(!0)),z=function(e){Object(g.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).credentials=void 0,r.state={brsAuthorized:R.checkAuth(),googleAuthorized:!1,redirect:!1,submitLoading:!1,openAlert:!1,alertMessage:"",alertType:"error"},r.credentials={username:"",password:""},r.handleFieldChanged=r.handleFieldChanged.bind(Object(b.a)(r)),r.handleBrsSubmit=r.handleBrsSubmit.bind(Object(b.a)(r)),r.loginBrs=r.loginBrs.bind(Object(b.a)(r)),r.handleCloseAlert=r.handleCloseAlert.bind(Object(b.a)(r)),r.handleGoogleSignedIn=r.handleGoogleSignedIn.bind(Object(b.a)(r)),r.handleGoogleLoginFailed=r.handleGoogleLoginFailed.bind(Object(b.a)(r)),r.startWork=r.startWork.bind(Object(b.a)(r)),r}return Object(f.a)(n,[{key:"handleFieldChanged",value:function(e){var t=e.target;this.credentials[t.id]=t.value}},{key:"handleBrsSubmit",value:function(){var e=Object(h.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({submitLoading:!0}),e.next=4,this.loginBrs();case 4:n=e.sent,this.setState({submitLoading:!1}),n?this.setState({alertMessage:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u0440\u043e\u0448\u043b\u0430 \u0443\u0441\u043f\u0435\u0448\u043d\u043e",openAlert:!0,alertType:"success",brsAuthorized:!0}):this.setState({alertMessage:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c",openAlert:!0,alertType:"error"});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loginBrs",value:function(){var e=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.authAsync(this.credentials.username,this.credentials.password);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleCloseAlert",value:function(){this.setState({openAlert:!1})}},{key:"handleGoogleSignedIn",value:function(){this.setState({googleAuthorized:!0})}},{key:"handleGoogleLoginFailed",value:function(e){console.error(e),this.setState({openAlert:!0,alertType:"error",alertMessage:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u0412\u0430\u0448 Google \u0430\u043a\u043a\u0430\u0443\u043d\u0442 :("})}},{key:"startWork",value:function(){this.setState({redirect:!0})}},{key:"render",value:function(){return Object(r.jsxs)("div",{className:"login-page",children:[this.state.redirect&&Object(r.jsx)(u.a,{to:"/brs-extensions/work"}),Object(r.jsxs)(j.a,{component:"main",maxWidth:"md",children:[Object(r.jsx)("h1",{children:"\u041f\u0440\u0438\u0432\u0435\u0442!"}),Object(r.jsx)("h3",{children:"\u041a\u0430\u043a \u0432\u0441\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442"}),Object(r.jsx)("p",{children:"\u041a\u0430\u043a-\u0442\u043e \u0432\u0441\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442"}),Object(r.jsx)("h3",{children:"\u041f\u0440\u0430\u0432\u0438\u043b\u0430 \u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445"}),Object(r.jsx)("p",{children:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0445\u0440\u0430\u043d\u044f\u0442\u0441\u044f \u0432 localstorage"}),Object(r.jsx)("hr",{}),Object(r.jsx)("p",{children:"\u0414\u043b\u044f \u043d\u0430\u0447\u0430\u043b\u0430 \u0440\u0430\u0431\u043e\u0442\u044b, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u0411\u0420\u0421"}),Object(r.jsxs)(F.a,{container:!0,justify:"space-around",children:[Object(r.jsx)(F.a,{item:!0,md:5,lg:5,sm:5,xs:10,children:Object(r.jsxs)("form",{className:"form",onSubmit:this.handleBrsSubmit,children:[Object(r.jsx)(m.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"username",label:"\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f",name:"username",autoFocus:!0,onChange:this.handleFieldChanged}),Object(r.jsx)(m.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"\u041f\u0430\u0440\u043e\u043b\u044c",type:"password",id:"password",autoComplete:"current-password",onChange:this.handleFieldChanged}),Object(r.jsx)(k,{title:"\u0432\u043e\u0439\u0442\u0438",loading:this.state.submitLoading})]})}),Object(r.jsx)(F.a,{item:!0,className:"align-center",children:Object(r.jsx)("h3",{children:"\u0410 \u0442\u0430\u043a\u0436\u0435"})}),Object(r.jsxs)(F.a,{item:!0,className:"align-center",children:[Object(r.jsx)(P,{onSignedIn:this.handleGoogleSignedIn,onFailure:this.handleGoogleLoginFailed}),Object(r.jsx)("br",{})]})]}),Object(r.jsx)(j.a,{className:"start-work-wrapper",children:Object(r.jsx)(y.a,{variant:"contained",onClick:this.startWork,disabled:!this.state.brsAuthorized||!this.state.googleAuthorized,color:"secondary",children:"\u043d\u0430\u0447\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443"})}),Object(r.jsx)(L,{open:this.state.openAlert,message:this.state.alertMessage,type:this.state.alertType,onClose:this.handleCloseAlert})]})]})}}]),n}(s.a.Component),B=n(31),H=n(602),_=n(624),q=n(616),G=n(609),J=n(607),Z=n(604),K=n(625),X=n(608),Y=n(603),$=n(556),Q=n(605),V=n(606),ee=n(283),te=n.n(ee),ne=n(284),re=n.n(ne),ae=n(285),se=n.n(ae),ie=n(282),ce=n.n(ie),oe=Object(Z.a)((function(e){return Object(K.a)({root:{width:"100%",backgroundColor:e.palette.background.default},nested:{paddingLeft:e.spacing(4)},onEmptyMessage:{textAlign:"center"}})}));function ue(e){var t,n,a=e.item,i=e.collapsed,c=s.a.useState(!i),o=Object(B.a)(c,2),u=o[0],l=o[1],d=oe();return Object(r.jsxs)(s.a.Fragment,{children:[Object(r.jsxs)($.a,{button:!0,onClick:function(){return l(!u)},children:[Object(r.jsx)(Q.a,{children:Object(r.jsx)(ce.a,{})}),Object(r.jsx)(V.a,{primary:a.title}),(null===(t=a.nestedItems)||void 0===t?void 0:t.length)&&(u?Object(r.jsx)(te.a,{}):Object(r.jsx)(re.a,{}))||void 0]}),(null===(n=a.nestedItems)||void 0===n?void 0:n.length)&&a.nestedItems.map((function(e,t){return Object(r.jsx)(J.a,{in:u,timeout:"auto",unmountOnExit:!0,children:Object(r.jsx)(Y.a,{component:"div",className:d.nested,disablePadding:!0,children:Object(r.jsxs)($.a,{button:!0,children:[Object(r.jsx)(Q.a,{children:Object(r.jsx)(se.a,{})}),Object(r.jsx)(V.a,{primary:e})]})})},t)}))||void 0]})}function le(e){var t=e.title,n=e.items,a=e.collapsed,s=void 0===a||a,i=oe();return Object(r.jsx)(Y.a,{component:"nav","aria-labelledby":"nested-list-subheader",subheader:Object(r.jsx)(X.a,{component:"div",id:"nested-list-subheader",hidden:!t,children:t}),className:i.root,children:n.length?n.map((function(e,t){return Object(r.jsx)(ue,{item:e,collapsed:s},t)})):Object(r.jsx)($.a,{className:i.onEmptyMessage,children:Object(r.jsx)(V.a,{primary:"No items"})})})}var de,he,pe=n(28),fe=n(23);n(186);!function(e){e[e.NoFailure=-1]="NoFailure",e[e.NotChosen=-19]="NotChosen",e[e.NotAllowedByDeansOffice=-18]="NotAllowedByDeansOffice",e[e.NotAppeared=0]="NotAppeared",e[e.DisrespectfulReason=12]="DisrespectfulReason",e[e.RespectfulReason=13]="RespectfulReason",e[e.NotAllowedByTeacher=18]="NotAllowedByTeacher",e[e.ShouldNotPass=19]="ShouldNotPass",e[e.AcademicLeave=20]="AcademicLeave",e[e.DroppedOut=21]="DroppedOut"}(de||(de={})),function(e){e[e.Fall=1]="Fall",e[e.Spring=2]="Spring"}(he||(he={}));var be=function(){function e(t,n){Object(p.a)(this,e),this.brsAuth=void 0,this.brsUrlProvider=void 0,this.brsAuth=t,this.brsUrlProvider=n}return Object(f.a)(e,[{key:"getDisciplineCachedAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r,a){var s,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="".concat(this.brsAuth.login,"_getDiscipline_").concat(t,"_").concat(n,"_").concat(r,"_").concat(a),!(i=S(s))){e.next=4;break}return e.abrupt("return",i);case 4:return e.next=6,this.getDisciplineInternalAsync(t,n,r,a);case 6:return c=e.sent,C(s,c),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getDisciplineInternalAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r,a){var s,i,c,o,u,l,h,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="?year=".concat(t,"&termType=").concat(n,"&course=").concat(r,"&total=0&page=1&pageSize=1000&search="),!a){e.next=10;break}return e.next=4,this.requestApiJsonAsync("/mvc/mobile/module/fetch"+s);case 4:i=e.sent,c=Object(fe.a)(i);try{for(c.s();!(o=c.n()).done;)o.value.isModule=!0}catch(d){c.e(d)}finally{c.f()}return e.abrupt("return",i);case 10:return e.next=12,this.requestApiJsonAsync("/mvc/mobile/discipline/fetch"+s);case 12:u=e.sent,l=u.content,h=Object(fe.a)(l);try{for(h.s();!(p=h.n()).done;)p.value.isModule=!1}catch(d){h.e(d)}finally{h.f()}return e.abrupt("return",l);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getAllStudentMarksAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t){var n,r,a,s,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=pe.a,e.next=4,this.getStudentMarksAsync(t,"lecture","current");case 4:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=pe.a,e.next=9,this.getStudentMarksAsync(t,"lecture","intermediate");case 9:return e.t5=e.sent,e.t6=(0,e.t4)(e.t5),e.t7=pe.a,e.next=14,this.getStudentMarksAsync(t,"laboratory","current");case 14:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t10=pe.a,e.next=19,this.getStudentMarksAsync(t,"laboratory","intermediate");case 19:e.t11=e.sent,e.t12=(0,e.t10)(e.t11),n=e.t0.concat.call(e.t0,e.t3,e.t6,e.t9,e.t12),r={},a=Object(fe.a)(n);try{for(a.s();!(s=a.n()).done;)i=s.value,c=r[i.studentUuid]||{},r[i.studentUuid]=Object(N.a)(Object(N.a)({},c),i)}catch(o){a.e(o)}finally{a.f()}return e.abrupt("return",Object.keys(r).map((function(e){return r[e]})));case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStudentMarksAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getStudentMarksInternalAsync(t.disciplineLoad,t.isModule,t.groupHistoryId,t.groupId,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getStudentMarksInternalAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r,a,s,i){var c,o,u,l=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=l.length>6&&void 0!==l[6]&&l[6],o=l.length>7&&void 0!==l[7]&&l[7],u=n?"techgroup=".concat(a):"groupUuid=".concat(r),e.abrupt("return",this.requestApiJsonAsync("/mvc/mobile/studentMarks/fetch?disciplineLoad=".concat(t,"&").concat(u)+"&cardType=".concat(s,"&hasTest=false&isTotal=").concat(c)+"&intermediate=".concat("intermediate"===i)+"&selectedTeachers=null&showActiveStudents=".concat(o)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()},{key:"getAllControlActionsCachedAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=[],e.t1=pe.a,e.next=4,this.getControlActionsCachedAsync(t,"lecture","current");case 4:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=pe.a,e.next=9,this.getControlActionsCachedAsync(t,"lecture","intermediate");case 9:return e.t5=e.sent,e.t6=(0,e.t4)(e.t5),e.t7=pe.a,e.next=14,this.getControlActionsCachedAsync(t,"laboratory","current");case 14:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.t10=pe.a,e.next=19,this.getControlActionsCachedAsync(t,"laboratory","intermediate");case 19:return e.t11=e.sent,e.t12=(0,e.t10)(e.t11),e.t13=pe.a,e.next=24,this.getControlActionsCachedAsync(t,"practice","current");case 24:return e.t14=e.sent,e.t15=(0,e.t13)(e.t14),e.t16=pe.a,e.next=29,this.getControlActionsCachedAsync(t,"practice","intermediate");case 29:return e.t17=e.sent,e.t18=(0,e.t16)(e.t17),e.t19=pe.a,e.next=34,this.getControlActionsCachedAsync(t,"additionalPractice","current");case 34:return e.t20=e.sent,e.t21=(0,e.t19)(e.t20),e.t22=pe.a,e.next=39,this.getControlActionsCachedAsync(t,"additionalPractice","intermediate");case 39:return e.t23=e.sent,e.t24=(0,e.t22)(e.t23),e.abrupt("return",e.t0.concat.call(e.t0,e.t3,e.t6,e.t9,e.t12,e.t15,e.t18,e.t21,e.t24));case 42:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getControlActionsCachedAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r){var a,s,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="".concat(this.brsAuth.login,"_getControlActions_").concat(t.disciplineLoad)+"_".concat(t.isModule,"_").concat(t.groupHistoryId,"_").concat(t.groupId,"_").concat(n,"_").concat(r),!(s=S(a))){e.next=4;break}return e.abrupt("return",s);case 4:return e.next=6,this.getControlActionsInternalAsync(t.disciplineLoad,t.isModule,t.groupHistoryId,t.groupId,n,r);case 6:return i=e.sent,C(a,i),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getControlActionsInternalAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r,a,s,i){var c,o,u,l,h,p,f,b,g;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n?"/module":"",o=n?a:r,e.next=4,this.requestApiAsync("/mvc/mobile/view/mark/".concat(t,"/").concat(o,"/teachers").concat(c,"/").concat(s,"/").concat(i));case 4:if(u=e.sent,l="gridColumns = toTextArray(",h=");",1===(p=u.split("\r\n").map((function(e){return e.trim()})).filter((function(e){return e.startsWith(l)}))).length){e.next=10;break}throw new Error("Control actions page should contain single line target line with techcard identifier");case 10:return f=JSON.parse(p[0].substr(l.length,p[0].length-l.length-h.length))||[],b="technologyCard",g=f.filter((function(e){return e.uuid&&e.uuid.startsWith(b)})).map((function(e){return{uuid:e.uuid,uuidWithoutPrefix:e.uuid.substr(b.length),controlAction:e.controlAction}})),e.abrupt("return",g);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()},{key:"putStudentMarkAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r,a,s,i){var c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c="student=".concat(t,"&techcard=").concat(n,"&mark=").concat(isNaN(r)?"":r.toString(),"&groupId=").concat(a,"&cardTypeKey=").concat(s,"&disciplineLoadUuid=").concat(i),e.abrupt("return",this.requestApiJsonAsync("/mvc/mobile/studentMarks/put",{method:"POST",body:c,json:!1},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()},{key:"putStudentFailureAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n){var r,a,s,i=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:de.NoFailure,a=i.length>3&&void 0!==i[3]?i[3]:"lecture",s="markFailure=".concat(r,"&cardType=").concat(a,"&disciplineLoad=").concat(n.disciplineLoad,"&studentId=").concat(t),e.next=5,this.requestApiAsync("/mvc/mobile/failure/update",{method:"POST",body:s,json:!1},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"});case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateAllMarksAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateMarksAsync(t,"lecture","intermediate");case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateMarksAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.updateMarksInternalAsync(t.disciplineLoad,t.isModule,t.groupHistoryId,t.groupId,n,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateMarksInternalAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r,a,s,i){var c,o,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n?"/module":"",o=n?"techgroup=".concat(a):"groupUuid=".concat(r),u="disciplineLoad=".concat(t,"&").concat(o)+"&cardType=".concat(s,"&hasTest=false&isTotal=false")+"&intermediate=".concat("intermediate"===i)+"&selectedTeachers=null&showActiveStudents=true",e.abrupt("return",this.requestApiAsync("/mvc/mobile/updateMarks".concat(c),{method:"POST",body:u,json:!1},{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,s,i){return e.apply(this,arguments)}}()},{key:"requestApiJsonAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.requestApiAsync(t,n,r);case 2:return a=e.sent,e.abrupt("return",JSON.parse(a));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"requestApiAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A()(Object(N.a)(Object(N.a)({method:"GET"},n),{},{url:this.brsUrlProvider.baseUrl+t,headers:Object(N.a)({"X-Cookie":"JSESSIONID=".concat(this.brsAuth.sid),"X-Requested-With":"XMLHttpRequest"},r)}));case 2:if(!(a=e.sent).trimLeft().startsWith("<!DOCTYPE html>")){e.next=5;break}throw new Error(t+" is Forbidden");case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();function ge(e){return e&&e.toLowerCase().replace("\u0451","\u0435").replace(/[^A-Za-z\u0410-\u042f\u0401\u0430-\u044f\u04510-9]/g,"")}function ve(e,t){return ge(e)===ge(t)}function je(e){return parseFloat(e&&e.replace(",","."))}var me=n(610),ye=n(619),xe=Object(Z.a)((function(){return Object(K.a)({termType:{minWidth:100,marginRight:10},year:{width:60,marginRight:10},course:{width:50,marginRight:10},submit:{display:"inline-block",top:5},isModule:{marginTop:15},header:{marginBottom:10}})}));function ke(e){var t=xe(),n=e.brsApi,a=e.onUnauthorized,i=0,c="\u041e\u0441\u0435\u043d\u043d\u0438\u0439",o=0,u=!1,l=s.a.useState(!1),p=Object(B.a)(l,2),f=p[0],b=p[1],g=s.a.useState(!1),v=Object(B.a)(g,2),j=v[0],y=v[1],x=s.a.useState([]),O=Object(B.a)(x,2),A=O[0],w=O[1];function C(e){var t=e.target;switch(t.name){case"year":i=t.value;break;case"term-type":c=t.value;break;case"course":o=t.value;break;case"is-module":u=t.checked}}function S(){return(S=Object(h.a)(d.a.mark((function e(t){var r,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),y(!0),r="\u041e\u0441\u0435\u043d\u043d\u0438\u0439"===c?he.Fall:he.Spring,e.prev=3,e.next=6,n.getDisciplineCachedAsync(i,r,o,u);case 6:s=e.sent,e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(3),a(),y(!1),e.abrupt("return");case 14:w(M(s)),y(!1),b(!0);case 17:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function M(e){return Object.entries((t=e,n="discipline",t.reduce((function(e,t){var r="".concat(t[n]);return(e[r]=e[r]||[]).push(t),e}),{}))).map((function(e){return{title:e[0],nestedItems:e[1].map((function(e){return e.group}))}}));var t,n}return Object(r.jsxs)(s.a.Fragment,{children:[Object(r.jsx)("h3",{className:t.header,children:"\u0412\u044b\u0431\u0435\u0440\u0438 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u043a\u0443\u0440\u0441\u0430 \u0432 \u0411\u0420\u0421"}),Object(r.jsxs)("form",{onSubmit:function(e){return S.apply(this,arguments)},children:[Object(r.jsx)(m.a,{name:"year",className:t.year,label:"\u0413\u043e\u0434",type:"number",onChange:C,required:!0}),Object(r.jsxs)(H.a,{className:t.termType,required:!0,children:[Object(r.jsx)(_.a,{id:"term-label",children:"\u0421\u0435\u043c\u0435\u0441\u0442\u0440"}),Object(r.jsxs)(q.a,{name:"term-type",onChange:C,children:[Object(r.jsx)(G.a,{value:"\u041e\u0441\u0435\u043d\u043d\u0438\u0439",children:"\u041e\u0441\u0435\u043d\u043d\u0438\u0439"}),Object(r.jsx)(G.a,{value:"\u0412\u0435\u0441\u0435\u043d\u043d\u0438\u0439",children:"\u0412\u0435\u0441\u0435\u043d\u043d\u0438\u0439"})]})]}),Object(r.jsx)(m.a,{name:"course",className:t.course,label:"\u041a\u0443\u0440\u0441",type:"number",onChange:C,required:!0}),Object(r.jsx)(me.a,{label:"\u041c\u043e\u0434\u0443\u043b\u044c",className:t.isModule,control:Object(r.jsx)(ye.a,{name:"is-module",color:"primary",onChange:C})}),Object(r.jsx)(k,{title:"\u0432\u044b\u0432\u0435\u0441\u0442\u0438",loading:j,className:t.submit})]}),Object(r.jsx)("br",{}),Object(r.jsx)(J.a,{in:f,children:Object(r.jsx)(le,{title:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0434\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u044b",items:A})})]})}var Oe=Object(a.memo)(ke),Ae=n(286);n(63);function we(){return Ce.apply(this,arguments)}function Ce(){return(Ce=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e){var t=gapi.client.sheets;function n(){return(n=Object(h.a)(d.a.mark((function n(r){var a;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.spreadsheets.values.get({spreadsheetId:e,range:r});case 2:return a=n.sent,n.abrupt("return",a.result);case 4:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return{readAsync:function(e){return n.apply(this,arguments)},writeAsync:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=a?"USER_ENTERED":"RAW",i={values:r};return t.spreadsheets.values.update({spreadsheetId:e,range:n,valueInputOption:s,requestBody:i})},appendAsync:function(n,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=a?"USER_ENTERED":"RAW",i={values:r};return t.spreadsheets.values.append({spreadsheetId:e,range:n,valueInputOption:s,requestBody:i})}}}function Me(e,t){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(h.a)(d.a.mark((function e(t,n){var r,a,s,i,c,o,u,l,h,p,f,b,g=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.length>2&&void 0!==g[2]?g[2]:0,a=g.length>3&&void 0!==g[3]?g[3]:1,s=g.length>4&&void 0!==g[4]?g[4]:null,e.next=5,we();case 5:return i=Se(t),e.next=8,i.readAsync(n);case 8:if(e.t0=e.sent.values,e.t0){e.next=11;break}e.t0=[];case 11:c=e.t0,o=[],u=Object(fe.a)(c);try{for(u.s();!(l=u.n()).done;)h=l.value,p=h[r],f=h[a],b=null!==s?h[s]:null,p&&f&&o.push({fullName:p,groupName:f,id:b,properties:h})}catch(d){u.e(d)}finally{u.f()}return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e,t){return Ue.apply(this,arguments)}function Ue(){return(Ue=Object(h.a)(d.a.mark((function e(t,n){var r,a,s,i,c,o,u,l,h,p=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]?p[2]:null,a=p.length>3&&void 0!==p[3]?p[3]:null,e.next=4,Te(t,n);case 4:return s=e.sent,i=Le(s),c=Fe(n,i),o=De(s,i),u=Ee(s,i,r),e.next=11,Me(t,c,i.fullNameColumn-i.left,i.groupColumn-i.left,null);case 11:return l=e.sent,h=a?l.filter(a):l,e.abrupt("return",{actualStudents:h,disciplineConfig:u,controlActionConfigs:o});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e,t){return We.apply(this,arguments)}function We(){return(We=Object(h.a)(d.a.mark((function e(t,n){var r,a,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we();case 2:return r=Se(t),e.next=5,r.readAsync(n+"!A1:ZZ1");case 5:if(a=e.sent.values,s=a&&a[0]){e.next=9;break}throw new Error("Can't read header of spreadsheet");case 9:return e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e){var t=e&&e.map((function(e){return ge(e)})),n=t.indexOf(ge("\u0413\u0440\u0443\u043f\u043f\u0430 \u0432 \u0411\u0420\u0421")),r=t.indexOf(ge("\u0424\u0430\u043c\u0438\u043b\u0438\u044f \u0418\u043c\u044f \u0432 \u0411\u0420\u0421")),a=t.findIndex((function(e){return e.startsWith(ge("\u0414\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0430"))})),s=a-1;if(n<0||r<0||a<0||n>s||r>s||1!==Math.abs(r-n))throw new Error("Wrong order of columns");return{groupColumn:n,fullNameColumn:r,disciplineColumn:a,left:Math.min(n,r),right:s}}function Fe(e,t){var n=String.fromCharCode("A".charCodeAt(0)+t.left),r=String.fromCharCode("A".charCodeAt(0)+t.right);return"".concat(e,"!").concat(n,"2:").concat(r)}function De(e,t){for(var n=[],r=t.left;r<=t.right;r++)r!==t.groupColumn&&r!==t.fullNameColumn&&e[r]&&n.push({controlActions:[e[r]],propertyIndex:r-t.left});for(var a=function(){var e=i[s];if(1===e.controlActions.length){var t=n.filter((function(t){return 1===t.controlActions.length&&ve(t.controlActions[0],e.controlActions[0])}));if(t.length>1){e.matchCount=t.length;for(var r=0;r<t.length;r++)t[r].matchIndex=r}}},s=0,i=n;s<i.length;s++)a();return n}function Ee(e,t,n){var r,a={},s=Object(fe.a)(e[t.disciplineColumn].split(";"));try{for(s.s();!(r=s.n()).done;){var i=r.value.split(":").map((function(e){return e.trim()})),c=ge(i[0]),o=i[1];c===ge("\u0414\u0438\u0441\u0446\u0438\u043f\u043b\u0438\u043d\u0430")?a.name=o:c===ge("\u0418\u0422\u0421")?a.isModule="\u0434\u0430"===o.toLowerCase():c===ge("\u0413\u043e\u0434")?a.year=parseInt(o.toLowerCase(),10):c===ge("\u0421\u0435\u043c\u0435\u0441\u0442\u0440")?"\u043e\u0441\u0435\u043d\u043d\u0438\u0439"===o.toLowerCase()?a.termType=he.Fall:"\u0432\u0435\u0441\u0435\u043d\u043d\u0438\u0439"===o.toLowerCase()&&(a.termType=he.Spring):c===ge("\u041a\u0443\u0440\u0441")&&(a.course=parseInt(o.toLowerCase(),10))}}catch(u){s.e(u)}finally{s.f()}return a.isSuitableDiscipline=n,a}n(553);var Pe=function(e){Object(g.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).tableUrl="",r.state={loading:!1,tableUrlError:{error:!1,message:""},moduleGroups:[]},r.handleChange=r.handleChange.bind(Object(b.a)(r)),r.loadTable=r.loadTable.bind(Object(b.a)(r)),r}return Object(f.a)(n,[{key:"handleChange",value:function(e){var t=e.target;switch(t.name){case"table-url":this.state.tableUrlError.error&&this.setState({tableUrlError:{error:!1,message:""}}),this.tableUrl=t.value}}},{key:"prepareModuleGroup",value:function(e){var t=e.actualStudents.map((function(e){return e.groupName}));return{title:e.disciplineConfig.name,nestedItems:Array.from(new Set(t))}}},{key:"loadTable",value:function(){var e=Object(h.a)(d.a.mark((function e(t){var n,r,a,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({loading:!0}),e.next=4,this.getSpreadsheetInfo();case 4:if(r=e.sent){e.next=8;break}return this.setState({loading:!1}),e.abrupt("return");case 8:return e.prev=8,e.next=11,Ne(r.spreadsheetId,r.sheetName);case 11:a=e.sent,e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(8),this.setState({loading:!1}),this.props.onError(e.t0.message||JSON.stringify(e.t0)),e.abrupt("return");case 19:s=this.prepareModuleGroup(a),this.setState({loading:!1,moduleGroups:[s]}),null===(n=this.props.onDataLoaded)||void 0===n||n.call(null,a);case 22:case"end":return e.stop()}}),e,this,[[8,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getSpreadsheetInfo",value:function(){var e=Object(h.a)(d.a.mark((function e(){var t,n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=this.tableUrl.match(Object(Ae.a)(/d\/([\x2D0-9A-Z_a-z]+)\/edit/,{id:1})))||void 0===t?void 0:t.groups)&&t.groups.id){e.next=4;break}return this.setState({loading:!1,tableUrlError:{error:!0,message:"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 url-\u0430\u0434\u0440\u0435\u0441."}}),e.abrupt("return",null);case 4:return n=t.groups.id,e.prev=5,e.next=8,gapi.client.sheets.spreadsheets.get({spreadsheetId:n});case 8:return r=e.sent,a=JSON.parse(r.body).sheets[0].properties.title,e.abrupt("return",{spreadsheetId:n,sheetName:a});case 13:return e.prev=13,e.t0=e.catch(5),this.props.onError(e.t0.message||JSON.stringify(e.t0)),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,this,[[5,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(r.jsxs)("span",{className:"spreadsheet-fetch",children:[Object(r.jsx)("h3",{className:"header",children:"\u0412\u0441\u0442\u0430\u0432\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 Google \u0422\u0430\u0431\u043b\u0438\u0446\u0443"}),Object(r.jsxs)("form",{onSubmit:this.loadTable,className:"form",children:[Object(r.jsx)(m.a,{name:"table-url",label:"\u0421\u0441\u044b\u043b\u043a\u0430",type:"text",className:"tableUrl",onChange:this.handleChange,error:this.state.tableUrlError.error,helperText:this.state.tableUrlError.message,required:!0}),Object(r.jsx)(k,{title:"\u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c",loading:this.state.loading,className:"submit"})]}),Object(r.jsx)(J.a,{in:!!this.state.moduleGroups.length,children:Object(r.jsx)(le,{items:this.state.moduleGroups,collapsed:!1})})]})}}]),n}(s.a.Component),Re=Object(a.memo)(Pe),ze=n(5),Be=n(621),He=n(613),_e=n(611),qe=n(612),Ge=Object(ze.a)((function(){return{root:{padding:0}}}))(_e.a),Je=Object(ze.a)((function(){return{root:{display:"flex",justifyContent:"space-around"}}}))(qe.a),Ze=function(e){Object(g.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).marksManager=void 0,r.marksManager=e.marksManager,r.state={okLoading:!0,cancelPending:!1,logItems:[]},r.cancelWork=r.cancelWork.bind(Object(b.a)(r)),r.startWork=r.startWork.bind(Object(b.a)(r)),r.logMessage=r.logMessage.bind(Object(b.a)(r)),r}return Object(f.a)(n,[{key:"componentDidMount",value:function(){this.startWork()}},{key:"logMessage",value:function(e){this.state.logItems.push(e),this.setState({})}},{key:"startWork",value:function(){var e=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.marksManager.logger.addLogHandler(this.logMessage),e.next=3,this.marksManager.putMarksToBrsAsync(this.props.marksData);case 3:this.setState({cancelPending:!1,okLoading:!1});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"cancelWork",value:function(){var e;null===(e=this.marksManager)||void 0===e||e.cancel(),this.setState({cancelPending:!0})}},{key:"render",value:function(){return Object(r.jsx)(s.a.Fragment,{children:Object(r.jsxs)(Be.a,{open:this.props.runWork,maxWidth:"sm",fullWidth:!0,children:[Object(r.jsx)(He.a,{children:"\u041b\u043e\u0433 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"}),Object(r.jsx)(Ge,{dividers:!0,children:Object(r.jsx)(Y.a,{dense:!0,style:{height:300},children:this.state.logItems.map((function(e,t){return Object(r.jsx)($.a,{children:Object(r.jsx)(V.a,{primary:e})},t)}))})}),Object(r.jsxs)(Je,{children:[Object(r.jsx)(k,{loading:this.state.okLoading,onClick:this.props.onClosed,title:"\u043e\u043a"}),Object(r.jsx)(k,{loading:this.state.cancelPending,disabled:!this.state.okLoading,onClick:this.cancelWork,title:"\u043e\u0442\u043c\u0435\u043d\u0430"})]})]})})}}]),n}(s.a.Component),Ke=n(615),Xe=n(614),Ye=s.a.forwardRef((function(e,t){return Object(r.jsx)(Xe.a,Object(N.a)({direction:"up",ref:t},e))}));function $e(e){var t=e.open,n=s.a.useState(!1),a=Object(B.a)(n,2),i=a[0],c=a[1];return Object(r.jsxs)(s.a.Fragment,{children:[i&&Object(r.jsx)(u.a,{to:"/brs-extensions"}),Object(r.jsxs)(Be.a,{open:t,TransitionComponent:Ye,keepMounted:!0,"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description",children:[Object(r.jsx)(He.a,{id:"alert-dialog-slide-title",children:"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f"}),Object(r.jsx)(_e.a,{children:Object(r.jsx)(Ke.a,{id:"alert-dialog-slide-description",children:"\u041a\u0430\u0436\u0435\u0442\u0441\u044f, \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u0441\u0435\u0441\u0441\u0438\u0438 \u0411\u0420\u0421 \u0438\u043b\u0438 Google \u0438\u0441\u0442\u0435\u043a\u043b\u043e. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f."})}),Object(r.jsx)(qe.a,{style:{display:"flex",justifyContent:"space-around"},children:Object(r.jsx)(y.a,{onClick:function(){var e;e="loginInfo",localStorage.removeItem(e),delete w[e],c(!0)},color:"primary",children:"\u041e\u043a"})})]})]})}var Qe=["https://sheets.googleapis.com/$discovery/rest?version=v4"],Ve={init:function(){return Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!gapi.client){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,new Promise((function(e){gapi.load("client:auth2",Object(h.a)(d.a.mark((function t(){return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,gapi.client.init({clientId:"122993083593-pacve8csj86voko30ia65raeg0ncrtuv.apps.googleusercontent.com",discoveryDocs:Qe,scope:"https://www.googleapis.com/auth/spreadsheets"}).then((function(){}),undefined);case 2:e();case 3:case"end":return t.stop()}}),t)}))))}));case 4:case"end":return e.stop()}}),e)})))()},checkAuth:function(){var e,t,n;return null===(e=gapi.auth2)||void 0===e||null===(t=e.getAuthInstance())||void 0===t||null===(n=t.isSignedIn)||void 0===n?void 0:n.get()}};function et(e){return e.replace("\u0451","\u0435").replace(/[ ]+/," ").toLowerCase()}var tt=function(){function e(t,n,r){Object(p.a)(this,e),this.brsApi=void 0,this.options=void 0,this.cancelPending=!1,this.logger=void 0,this.brsApi=t,this.logger=n,this.options=r}return Object(f.a)(e,[{key:"cancel",value:function(){this.cancelPending=!0}},{key:"putMarksToBrsAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t){var n,r,a,s,i,c,o,u,l=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.actualStudents,r=t.controlActionConfigs,a=t.disciplineConfig,e.prev=1,e.next=4,this.brsApi.getDisciplineCachedAsync(a.year,a.termType,a.course,a.isModule);case 4:s=e.sent,i=s.filter((function(e){return ve(e.discipline,a.name)&&(!a.isSuitableDiscipline||a.isSuitableDiscipline(e))})),c=Object(fe.a)(i),e.prev=7,u=d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.value,e.next=3,l.putMarksForDisciplineAsync(t,n.filter((function(e){return ve(e.groupName,t.group)})),r);case 3:if(!l.cancelPending){e.next=5;break}return e.abrupt("return","break");case 5:case"end":return e.stop()}}),e)})),c.s();case 10:if((o=c.n()).done){e.next=17;break}return e.delegateYield(u(),"t0",12);case 12:if("break"!==e.t0){e.next=15;break}return e.abrupt("break",17);case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(7),c.e(e.t1);case 22:return e.prev=22,c.f(),e.finish(22);case 25:e.next=30;break;case 27:e.prev=27,e.t2=e.catch(1),this.logger.error(e.t2);case 30:case"end":return e.stop()}}),e,this,[[1,27],[7,19,22,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"putMarksForDisciplineAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r){var a,s,i,c,o,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n.length){e.next=2;break}return e.abrupt("return");case 2:return this.logger.log("# Processing group ".concat(t.group)),e.next=5,this.brsApi.getAllControlActionsCachedAsync(t);case 5:if(a=e.sent,this.checkControlActionsConfiguration(a,r)){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,this.brsApi.getAllStudentMarksAsync(t);case 10:return s=e.sent,i=this.mergeStudents(n,s),c=i.mergedStudents,o=i.skippedActualStudents,u=i.skippedBrsStudents,this.logMergedStudents(c,o,u),e.next=15,this.putMarksForStudentsAsync(t,c,r,a);case 15:if(!this.options.save){e.next=19;break}return e.next=19,this.brsApi.updateAllMarksAsync(t);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"checkControlActionsConfiguration",value:function(e,t){var n,r=Object(fe.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!this.getSuitableControlAction(a,e))return!1}}catch(s){r.e(s)}finally{r.f()}return!0}},{key:"putMarksForStudentsAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r,a){var s,i,c,o,u,l,h,p;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s={},i=Object(fe.a)(n),e.prev=2,i.s();case 4:if((c=i.n()).done){e.next=15;break}if(o=c.value,!this.cancelPending){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,this.putMarksForStudentAsync(t,o,r,a);case 10:u=e.sent,void 0===s[u]&&(s[u]=0),s[u]++;case 13:e.next=4;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:for(this.logger.log("Marks update statuses:"),l=0,h=Object.keys(s);l<h.length;l++)p=h[l],this.logger.log("- ".concat(p," = ").concat(s[p]));case 25:case"end":return e.stop()}}),e,this,[[2,17,20,23]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"putMarksForStudentAsync",value:function(){var e=Object(h.a)(d.a.mark((function e(t,n,r,a){var s,i,c,o,u,l,h,p,f,b,g;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=0,i=0,c=[],o=Object(fe.a)(r),e.prev=4,o.s();case 6:if((u=o.n()).done){e.next=32;break}if(l=u.value,h=this.getSuitableControlAction(l,a)){e.next=11;break}throw new Error;case 11:if(p=je(n.brs[h.uuid]),(f=je(n.actual.properties[l.propertyIndex]))!==p&&0!==f){e.next=18;break}return c.push("    ".concat(f," ").substr("".concat(f).length-1)),e.abrupt("continue",30);case 18:c.push("    ".concat(f,"!").substr("".concat(f).length-1));case 19:if(e.prev=19,!this.options.save){e.next=24;break}return e.next=24,this.brsApi.putStudentMarkAsync(n.brs.studentUuid,h.uuidWithoutPrefix,f,t.groupHistoryId,n.brs.cardType,n.brs.disciplineLoad);case 24:s++,e.next=30;break;case 27:e.prev=27,e.t0=e.catch(19),i++;case 30:e.next=6;break;case 32:e.next=37;break;case 34:e.prev=34,e.t1=e.catch(4),o.e(e.t1);case 37:return e.prev=37,o.f(),e.finish(37);case 40:return b=i>0?"FAILED ":s>0?"UPDATED":"SKIPPED",(this.options.verbose||i>0)&&(g=(n.actual.fullName+"                              ").substr(0,30),this.logger.log("".concat(b," ").concat(g," updated: ").concat(s,", failed: ").concat(i,", marks: ").concat(c.join(" ")))),e.abrupt("return",b);case 43:case"end":return e.stop()}}),e,this,[[4,34,37,40],[19,27]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getSuitableControlAction",value:function(e,t){var n=t.filter((function(t){return e.controlActions.some((function(e){return ve(t.controlAction,e)}))}));return 0===n.length?(this.logger.log("All of ".concat(e.controlActions.join(", ")," not found")),this.logger.log("Known actions: ".concat(t.map((function(e){return e.controlAction})).join(", "))),null):void 0!==e.matchIndex||void 0!==e.matchCount?void 0===e.matchIndex||void 0===e.matchCount||n.length!==e.matchCount||e.matchIndex>=e.matchCount?(this.logger.log("Invalid configuration of ".concat(e.controlActions.join(", "))),this.logger.log("Can't match: ".concat(e.matchIndex,"/").concat(e.matchCount," of ").concat(n.length)),null):n[e.matchIndex]:n.length>1?(this.logger.log("Several control actions found for ".concat(e.controlActions.join(", "))),this.logger.log("Found actions: ".concat(n.map((function(e){return e.controlAction})).join(", "))),null):n[0]}},{key:"mergeStudents",value:function(t,n){var r,a=this,s=n.filter(e.isStudentActive),i=[],c=[],o=Object(fe.a)(t);try{var u=function(){var t=r.value;if(a.cancelPending)return"break";var n=s.filter((function(n){return e.areStudentsLike(n,t)}));1===n.length?i.push({actual:t,brs:n[0]}):c.push(t)};for(o.s();!(r=o.n()).done;){if("break"===u())break}}catch(f){o.e(f)}finally{o.f()}var l,d=[],h=Object(fe.a)(s);try{var p=function(){var e=l.value;i.some((function(t){return t.brs.studentUuid===e.studentUuid}))||d.push(e)};for(h.s();!(l=h.n()).done;)p()}catch(f){h.e(f)}finally{h.f()}return{mergedStudents:i,skippedActualStudents:c,skippedBrsStudents:d}}},{key:"logMergedStudents",value:function(e,t,n){this.logger.log("Merged students = ".concat(e.length)),this.logger.log("Can't merge actual students = ".concat(t.length));var r,a=Object(fe.a)(t);try{for(a.s();!(r=a.n()).done;){var s=r.value;this.logger.log("- "+s.fullName)}}catch(u){a.e(u)}finally{a.f()}this.logger.log("Can't merge BRS students = ".concat(n.length));var i,c=Object(fe.a)(n);try{for(c.s();!(i=c.n()).done;){var o=i.value;this.logger.log("- "+o.studentFio)}}catch(u){c.e(u)}finally{c.f()}}}],[{key:"isStudentActive",value:function(e){return"\u041f\u0435\u0440\u0435\u0432\u0435\u0434\u0435\u043d"!==e.studentStatus&&"\u041e\u0442\u0447\u0438\u0441\u043b\u0435\u043d"!==e.studentStatus}},{key:"areStudentsLike",value:function(e,t){var n=et(e.studentFio),r=et(t.fullName);return n.startsWith(r)}}]),e}(),nt=function(){function e(){Object(p.a)(this,e),this.logHandlers=void 0,this.errorHandler=void 0}return Object(f.a)(e,[{key:"addLogHandler",value:function(e){this.logHandlers||(this.logHandlers=[]),this.logHandlers.push(e)}},{key:"addErrorHandler",value:function(e){this.errorHandler||(this.errorHandler=[]),this.errorHandler.push(e)}},{key:"log",value:function(e){if(this.logHandlers){var t,n=Object(fe.a)(this.logHandlers);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(r){n.e(r)}finally{n.f()}}}},{key:"error",value:function(e){if(this.errorHandler){var t,n=Object(fe.a)(this.errorHandler);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(r){n.e(r)}finally{n.f()}}}}]),e}(),rt=new I(!0),at=new M(rt),st=new be(at,rt),it=function(e){Object(g.a)(n,e);var t=Object(v.a)(n);function n(e){var r;return Object(p.a)(this,n),(r=t.call(this,e)).marksData=void 0,r.marksManager=void 0,r.marksData={},r.marksManager={},r.state={showControls:!1,runWork:!1,openUnauthorizedAlert:!1,errorMessage:""},r.handleDataLoaded=r.handleDataLoaded.bind(Object(b.a)(r)),r.runWork=r.runWork.bind(Object(b.a)(r)),r.handleClosed=r.handleClosed.bind(Object(b.a)(r)),r.handleUnauthorized=r.handleUnauthorized.bind(Object(b.a)(r)),r.handleError=r.handleError.bind(Object(b.a)(r)),r.closeError=r.closeError.bind(Object(b.a)(r)),r.handleRunWorkSafe=r.handleRunWorkSafe.bind(Object(b.a)(r)),r.handleRunWorkUnsafe=r.handleRunWorkUnsafe.bind(Object(b.a)(r)),r}return Object(f.a)(n,[{key:"componentDidMount",value:function(){var e=Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve.init();case 2:at.checkAuth()&&Ve.checkAuth()||this.handleUnauthorized();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleDataLoaded",value:function(e){this.marksData=e,this.setState({showControls:!0})}},{key:"runWork",value:function(e){var t=new nt;t.addErrorHandler(this.handleError);var n={save:e,verbose:!0};this.marksManager=new tt(st,t,n),this.setState({runWork:!0})}},{key:"handleRunWorkSafe",value:function(){this.runWork(!1)}},{key:"handleRunWorkUnsafe",value:function(){this.runWork(!0)}},{key:"handleClosed",value:function(){this.setState({runWork:!1})}},{key:"handleUnauthorized",value:function(){this.setState({openUnauthorizedAlert:!0})}},{key:"handleError",value:function(e){var t=e.message||JSON.stringify(e);t.endsWith(" is Forbidden")?this.handleUnauthorized():this.setState({errorMessage:t})}},{key:"closeError",value:function(){this.setState({errorMessage:""})}},{key:"render",value:function(){return Object(r.jsxs)(s.a.Fragment,{children:[this.state.openUnauthorizedAlert&&Object(r.jsx)($e,{open:this.state.openUnauthorizedAlert}),this.state.errorMessage&&Object(r.jsx)(L,{open:!!this.state.errorMessage,message:this.state.errorMessage,type:"error",onClose:this.closeError}),Object(r.jsx)("div",{className:"work-page",children:Object(r.jsxs)(j.a,{maxWidth:"md",children:[Object(r.jsx)(Oe,{brsApi:st,onUnauthorized:this.handleUnauthorized}),Object(r.jsx)("hr",{}),Object(r.jsx)(Re,{onDataLoaded:this.handleDataLoaded,onError:this.handleError,onUnauthorized:this.handleUnauthorized}),Object(r.jsx)("br",{}),Object(r.jsx)(J.a,{in:this.state.showControls,children:Object(r.jsxs)(F.a,{container:!0,justify:"space-around",children:[Object(r.jsx)(F.a,{item:!0,children:Object(r.jsx)(y.a,{variant:"contained",onClick:this.handleRunWorkSafe,color:"primary",children:"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0445\u043e\u0440\u043e\u0448\u043e"})}),Object(r.jsx)(F.a,{item:!0,children:Object(r.jsx)(y.a,{variant:"contained",onClick:this.handleRunWorkUnsafe,color:"secondary",children:"\u0421\u0434\u0435\u043b\u0430\u0439 \u0445\u043e\u0440\u043e\u0448\u043e"})})]})}),this.state.runWork&&Object(r.jsx)(Ze,{runWork:this.state.runWork,marksData:this.marksData,marksManager:this.marksManager,onClosed:this.handleClosed})]})})]})}}]),n}(s.a.Component);function ct(){return Object(r.jsx)(o.a,{children:Object(r.jsxs)(u.d,{children:[Object(r.jsx)(u.b,{path:"/brs-extensions/work",component:it}),Object(r.jsx)(u.b,{exact:!0,path:"/brs-extensions",component:z})]})})}var ot=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,626)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),s(e),i(e)}))};n(554);c.a.render(Object(r.jsx)(s.a.StrictMode,{children:Object(r.jsx)(ct,{})}),document.getElementById("root")),ot()}},[[555,1,2]]]);
//# sourceMappingURL=main.8f8fecb6.chunk.js.map